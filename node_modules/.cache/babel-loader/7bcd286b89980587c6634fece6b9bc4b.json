{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\ideaworkspace\\jxc-front-end\\src\\store\\modules\\user.js","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\store\\modules\\user.js","mtime":1648374777580},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1648365139913},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1648365119872}],"contextDependencies":[],"result":["import Vue from 'vue';\nimport { login, logout, phoneLogin, thirdLogin } from \"@/api/login\";\nimport { ACCESS_TOKEN, USER_NAME, USER_INFO, USER_AUTH, SYS_BUTTON_AUTH, UI_CACHE_DB_DICT_DATA } from \"@/store/mutation-types\";\nimport { welcome } from \"@/utils/util\";\nimport { queryPermissionsByUser } from '@/api/api';\nimport { getAction } from '@/api/manage';\nvar user = {\n  state: {\n    token: '',\n    username: '',\n    realname: '',\n    welcome: '',\n    avatar: '',\n    permissionList: [],\n    info: {}\n  },\n  mutations: {\n    SET_TOKEN: function SET_TOKEN(state, token) {\n      state.token = token;\n    },\n    SET_NAME: function SET_NAME(state, _ref) {\n      var username = _ref.username,\n          realname = _ref.realname,\n          welcome = _ref.welcome;\n      state.username = username;\n      state.realname = realname;\n      state.welcome = welcome;\n    },\n    SET_AVATAR: function SET_AVATAR(state, avatar) {\n      state.avatar = avatar;\n    },\n    SET_PERMISSIONLIST: function SET_PERMISSIONLIST(state, permissionList) {\n      state.permissionList = permissionList;\n    },\n    SET_INFO: function SET_INFO(state, info) {\n      state.info = info;\n    }\n  },\n  actions: {\n    // CAS验证登录\n    ValidateLogin: function ValidateLogin(_ref2, userInfo) {\n      var commit = _ref2.commit;\n      return new Promise(function (resolve, reject) {\n        getAction(\"/cas/client/validateLogin\", userInfo).then(function (response) {\n          console.log(\"----cas 登录--------\", response);\n\n          if (response.success) {\n            var result = response.result;\n            var _userInfo = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo);\n            commit('SET_NAME', {\n              username: _userInfo.username,\n              realname: _userInfo.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo.avatar);\n            resolve(response);\n          } else {\n            resolve(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登录\n    Login: function Login(_ref3, userInfo) {\n      var commit = _ref3.commit;\n      return new Promise(function (resolve, reject) {\n        login(userInfo).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var _userInfo2 = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo2.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo2, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo2);\n            commit('SET_NAME', {\n              username: _userInfo2.username,\n              realname: _userInfo2.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo2.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    //手机号登录\n    PhoneLogin: function PhoneLogin(_ref4, userInfo) {\n      var commit = _ref4.commit;\n      return new Promise(function (resolve, reject) {\n        phoneLogin(userInfo).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var _userInfo3 = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, _userInfo3.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, _userInfo3, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(UI_CACHE_DB_DICT_DATA, result.sysAllDictItems, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', _userInfo3);\n            commit('SET_NAME', {\n              username: _userInfo3.username,\n              realname: _userInfo3.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', _userInfo3.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 获取用户信息\n    GetPermissionList: function GetPermissionList(_ref5) {\n      var commit = _ref5.commit;\n      return new Promise(function (resolve, reject) {\n        var v_token = Vue.ls.get(ACCESS_TOKEN);\n        var params = {\n          token: v_token\n        };\n        queryPermissionsByUser(params).then(function (response) {\n          var menuData = response.result.menu;\n          var authData = response.result.auth;\n          var allAuthData = response.result.allAuth; //Vue.ls.set(USER_AUTH,authData);\n\n          sessionStorage.setItem(USER_AUTH, JSON.stringify(authData));\n          sessionStorage.setItem(SYS_BUTTON_AUTH, JSON.stringify(allAuthData));\n\n          if (menuData && menuData.length > 0) {\n            //update--begin--autor:qinfeng-----date:20200109------for：JEECG-63 一级菜单的子菜单全部是隐藏路由，则一级菜单不显示------\n            menuData.forEach(function (item, index) {\n              if (item[\"children\"]) {\n                var hasChildrenMenu = item[\"children\"].filter(function (i) {\n                  return !i.hidden || i.hidden == false;\n                });\n\n                if (hasChildrenMenu == null || hasChildrenMenu.length == 0) {\n                  item[\"hidden\"] = true;\n                }\n              }\n            });\n            console.log(\" menu show json \", menuData); //update--end--autor:qinfeng-----date:20200109------for：JEECG-63 一级菜单的子菜单全部是隐藏路由，则一级菜单不显示------\n\n            commit('SET_PERMISSIONLIST', menuData);\n          } else {\n            reject('getPermissionList: permissions must be a non-null array !');\n          }\n\n          resolve(response);\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    },\n    // 登出\n    Logout: function Logout(_ref6) {\n      var commit = _ref6.commit,\n          state = _ref6.state;\n      return new Promise(function (resolve) {\n        var logoutToken = state.token;\n        commit('SET_TOKEN', '');\n        commit('SET_PERMISSIONLIST', []);\n        Vue.ls.remove(ACCESS_TOKEN);\n        Vue.ls.remove(UI_CACHE_DB_DICT_DATA); //console.log('logoutToken: '+ logoutToken)\n\n        logout(logoutToken).then(function () {\n          //let sevice = \"http://\"+window.location.host+\"/\";\n          //let serviceUrl = encodeURIComponent(sevice);\n          //window.location.href = window._CONFIG['casPrefixUrl']+\"/logout?service=\"+serviceUrl;\n          resolve();\n        }).catch(function () {\n          resolve();\n        });\n      });\n    },\n    // 第三方登录\n    ThirdLogin: function ThirdLogin(_ref7, token) {\n      var commit = _ref7.commit;\n      return new Promise(function (resolve, reject) {\n        thirdLogin(token).then(function (response) {\n          if (response.code == '200') {\n            var result = response.result;\n            var userInfo = result.userInfo;\n            Vue.ls.set(ACCESS_TOKEN, result.token, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_NAME, userInfo.username, 7 * 24 * 60 * 60 * 1000);\n            Vue.ls.set(USER_INFO, userInfo, 7 * 24 * 60 * 60 * 1000);\n            commit('SET_TOKEN', result.token);\n            commit('SET_INFO', userInfo);\n            commit('SET_NAME', {\n              username: userInfo.username,\n              realname: userInfo.realname,\n              welcome: welcome()\n            });\n            commit('SET_AVATAR', userInfo.avatar);\n            resolve(response);\n          } else {\n            reject(response);\n          }\n        }).catch(function (error) {\n          reject(error);\n        });\n      });\n    }\n  }\n};\nexport default user;",null]}