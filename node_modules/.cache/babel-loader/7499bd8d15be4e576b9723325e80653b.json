{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\components\\jeecg\\JImageUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\components\\jeecg\\JImageUpload.vue","mtime":1648374777534},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1648365139913},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nimport { getFileAccessHttpUrl } from '@/api/manage';\n\nvar uidGenerator = function uidGenerator() {\n  return '-' + parseInt(Math.random() * 10000 + 1, 10);\n};\n\nvar getFileName = function getFileName(path) {\n  if (path.lastIndexOf(\"\\\\\") >= 0) {\n    var reg = new RegExp(\"\\\\\\\\\", \"g\");\n    path = path.replace(reg, \"/\");\n  }\n\n  return path.substring(path.lastIndexOf(\"/\") + 1);\n};\n\nexport default {\n  name: 'JImageUpload',\n  data: function data() {\n    return {\n      uploadAction: window._CONFIG['domianURL'] + \"/sys/common/upload\",\n      uploadLoading: false,\n      picUrl: false,\n      headers: {},\n      fileList: [],\n      previewImage: \"\",\n      previewVisible: false\n    };\n  },\n  props: {\n    text: {\n      type: String,\n      required: false,\n      default: \"上传\"\n    },\n\n    /*这个属性用于控制文件上传的业务路径*/\n    bizPath: {\n      type: String,\n      required: false,\n      default: \"temp\"\n    },\n    value: {\n      type: [String, Array],\n      required: false\n    },\n    disabled: {\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    isMultiple: {\n      type: Boolean,\n      required: false,\n      default: false\n    }\n  },\n  watch: {\n    value: function value(val) {\n      if (val instanceof Array) {\n        this.initFileList(val.join(','));\n      } else {\n        this.initFileList(val);\n      }\n    }\n  },\n  created: function created() {\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    this.headers = {\n      \"X-Access-Token\": token\n    };\n  },\n  methods: {\n    initFileList: function initFileList(paths) {\n      if (!paths || paths.length == 0) {\n        this.fileList = [];\n        return;\n      }\n\n      this.picUrl = true;\n      var fileList = [];\n      var arr = paths.split(\",\");\n\n      for (var a = 0; a < arr.length; a++) {\n        var url = getFileAccessHttpUrl(arr[a]);\n        fileList.push({\n          uid: uidGenerator(),\n          name: getFileName(arr[a]),\n          status: 'done',\n          url: url,\n          response: {\n            status: \"history\",\n            message: arr[a]\n          }\n        });\n      }\n\n      this.fileList = fileList;\n    },\n    beforeUpload: function beforeUpload(file) {\n      var fileType = file.type;\n\n      if (fileType.indexOf('image') < 0) {\n        this.$message.warning('请上传图片');\n        return false;\n      }\n    },\n    handleChange: function handleChange(info) {\n      this.picUrl = false;\n      var fileList = info.fileList;\n\n      if (info.file.status === 'done') {\n        if (info.file.response.success) {\n          this.picUrl = true;\n          fileList = fileList.map(function (file) {\n            if (file.response) {\n              file.url = file.response.message;\n            }\n\n            return file;\n          });\n        } //this.$message.success(`${info.file.name} 上传成功!`);\n\n      } else if (info.file.status === 'error') {\n        this.$message.error(\"\".concat(info.file.name, \" \\u4E0A\\u4F20\\u5931\\u8D25.\"));\n      } else if (info.file.status === 'removed') {\n        this.handleDelete(info.file);\n      }\n\n      this.fileList = fileList;\n\n      if (info.file.status === 'done' || info.file.status === 'removed') {\n        this.handlePathChange();\n      }\n    },\n    // 预览\n    handlePreview: function handlePreview(file) {\n      this.previewImage = file.url || file.thumbUrl;\n      this.previewVisible = true;\n    },\n    getAvatarView: function getAvatarView() {\n      if (this.fileList.length > 0) {\n        var url = this.fileList[0].url;\n        return getFileAccessHttpUrl(url);\n      }\n    },\n    handlePathChange: function handlePathChange() {\n      var uploadFiles = this.fileList;\n      var path = '';\n\n      if (!uploadFiles || uploadFiles.length == 0) {\n        path = '';\n      }\n\n      var arr = [];\n\n      if (!this.isMultiple) {\n        arr.push(uploadFiles[uploadFiles.length - 1].response.message);\n      } else {\n        for (var a = 0; a < uploadFiles.length; a++) {\n          arr.push(uploadFiles[a].response.message);\n        }\n      }\n\n      if (arr.length > 0) {\n        path = arr.join(\",\");\n      }\n\n      this.$emit('change', path);\n    },\n    handleDelete: function handleDelete(file) {\n      //如有需要新增 删除逻辑\n      console.log(file);\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n      this.previewVisible = false;\n    },\n    close: function close() {}\n  },\n  model: {\n    prop: 'value',\n    event: 'change'\n  }\n};",null]}