{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\finance\\modules\\RubricPurInvoiceModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\finance\\modules\\RubricPurInvoiceModal.vue","mtime":1648374777631},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport pick from 'lodash.pick';\nimport { FormTypes, getRefPromise, VALIDATE_NO_PASSED, validateFormAndTables } from '@/utils/JEditableTableUtil';\nimport { JEditableTableMixin } from '@/mixins/JEditableTableMixin';\nimport JDate from '@/components/jeecg/JDate';\nimport JUpload from '@/components/jeecg/JUpload';\nimport JDictSelectTag from \"@/components/dict/JDictSelectTag\";\nimport JSelectUserByDep from '@/components/jeecgbiz/JSelectUserByDep';\nimport { putAction } from '@api/manage';\nimport { billModalMixin } from '../../mixins/billModalMixin';\nimport EditableTableColumnsSetter from \"../../components/EditableTableColumnsSetter\";\nimport OnlCgreportSelectModal from '../../components/OnlCgreportSelectModal';\nimport { getFormatDate } from '../../utils/util';\nexport default {\n  name: 'RubricPurInvoiceModal',\n  mixins: [JEditableTableMixin, billModalMixin],\n  components: {\n    EditableTableColumnsSetter: EditableTableColumnsSetter,\n    JDate: JDate,\n    JUpload: JUpload,\n    JSelectUserByDep: JSelectUserByDep,\n    JDictSelectTag: JDictSelectTag,\n    OnlCgreportSelectModal: OnlCgreportSelectModal\n  },\n  data: function data() {\n    return {\n      width: '1200px',\n      moreStatus: false,\n      // 新增时子表默认添加几行空数据\n      addDefaultRowNum: 0,\n      validatorRules: {\n        billDate: {\n          rules: [{\n            required: true,\n            message: '请输入单据日期!'\n          }]\n        },\n        supplierId: {\n          rules: [{\n            required: true,\n            message: '请输入供应商!'\n          }]\n        },\n        sourceNo: {\n          rules: [{\n            required: true,\n            message: '请输入采购发票!'\n          }]\n        }\n      },\n      refKeys: ['finPurInvoiceEntry', 'sourceFinPurInvoiceEntry'],\n      tableKeys: ['finPurInvoiceEntry'],\n      activeKey: 'finPurInvoiceEntry',\n      // 红单明细\n      finPurInvoiceEntryTable: {\n        loading: false,\n        dataSource: [],\n        selectedRowCount: 0,\n        settingColumns: [],\n        //显示列设置\n        columns: [{\n          title: '分录号',\n          key: 'entryNo',\n          type: FormTypes.inputNumber,\n          width: \"60px\",\n          disabled: true\n        }, {\n          title: '源单类型',\n          key: 'sourceType',\n          type: FormTypes.hidden,\n          width: \"1px\",\n          disabled: true\n        }, {\n          title: '源单分录ID',\n          key: 'sourceEntryId',\n          type: FormTypes.hidden,\n          width: \"1px\",\n          disabled: true\n        }, {\n          title: '源单分录号',\n          key: 'sourceEntryNo',\n          type: FormTypes.hidden,\n          width: \"1px\",\n          disabled: true\n        }, {\n          title: '物料',\n          key: 'materialId',\n          type: FormTypes.sel_search,\n          dictCode: \"bas_material,name,id\",\n          width: \"160px\",\n          defaultValue: '',\n          options: [],\n          disabled: true\n        }, {\n          title: '仓库',\n          key: 'warehouseId',\n          type: FormTypes.select,\n          dictCode: \"bas_warehouse,name,id\",\n          width: \"150px\",\n          defaultValue: '',\n          options: [],\n          disabled: true\n        }, {\n          title: '批次号',\n          key: 'batchNo',\n          type: FormTypes.input,\n          width: \"200px\",\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '结算数量',\n          key: 'settleQty',\n          type: FormTypes.input,\n          width: \"100px\",\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '结算金额',\n          key: 'settleAmt',\n          type: FormTypes.input,\n          width: \"100px\",\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '税率',\n          key: 'taxRate',\n          type: FormTypes.input,\n          width: \"80px\",\n          defaultValue: ''\n        }, {\n          title: '发票号',\n          key: 'invoiceNo',\n          type: FormTypes.input,\n          width: \"240px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }]\n        }, {\n          title: '开票日期',\n          key: 'invoiceDate',\n          type: FormTypes.date,\n          width: \"120px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '开票数量',\n          key: 'invoiceQty',\n          type: FormTypes.inputNumber,\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '开票金额',\n          key: 'invoiceAmt',\n          type: FormTypes.inputNumber,\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '备注',\n          key: 'remark',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '备注2',\n          key: 'remark2',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '备注3',\n          key: 'remark3',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }]\n      },\n      //蓝字明细\n      sourceFinPurInvoiceEntryTable: {\n        loading: false,\n        dataSource: [],\n        selectedRowCount: 0,\n        disabledRows: {}\n      },\n      url: {\n        add: \"/finance/finPurInvoice/add\",\n        edit: \"/finance/finPurInvoice/edit\",\n        approve: \"/finance/finPurInvoice/approve\",\n        finPurInvoiceEntry: {\n          list: '/finance/finPurInvoice/queryFinPurInvoiceEntryByMainId'\n        }\n      }\n    };\n  },\n  methods: {\n    getAllTable: function getAllTable() {\n      var _this = this;\n\n      var values = this.tableKeys.map(function (key) {\n        return getRefPromise(_this, key);\n      });\n      return Promise.all(values);\n    },\n    addInit: function addInit() {\n      this.model.isAuto = 0;\n      this.model.isRubric = 1;\n      this.model.sourceType = 'fin_pur_invoice'; //处理状态：编辑中\n\n      this.model.billProcStatus = '12'; // 请求后台的填值规则接口地址\n\n      var url = '/sys/fillRule/executeRuleByCode/';\n      var ruleCode = 'pur_invoice_bill_no';\n      var that = this;\n      putAction(url + ruleCode, {}).then(function (res) {\n        // 执行成功，获取返回的值，并赋到页面上\n        if (res.success) {\n          that.model.billNo = res.result;\n          that.$nextTick(function () {\n            that.form.setFieldsValue({\n              'billNo': res.result,\n              'billDate': getFormatDate()\n            });\n          });\n        }\n      });\n    },\n\n    /** 调用完edit()方法之后会自动调用此方法 */\n    editAfter: function editAfter() {\n      var _this2 = this;\n\n      var that = this; //sourceFinPurInvoiceEntry未在tableKeys中\n\n      this.$nextTick(function () {\n        return that.$refs.sourceFinPurInvoiceEntry.initialize();\n      });\n\n      if (this.action === 'add') {\n        this.addInit();\n        this.activeKey = 'sourceFinPurInvoiceEntry';\n      } else {\n        this.activeKey = 'finPurInvoiceEntry';\n      }\n\n      var fieldval = pick(this.model, 'billNo', 'billDate', 'isAuto', 'invoiceType', 'isRubric', 'sourceType', 'sourceNo', 'clerkId', 'supplierId', 'attachment', 'remark', 'billProcStatus', 'approverId', 'flowId', 'isApproved', 'effectiveTime', 'isVoided', 'isClosed', 'sysOrgCode', 'createBy', 'createTime', 'updateBy', 'updateTime');\n      this.$nextTick(function () {\n        _this2.form.setFieldsValue(fieldval);\n      }); // 加载子表数据\n\n      if (this.model.id) {\n        var loadSecondSubTableData = function loadSecondSubTableData() {\n          var params = {\n            id: that.model.sourceId\n          };\n          that.requestSubTableData(that.url.finPurInvoiceEntry.list, params, that.sourceFinPurInvoiceEntryTable, that.refreshDisabledRows);\n        };\n\n        var params = {\n          id: this.model.id\n        };\n        this.requestSubTableData(this.url.finPurInvoiceEntry.list, params, this.finPurInvoiceEntryTable, loadSecondSubTableData);\n      }\n    },\n\n    /** 整理成formData */\n    classifyIntoFormData: function classifyIntoFormData(allValues) {\n      var main = Object.assign(this.model, allValues.formValue);\n      return _objectSpread({}, main, {\n        // 展开\n        finPurInvoiceEntryList: allValues.tablesValue[0].values\n      });\n    },\n    validateError: function validateError(msg) {\n      this.$message.error(msg);\n    },\n    popupCallback: function popupCallback(row) {\n      this.form.setFieldsValue(pick(row, 'billNo', 'billDate', 'isAuto', 'invoiceType', 'isRubric', 'sourceType', 'sourceNo', 'clerkId', 'supplierId', 'attachment', 'remark', 'billProcStatus', 'approverId', 'flowId', 'isApproved', 'effectiveTime', 'isVoided', 'isClosed', 'sysOrgCode', 'createBy', 'createTime', 'updateBy', 'updateTime'));\n    },\n    handleSourceSelect: function handleSourceSelect() {\n      var queryParams = {};\n      queryParams['supplier_id'] = this.form.getFieldValue('supplierId');\n      this.$refs.selectModal.initQueryParams(queryParams);\n      this.$refs.selectModal.visible = true;\n    },\n    handleSourceSelectCallback: function handleSourceSelectCallback(selectedRows) {\n      if (this.model.sourceId === selectedRows[0]['id']) return;\n      this.model.sourceId = selectedRows[0]['id'];\n      this.form.setFieldsValue({\n        sourceNo: selectedRows[0]['bill_no'],\n        supplierId: selectedRows[0]['supplier_id']\n      }); // 加载子表数据\n\n      var params = {\n        id: this.model.sourceId\n      };\n      this.requestSubTableData(this.url.finPurInvoiceEntry.list, params, this.sourceFinPurInvoiceEntryTable, this.refreshDisabledRows);\n    },\n    handleAddEntry: function handleAddEntry() {\n      var source = this.$refs.sourceFinPurInvoiceEntry,\n          target = this.$refs.finPurInvoiceEntry;\n\n      var _source$getValuesSync = source.getValuesSync({\n        validate: false,\n        rowIds: source.selectedRowIds\n      }),\n          values = _source$getValuesSync.values;\n\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = values[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var v = _step.value;\n          var row = pick(v, 'entryNo', 'materialId', 'warehouseId', 'batchNo', 'settleQty', 'settleAmt', 'taxRate');\n          row.sourceType = 'fin_pur_invoice.fin_pur_invoice_entry';\n          row.sourceEntryId = v.id;\n          row.sourceEntryNo = this.form.getFieldValue(\"sourceNo\") + '.' + v.entryNo;\n          row.invoiceQty = -v.invoiceQty;\n          row.invoiceAmt = -v.invoiceAmt;\n          target.add();\n          var rowId = target.rows[target.rows.length - 1].id;\n          target.setValues([{\n            rowKey: rowId,\n            values: row\n          }]);\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      this.refreshDisabledRows();\n    },\n    handleRemoveEntry: function handleRemoveEntry() {\n      this.$refs.finPurInvoiceEntry.removeSelectedRows();\n      this.refreshDisabledRows();\n    },\n    refreshDisabledRows: function refreshDisabledRows() {\n      var entryNos = [];\n\n      var _this$$refs$finPurInv = this.$refs.finPurInvoiceEntry.getValuesSync({\n        validate: false\n      }),\n          values = _this$$refs$finPurInv.values;\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = values[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var v = _step2.value;\n          entryNos.push(Number(v.entryNo));\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.sourceFinPurInvoiceEntryTable.disabledRows = entryNos.length === 0 ? {} : {\n        entryNo: entryNos\n      }; //disabledRowIds不初始会保留前面的数据，导致与disabledRows不一致！\n\n      this.$refs.sourceFinPurInvoiceEntry.disabledRowIds = []; //使新的disabledRows生效\n\n      var dataSource = _toConsumableArray(this.sourceFinPurInvoiceEntryTable.dataSource);\n\n      this.sourceFinPurInvoiceEntryTable.dataSource = dataSource;\n    },\n    validateRubric: function validateRubric(type, value, row, column, callback, target) {\n      if (type !== 'blur') {\n        callback();\n        return;\n      }\n\n      var _target$getValuesSync = target.getValuesSync({\n        validate: false,\n        rowIds: [row.id]\n      }),\n          values = _target$getValuesSync.values;\n\n      var rubric = Number(values[0][column.key]);\n\n      if (isNaN(rubric)) {\n        callback();\n        return;\n      }\n\n      var sourceEntryId = values[0].sourceEntryId;\n      var rows = this.sourceFinPurInvoiceEntryTable.dataSource.filter(function (row) {\n        return row.id === sourceEntryId;\n      });\n      var blue = rows[0][column.key];\n\n      if (isNaN(blue)) {\n        callback();\n        return;\n      }\n\n      if (-rubric > blue) {\n        callback(false, '不能超出蓝单！');\n        return;\n      }\n\n      callback(true); //true：通过验证\n    }\n  }\n};",{"version":3,"sources":["RubricPurInvoiceModal.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <j-modal\r\n    :title=\"'采购发票（红字）登记 - ' + title\"\r\n    :width=\"width\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    :maskClosable=\"false\"\r\n    :keyboard=\"false\"\r\n    :forceRender=\"true\"\r\n    switchFullscreen\r\n    @cancel=\"handleCancel\">\r\n\r\n    <template slot=\"footer\">\r\n      <a-button v-if=\"action!=='detail'\" key=\"cancel\" @click=\"handleCancel\">取消</a-button>\r\n      <a-button v-if=\"!readOnly\" key=\"save\"   @click=\"handleSave\" type=\"primary\" :loading=\"confirmLoading\">保存</a-button>\r\n      <a-button v-if=\"!readOnly\" key=\"submit\" @click=\"handleSubmit\" type=\"primary\" :loading=\"confirmLoading\">提交</a-button>\r\n      <a-button v-if=\"action==='detail'\"  key=\"close\"  @click=\"handleCancel\" type=\"primary\">关闭</a-button>\r\n      <a-button v-if=\"action==='approve'\"  key=\"approved\"  @click=\"handleApproved\" type=\"primary\">审核通过</a-button>\r\n    </template>\r\n\r\n    <a-spin :spinning=\"confirmLoading\">\r\n      <!-- 主表单区域 -->\r\n      <a-form :form=\"form\">\r\n        <a-row>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"处理状态\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['billProcStatus']\" :trigger-change=\"true\" dictCode=\"x_bill_proc_status\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否通过\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isApproved']\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否关闭\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isClosed']\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否作废\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isVoided']\" :trigger-change=\"true\" dictCode=\"yn\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a @click=\"() => moreStatus = !moreStatus\" style=\"float: right; margin-top: 10px\">\r\n              {{ moreStatus ? '收起' : '展开' }}\r\n              <a-icon :type=\"moreStatus ? 'up' : 'down'\"/>\r\n            </a>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row v-show=\"moreStatus\">\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'createTime']\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['createBy']\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建部门\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['sysOrgCode']\" :trigger-change=\"true\" dictCode=\"sys_depart,depart_name,org_code\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"生效时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'effectiveTime']\" :showTime=\"true\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"审核人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['approverId']\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"流程\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'flowId']\" ></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"修改时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'updateTime']\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"修改人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['updateBy']\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"是否红字\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag  disabled type=\"list\" v-decorator=\"['isRubric']\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :xs=\"24\" :sm=\"8\">\r\n            <a-form-item label=\"自动生成\"  :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isAuto']\" :trigger-change=\"true\" dictCode=\"yn\" placeholder=\"请选择是否自动生成\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"单据编号\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'billNo']\" ></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"单据日期\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"readOnly\" placeholder=\"请选择单据日期\" v-decorator=\"[ 'billDate', validatorRules.billDate]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item  label=\"制单人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['createBy']\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col v-show=\"false\" :span=\"8\">\r\n            <a-form-item label=\"业务员\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-select-user-by-dep :disabled=\"readOnly\" v-decorator=\"['clerkId']\" :trigger-change=\"true\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <!--业务员有供应商分管范围，所以先输入业务员，再选择供应商-->\r\n            <a-form-item label=\"供应商\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag :disabled=\"readOnly\" type=\"list\" v-decorator=\"['supplierId', validatorRules.supplierId]\" :trigger-change=\"true\" dictCode=\"bas_supplier,name,id\" placeholder=\"请选择供应商\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col v-show=\"false\" :span=\"8\">\r\n            <a-form-item label=\"发票类型\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag :disabled=\"readOnly\" type=\"list\" v-decorator=\"['invoiceType']\" :trigger-change=\"true\" dictCode=\"x_invoice_type\" placeholder=\"请选择发票类型\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col v-show=\"false\" :span=\"8\">\r\n            <a-form-item label=\"源单类型\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['sourceType']\" :trigger-change=\"true\" dictCode=\"x_bill_type\" placeholder=\"请选择源单类型\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"采购发票\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'sourceNo', validatorRules.sourceNo]\" >\r\n                <a-icon @click=\"handleSourceSelect\" slot=\"addonAfter\" type=\"ellipsis\" />\r\n              </a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n\r\n          <a-col :span=\"24\">\r\n            <!-- 子表单区域 -->\r\n            <a-tabs v-model=\"activeKey\" @change=\"handleChangeTabs\">\r\n              <a-tab-pane tab=\"蓝单明细\" :key=\"refKeys[1]\" :forceRender=\"true\">\r\n                <div v-if=\"!readOnly\" class=\"table-operator\">\r\n                  <a-button :disabled=\"sourceFinPurInvoiceEntryTable.selectedRowCount===0\"\r\n                            @click=\"handleAddEntry\" type=\"primary\" >添加<a-icon type=\"right\" /></a-button>\r\n                </div>\r\n                <j-editable-table\r\n                  :disabled=\"true\"\r\n                  :ref=\"refKeys[1]\"\r\n                  :loading=\"sourceFinPurInvoiceEntryTable.loading\"\r\n                  :columns=\"finPurInvoiceEntryTable.columns\"\r\n                  :dataSource=\"sourceFinPurInvoiceEntryTable.dataSource\"\r\n                  :disabledRows=\"sourceFinPurInvoiceEntryTable.disabledRows\"\r\n                  :maxHeight=\"300\"\r\n                  :rowNumber=\"false\"\r\n                  :rowSelection=\"!readOnly\"\r\n                  :actionButton=\"false\"\r\n                  @selectRowChange=\"(selectedRowIds)=>sourceFinPurInvoiceEntryTable.selectedRowCount=selectedRowIds.length\"\r\n                />\r\n              </a-tab-pane>\r\n\r\n              <a-tab-pane tab=\"明细\" :key=\"refKeys[0]\" :forceRender=\"true\">\r\n                <div v-if=\"!readOnly\" class=\"table-operator\">\r\n                  <a-button :disabled=\"finPurInvoiceEntryTable.selectedRowCount===0\"\r\n                            @click=\"handleRemoveEntry\" type=\"primary\" icon=\"left\">移除</a-button>\r\n                </div>\r\n\r\n                <j-editable-table\r\n                  :disabled=\"readOnly\"\r\n                  :ref=\"refKeys[0]\"\r\n                  :loading=\"finPurInvoiceEntryTable.loading\"\r\n                  :columns=\"finPurInvoiceEntryTable.columns\"\r\n                  :dataSource=\"finPurInvoiceEntryTable.dataSource\"\r\n                  :maxHeight=\"300\"\r\n                  :rowNumber=\"false\"\r\n                  :rowSelection=\"true\"\r\n                  :actionButton=\"false\"\r\n                  @selectRowChange=\"(selectedRowIds)=>finPurInvoiceEntryTable.selectedRowCount=selectedRowIds.length\"\r\n                />\r\n              </a-tab-pane>\r\n\r\n              <template slot=\"tabBarExtraContent\">\r\n                <editable-table-columns-setter :columns=\"finPurInvoiceEntryTable.columns\" tableName=\"finPurInvoiceEntryTable\" />\r\n              </template>\r\n            </a-tabs>\r\n\r\n            <br>\r\n          </a-col>\r\n\r\n          <a-col :span=\"24\">\r\n            <a-form-item label=\"备注\" :labelCol=\"spans.labelCol1\" :wrapperCol=\"spans.wrapperCol1\">\r\n              <a-textarea :readOnly=\"readOnly\" v-decorator=\"[ 'remark']\" rows=\"1\" autoSize></a-textarea>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"24\">\r\n            <a-form-item label=\"附件\" :labelCol=\"spans.labelCol1\" :wrapperCol=\"spans.wrapperCol1\">\r\n              <j-upload :disabled=\"readOnly\" v-decorator=\"['attachment']\" :trigger-change=\"true\"></j-upload>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n      </a-form>\r\n    </a-spin>\r\n\r\n    <onl-cgreport-select-modal\r\n      ref=\"selectModal\"\r\n      title=\"选择采购发票\"\r\n      reportId=\"1264115611825766401\"\r\n      :width=\"1100\"\r\n      :multiSelectable=\"false\"\r\n      @callback=\"handleSourceSelectCallback\"\r\n    />\r\n\r\n  </j-modal>\r\n</template>\r\n\r\n<script>\r\n\r\n  import pick from 'lodash.pick'\r\n  import { FormTypes, getRefPromise, VALIDATE_NO_PASSED, validateFormAndTables } from '@/utils/JEditableTableUtil'\r\n  import { JEditableTableMixin } from '@/mixins/JEditableTableMixin'\r\n  import JDate from '@/components/jeecg/JDate'\r\n  import JUpload from '@/components/jeecg/JUpload'\r\n  import JDictSelectTag from \"@/components/dict/JDictSelectTag\"\r\n  import JSelectUserByDep from '@/components/jeecgbiz/JSelectUserByDep'\r\n  import { putAction } from '@api/manage'\r\n  import { billModalMixin } from '../../mixins/billModalMixin'\r\n  import EditableTableColumnsSetter from \"../../components/EditableTableColumnsSetter\";\r\n  import OnlCgreportSelectModal from '../../components/OnlCgreportSelectModal'\r\n  import { getFormatDate } from '../../utils/util'\r\n\r\n  export default {\r\n    name: 'RubricPurInvoiceModal',\r\n    mixins: [JEditableTableMixin, billModalMixin],\r\n    components: {\r\n      EditableTableColumnsSetter,\r\n      JDate,\r\n      JUpload,\r\n      JSelectUserByDep,\r\n      JDictSelectTag,\r\n      OnlCgreportSelectModal\r\n    },\r\n\r\n    data() {\r\n      return {\r\n        width: '1200px',\r\n        moreStatus: false,\r\n\r\n        // 新增时子表默认添加几行空数据\r\n        addDefaultRowNum: 0,\r\n        validatorRules: {\r\n          billDate: {\r\n            rules: [\r\n              { required: true, message: '请输入单据日期!'},\r\n            ]\r\n          },\r\n          supplierId: {\r\n            rules: [\r\n              { required: true, message: '请输入供应商!'},\r\n            ]\r\n          },\r\n          sourceNo: {\r\n            rules: [\r\n              { required: true, message: '请输入采购发票!'},\r\n            ]\r\n          },\r\n        },\r\n        refKeys: ['finPurInvoiceEntry', 'sourceFinPurInvoiceEntry',],\r\n        tableKeys:['finPurInvoiceEntry', ],\r\n        activeKey: 'finPurInvoiceEntry',\r\n\r\n        // 红单明细\r\n        finPurInvoiceEntryTable: {\r\n          loading: false,\r\n          dataSource: [],\r\n          selectedRowCount: 0,\r\n          settingColumns: [], //显示列设置\r\n          columns: [\r\n            {\r\n              title: '分录号',\r\n              key: 'entryNo',\r\n              type: FormTypes.inputNumber,\r\n              width:\"60px\",\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '源单类型',\r\n              key: 'sourceType',\r\n              type: FormTypes.hidden,\r\n              width:\"1px\",\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '源单分录ID',\r\n              key: 'sourceEntryId',\r\n              type: FormTypes.hidden,\r\n              width:\"1px\",\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '源单分录号',\r\n              key: 'sourceEntryNo',\r\n              type: FormTypes.hidden,\r\n              width:\"1px\",\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '物料',\r\n              key: 'materialId',\r\n              type: FormTypes.sel_search,\r\n              dictCode:\"bas_material,name,id\",\r\n              width:\"160px\",\r\n              defaultValue: '',\r\n              options:[],\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '仓库',\r\n              key: 'warehouseId',\r\n              type: FormTypes.select,\r\n              dictCode:\"bas_warehouse,name,id\",\r\n              width:\"150px\",\r\n              defaultValue: '',\r\n              options:[],\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '批次号',\r\n              key: 'batchNo',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              defaultValue: '',\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '结算数量',\r\n              key: 'settleQty',\r\n              type: FormTypes.input,\r\n              width:\"100px\",\r\n              defaultValue: '',\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '结算金额',\r\n              key: 'settleAmt',\r\n              type: FormTypes.input,\r\n              width:\"100px\",\r\n              defaultValue: '',\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '税率',\r\n              key: 'taxRate',\r\n              type: FormTypes.input,\r\n              width:\"80px\",\r\n              defaultValue: '',\r\n            },\r\n            {\r\n              title: '发票号',\r\n              key: 'invoiceNo',\r\n              type: FormTypes.input,\r\n              width:\"240px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules: [{ required: true, message: '${title}不能为空' }],\r\n            },\r\n            {\r\n              title: '开票日期',\r\n              key: 'invoiceDate',\r\n              type: FormTypes.date,\r\n              width:\"120px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n            {\r\n              title: '开票数量',\r\n              key: 'invoiceQty',\r\n              type: FormTypes.inputNumber,\r\n              width:\"100px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules: [\r\n                { required: true, message: '${title}不能为空' },\r\n                { pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/, message: '请输入0或负数!' },\r\n                { handler: this.validateRubric}\r\n              ],\r\n            },\r\n            {\r\n              title: '开票金额',\r\n              key: 'invoiceAmt',\r\n              type: FormTypes.inputNumber,\r\n              width: \"100px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules: [\r\n                {required: true, message: '${title}不能为空'},\r\n                { pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/, message: '请输入0或负数!' },\r\n                {handler: this.validateRubric},\r\n              ],\r\n            },\r\n            {\r\n              title: '备注',\r\n              key: 'remark',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n            {\r\n              title: '备注2',\r\n              key: 'remark2',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n            {\r\n              title: '备注3',\r\n              key: 'remark3',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n          ]\r\n        },\r\n\r\n        //蓝字明细\r\n        sourceFinPurInvoiceEntryTable: {\r\n          loading: false,\r\n          dataSource: [],\r\n          selectedRowCount: 0,\r\n          disabledRows:{},\r\n        },\r\n\r\n        url: {\r\n          add: \"/finance/finPurInvoice/add\",\r\n          edit: \"/finance/finPurInvoice/edit\",\r\n          approve: \"/finance/finPurInvoice/approve\",\r\n          finPurInvoiceEntry: {\r\n            list: '/finance/finPurInvoice/queryFinPurInvoiceEntryByMainId'\r\n          },\r\n        }\r\n      }\r\n    },\r\n\r\n    methods: {\r\n      getAllTable() {\r\n        let values = this.tableKeys.map(key => getRefPromise(this, key))\r\n        return Promise.all(values)\r\n      },\r\n\r\n      addInit() {\r\n        this.model.isAuto = 0\r\n        this.model.isRubric = 1\r\n        this.model.sourceType = 'fin_pur_invoice'\r\n        //处理状态：编辑中\r\n        this.model.billProcStatus = '12'\r\n\r\n        // 请求后台的填值规则接口地址\r\n        const url = '/sys/fillRule/executeRuleByCode/'\r\n        const ruleCode = 'pur_invoice_bill_no'\r\n        const that = this\r\n        putAction(url + ruleCode, {}).then(res => {\r\n          // 执行成功，获取返回的值，并赋到页面上\r\n          if (res.success) {\r\n            that.model.billNo = res.result;\r\n            that.$nextTick(() => {\r\n              that.form.setFieldsValue({'billNo':res.result, 'billDate':getFormatDate()});\r\n            })\r\n          }\r\n        })\r\n      },\r\n\r\n      /** 调用完edit()方法之后会自动调用此方法 */\r\n      editAfter() {\r\n        const that = this;\r\n        //sourceFinPurInvoiceEntry未在tableKeys中\r\n        this.$nextTick( ()=>that.$refs.sourceFinPurInvoiceEntry.initialize() );\r\n\r\n        if (this.action === 'add') {\r\n          this.addInit();\r\n          this.activeKey = 'sourceFinPurInvoiceEntry';\r\n        } else {\r\n          this.activeKey = 'finPurInvoiceEntry';\r\n        }\r\n\r\n        let fieldval = pick(this.model,'billNo','billDate','isAuto','invoiceType','isRubric',\r\n          'sourceType','sourceNo','clerkId','supplierId','attachment','remark',\r\n          'billProcStatus','approverId','flowId','isApproved','effectiveTime','isVoided','isClosed',\r\n          'sysOrgCode','createBy','createTime','updateBy','updateTime')\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(fieldval)\r\n        })\r\n        // 加载子表数据\r\n        if (this.model.id) {\r\n          let params = { id: this.model.id }\r\n          this.requestSubTableData(this.url.finPurInvoiceEntry.list, params, this.finPurInvoiceEntryTable,\r\n            loadSecondSubTableData);\r\n\r\n          function loadSecondSubTableData(){\r\n            let params = { id: that.model.sourceId }\r\n            that.requestSubTableData(that.url.finPurInvoiceEntry.list, params, that.sourceFinPurInvoiceEntryTable,\r\n              that.refreshDisabledRows);\r\n          }\r\n        }\r\n      },\r\n\r\n      /** 整理成formData */\r\n      classifyIntoFormData(allValues) {\r\n        let main = Object.assign(this.model, allValues.formValue)\r\n        return {\r\n          ...main, // 展开\r\n          finPurInvoiceEntryList: allValues.tablesValue[0].values,\r\n        }\r\n      },\r\n\r\n      validateError(msg){\r\n        this.$message.error(msg)\r\n      },\r\n\r\n      popupCallback(row){\r\n        this.form.setFieldsValue(pick(row,'billNo','billDate','isAuto','invoiceType','isRubric',\r\n          'sourceType','sourceNo','clerkId','supplierId','attachment','remark',\r\n          'billProcStatus','approverId','flowId','isApproved','effectiveTime','isVoided','isClosed',\r\n          'sysOrgCode','createBy','createTime','updateBy','updateTime'))\r\n      },\r\n\r\n      handleSourceSelect() {\r\n        let queryParams = {};\r\n        queryParams['supplier_id'] = this.form.getFieldValue('supplierId');\r\n        this.$refs.selectModal.initQueryParams(queryParams);\r\n        this.$refs.selectModal.visible = true;\r\n      },\r\n\r\n      handleSourceSelectCallback(selectedRows){\r\n        if ( this.model.sourceId === selectedRows[0]['id']) return;\r\n\r\n        this.model.sourceId = selectedRows[0]['id'];\r\n        this.form.setFieldsValue({sourceNo: selectedRows[0]['bill_no'],\r\n          supplierId: selectedRows[0]['supplier_id']});\r\n\r\n        // 加载子表数据\r\n        let params = { id: this.model.sourceId }\r\n        this.requestSubTableData(this.url.finPurInvoiceEntry.list, params, this.sourceFinPurInvoiceEntryTable,\r\n          this.refreshDisabledRows);\r\n      },\r\n\r\n      handleAddEntry(){\r\n        let source = this.$refs.sourceFinPurInvoiceEntry,\r\n            target = this.$refs.finPurInvoiceEntry;\r\n\r\n        let { values } = source.getValuesSync({ validate: false, rowIds: source.selectedRowIds});\r\n        for(let v of values) {\r\n          let row = pick(v, 'entryNo','materialId','warehouseId','batchNo','settleQty','settleAmt','taxRate');\r\n          row.sourceType = 'fin_pur_invoice.fin_pur_invoice_entry';\r\n          row.sourceEntryId = v.id;\r\n          row.sourceEntryNo = this.form.getFieldValue(\"sourceNo\") + '.' + v.entryNo;\r\n          row.invoiceQty = -v.invoiceQty;\r\n          row.invoiceAmt = -v.invoiceAmt;\r\n          target.add();\r\n          let rowId = target.rows[target.rows.length - 1].id;\r\n          target.setValues([{rowKey: rowId, values: row}]);\r\n        }\r\n        this.refreshDisabledRows();\r\n      },\r\n\r\n      handleRemoveEntry(){\r\n        this.$refs.finPurInvoiceEntry.removeSelectedRows();\r\n        this.refreshDisabledRows();\r\n      },\r\n\r\n      refreshDisabledRows(){\r\n        let entryNos = [];\r\n        let { values } = this.$refs.finPurInvoiceEntry.getValuesSync({ validate: false});\r\n        for(let v of values) {\r\n          entryNos.push(Number(v.entryNo));\r\n        }\r\n        this.sourceFinPurInvoiceEntryTable.disabledRows = entryNos.length===0 ? {} : {entryNo:entryNos};\r\n        //disabledRowIds不初始会保留前面的数据，导致与disabledRows不一致！\r\n        this.$refs.sourceFinPurInvoiceEntry.disabledRowIds = [];\r\n        //使新的disabledRows生效\r\n        let dataSource = [...this.sourceFinPurInvoiceEntryTable.dataSource];\r\n        this.sourceFinPurInvoiceEntryTable.dataSource = dataSource;\r\n      },\r\n\r\n      validateRubric(type, value, row, column, callback, target) {\r\n        if (type !== 'blur') {\r\n          callback();\r\n          return;\r\n        }\r\n\r\n        let { values } = target.getValuesSync({ validate: false, rowIds: [row.id]});\r\n        let rubric = Number(values[0][column.key]);\r\n        if (isNaN(rubric)) {\r\n          callback();\r\n          return;\r\n        }\r\n\r\n        let sourceEntryId = values[0].sourceEntryId;\r\n        let rows = this.sourceFinPurInvoiceEntryTable.dataSource.filter(row => row.id === sourceEntryId);\r\n        let blue = rows[0][column.key]\r\n        if (isNaN(blue)) {\r\n          callback();\r\n          return;\r\n        }\r\n\r\n        if (-rubric > blue) {\r\n          callback(false, '不能超出蓝单！');\r\n          return;\r\n        }\r\n\r\n        callback(true); //true：通过验证\r\n      },\r\n\r\n    },\r\n\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .ant-row.ant-form-item {\r\n    margin-bottom: 12px;\r\n  }\r\n</style>\r\n"],"sourceRoot":"src/views/erp/finance/modules"}]}