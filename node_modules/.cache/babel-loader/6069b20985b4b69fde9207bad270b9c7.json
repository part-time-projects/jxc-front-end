{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\stock\\modules\\OtherOutBillModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\stock\\modules\\OtherOutBillModal.vue","mtime":1648374777646},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport pick from 'lodash.pick';\nimport { FormTypes, getRefPromise, VALIDATE_NO_PASSED, validateFormAndTables } from '@/utils/JEditableTableUtil';\nimport { JEditableTableMixin } from '@/mixins/JEditableTableMixin';\nimport JDate from '@/components/jeecg/JDate';\nimport JUpload from '@/components/jeecg/JUpload';\nimport JSelectUserByDep from '@/components/jeecgbiz/JSelectUserByDep';\nimport JDictSelectTag from \"@/components/dict/JDictSelectTag\";\nimport { getAction, putAction } from '@api/manage';\nimport { getFormatDate } from '../../utils/util';\nimport Vue from \"vue\";\nimport OnlCgreportSelectModal from '../../components/OnlCgreportSelectModal';\nexport default {\n  name: 'OtherOutBillModal',\n  mixins: [JEditableTableMixin],\n  components: {\n    JDate: JDate,\n    JUpload: JUpload,\n    JSelectUserByDep: JSelectUserByDep,\n    JDictSelectTag: JDictSelectTag,\n    OnlCgreportSelectModal: OnlCgreportSelectModal\n  },\n  data: function data() {\n    return {\n      action: '',\n      moreStatus: false,\n      width: '1200px',\n      spans: {\n        labelCol1: {\n          span: 2\n        },\n        wrapperCol1: {\n          span: 22\n        },\n        labelCol2: {\n          span: 4\n        },\n        wrapperCol2: {\n          span: 20\n        },\n        labelCol3: {\n          span: 6\n        },\n        wrapperCol3: {\n          span: 18\n        },\n        labelCol6: {\n          span: 12\n        },\n        wrapperCol6: {\n          span: 12\n        }\n      },\n      // 新增时子表默认添加几行空数据\n      addDefaultRowNum: 1,\n      validatorRules: {\n        stockIoType: {\n          rules: []\n        },\n        billNo: {\n          rules: [{\n            required: true,\n            message: '请输入单据编号!'\n          }]\n        },\n        billDate: {\n          rules: [{\n            required: true,\n            message: '请输入单据日期!'\n          }]\n        },\n        sourceType: {\n          rules: []\n        },\n        sourceId: {\n          rules: []\n        },\n        sourceNo: {\n          rules: []\n        },\n        clerkId: {\n          rules: []\n        },\n        handlerId: {\n          rules: []\n        },\n        hasRp: {\n          rules: []\n        },\n        isRubric: {\n          rules: []\n        },\n        isSameSettle: {\n          rules: []\n        },\n        supplierId: {\n          rules: []\n        },\n        customerId: {\n          rules: []\n        },\n        attachment: {\n          rules: []\n        },\n        remark: {\n          rules: []\n        },\n        billProcStatus: {\n          rules: []\n        },\n        approverId: {\n          rules: []\n        },\n        flowId: {\n          rules: []\n        },\n        isApproved: {\n          rules: []\n        },\n        effectiveTime: {\n          rules: []\n        },\n        isVoided: {\n          rules: []\n        },\n        isClosed: {\n          rules: []\n        },\n        sysOrgCode: {\n          rules: []\n        },\n        createBy: {\n          rules: []\n        },\n        createTime: {\n          rules: []\n        },\n        updateBy: {\n          rules: []\n        },\n        updateTime: {\n          rules: []\n        }\n      },\n      refKeys: ['stkIoBillEntry'],\n      tableKeys: ['stkIoBillEntry'],\n      activeKey: 'stkIoBillEntry',\n      // 明细\n      stkIoBillEntryTable: {\n        loading: false,\n        dataSource: [],\n        columns: [{\n          title: '分录号',\n          key: 'entryNo',\n          type: FormTypes.inputNumber,\n          width: \"60px\",\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^[1-9]\\d*$/,\n            message: '请输入零以上的正整数'\n          }, {\n            handler: this.validateEntryNoHandler\n          }]\n        }, {\n          //sourceType、sourceEntryId、sourceEntryNo应一起考虑\n          title: '源单分录号',\n          key: 'sourceEntryNo',\n          type: FormTypes.input,\n          width: \"180px\",\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '物料',\n          key: 'materialId',\n          type: FormTypes.sel_search,\n          dictCode: \"bas_material,name,id\",\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }],\n          options: []\n        }, {\n          title: '仓库',\n          key: 'warehouseId',\n          type: FormTypes.select,\n          dictCode: \"bas_warehouse,name,id\",\n          width: \"150px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          options: [],\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }]\n        }, {\n          title: '批次号',\n          key: 'batchNo',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }]\n        }, {\n          title: '',\n          key: 'batchNoSelectModal',\n          type: FormTypes.slot,\n          slotName: 'batchNoSelectModal',\n          orgFields: \"material_id,warehouse_id,batch_no,unit_id,unit_id,qty,cost,id\",\n          destFields: \"materialId,warehouseId,batchNo,unitId,inventoryUnitId,inventoryQty,inventoryCost,inventoryId\",\n          width: \"45px\"\n        }, {\n          title: '库存单位',\n          key: 'inventoryUnitId',\n          type: FormTypes.select,\n          dictCode: \"bas_measure_unit,name,id\",\n          width: \"100px\",\n          disabled: true\n        }, {\n          title: '库存数量',\n          key: 'inventoryQty',\n          type: FormTypes.input,\n          statistics: \"true\",\n          width: \"100px\",\n          disabled: true\n        }, {\n          title: '出库单位',\n          key: 'unitId',\n          type: FormTypes.select,\n          dictCode: \"bas_measure_unit,name,id\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }],\n          options: []\n        }, {\n          title: '出库数量',\n          key: 'qty',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            handler: this.validateQtyHandler\n          }]\n        }, {\n          title: '出库成本',\n          key: 'cost',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '库存批次id',\n          key: 'inventoryId',\n          type: FormTypes.hidden,\n          width: \"10px\",\n          disabled: true\n        }, {\n          title: '库存成本',\n          key: 'inventoryCost',\n          type: FormTypes.input,\n          statistics: \"true\",\n          width: \"100px\",\n          disabled: true\n        }, {\n          title: '备注',\n          key: 'remark',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '备注2',\n          key: 'remark2',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '备注3',\n          key: 'remark3',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }],\n        settingColumns: []\n      },\n      url: {\n        add: \"/stock/stkIoBill/add\",\n        edit: \"/stock/stkIoBill/edit\",\n        approve: \"/stock/stkIoBill/approve\",\n        stkIoBillEntry: {\n          list: '/stock/stkIoBill/queryEntryByMainId',\n          editingList: '/stock/stkIoBill/queryEditingEntryByMainId'\n        }\n      }\n    };\n  },\n  computed: {\n    readOnly: function readOnly() {\n      return this.action !== \"add\" && this.action !== \"edit\";\n    }\n  },\n  methods: {\n    getAllTable: function getAllTable() {\n      var _this = this;\n\n      var values = this.tableKeys.map(function (key) {\n        return getRefPromise(_this, key);\n      });\n      return Promise.all(values);\n    },\n    addInit: function addInit() {\n      //销售出库\n      this.model.stockIoType = '299';\n      this.model.isRubric = 0; //是否有往来\n\n      this.model.hasRp = 0; //结算是否同出库（或取自系统参数）\n\n      this.model.isSameSettle = 0; //处理状态：编辑中\n\n      this.model.billProcStatus = '12'; // 请求后台的填值规则接口地址\n\n      var url = '/sys/fillRule/executeRuleByCode/';\n      var ruleCode = 'stock_io_bill_no';\n      var that = this;\n      putAction(url + ruleCode, {}).then(function (res) {\n        // 执行成功，获取返回的值，并赋到页面上\n        if (res.success) {\n          that.model.billNo = res.result;\n          that.$nextTick(function () {\n            that.form.setFieldsValue({\n              'billNo': res.result,\n              'billDate': getFormatDate()\n            });\n          });\n        }\n      });\n    },\n\n    /** 调用完edit()方法之后会自动调用此方法 */\n    editAfter: function editAfter() {\n      var _this2 = this;\n\n      if (this.action === 'add') {\n        this.addInit();\n      }\n\n      var fieldval = pick(this.model, 'billNo', 'billDate', 'sourceType', 'sourceId', 'sourceNo', 'clerkId', 'handlerId', 'isRubric', 'supplierId', 'customerId', 'attachment', 'remark', 'billProcStatus', 'approverId', 'flowId', 'isApproved', 'effectiveTime', 'isVoided', 'isClosed', 'sysOrgCode', 'createBy', 'createTime', 'updateBy', 'updateTime');\n      this.$nextTick(function () {\n        return _this2.form.setFieldsValue(fieldval);\n      }); // 加载子表数据\n\n      if (this.model.id) {\n        var params = {\n          id: this.model.id\n        };\n        var url = this.readOnly ? this.url.stkIoBillEntry.list : this.url.stkIoBillEntry.editingList;\n        this.requestSubTableData(url, params, this.stkIoBillEntryTable);\n      }\n    },\n\n    /** 整理成formData */\n    classifyIntoFormData: function classifyIntoFormData(allValues) {\n      var main = Object.assign(this.model, allValues.formValue);\n      return _objectSpread({}, main, {\n        // 展开\n        stkIoBillEntryList: allValues.tablesValue[0].values\n      });\n    },\n    validateError: function validateError(msg) {\n      this.$message.error(msg);\n    },\n    popupCallback: function popupCallback(row) {\n      this.form.setFieldsValue(pick(row, 'billNo', 'billDate', 'sourceType', 'sourceId', 'sourceNo', 'clerkId', 'handlerId', 'isRubric', 'supplierId', 'customerId', 'attachment', 'remark', 'billProcStatus', 'approverId', 'flowId', 'isApproved', 'effectiveTime', 'isVoided', 'isClosed', 'sysOrgCode', 'createBy', 'createTime', 'updateBy', 'updateTime'));\n    },\n    handleSave: function handleSave() {\n      this.handleOk();\n    },\n    handleSubmit: function handleSubmit() {\n      var _this3 = this;\n\n      //处理状态=编辑完成\n      this.form.setFieldsValue({\n        billProcStatus: '13'\n      });\n      /** 触发表单验证 */\n\n      this.getAllTable().then(function (tables) {\n        /** 一次性验证主表和所有的次表 */\n        return validateFormAndTables(_this3.form, tables);\n      }).then(function (allValues) {\n        if (typeof _this3.classifyIntoFormData !== 'function') {\n          throw _this3.throwNotFunction('classifyIntoFormData');\n        }\n\n        var formData = _this3.classifyIntoFormData(allValues); // 发起请求\n\n\n        return _this3.request(formData);\n      }).catch(function (e) {\n        //处理状态=编辑中\n        _this3.form.setFieldsValue({\n          billProcStatus: '12'\n        });\n\n        if (e.error === VALIDATE_NO_PASSED) {\n          // 如果有未通过表单验证的子表，就自动跳转到它所在的tab\n          _this3.activeKey = e.index == null ? _this3.activeKey : _this3.refKeys[e.index];\n        } else {\n          console.error(e);\n        }\n      });\n    },\n    handleApproved: function handleApproved() {\n      var that = this;\n      putAction(that.url.approve, {\n        id: that.model.id\n      }).then(function (res) {\n        if (res.success) {\n          that.$message.success(res.message);\n          that.$emit('ok');\n          that.close();\n        } else {\n          that.$message.warning(res.message);\n        }\n      });\n    },\n    handleToggleMore: function handleToggleMore() {\n      this.moreStatus = !this.moreStatus;\n    },\n    //列设置更改事件\n    onColSettingsChange: function onColSettingsChange(checkedValues) {\n      var key = this.$route.name + \"/stkIoBillEntryTable:colsettings\";\n      Vue.ls.set(key, checkedValues, 7 * 24 * 60 * 60 * 1000);\n      this.stkIoBillEntryTable.settingColumns = checkedValues;\n      this.stkIoBillEntryTable.columns.forEach(function (item, i, array) {\n        if (checkedValues.includes(item.key)) {\n          if (item.typeDef !== undefined && item.typeDef !== null && item.typeDef !== \"\" && item.typeDef !== FormTypes.hidden) {\n            item.type = item.typeDef;\n          }\n        } else if (item.type !== FormTypes.hidden) {\n          item.typeDef = item.type;\n          item.type = FormTypes.hidden;\n        }\n      });\n    },\n    initColumns: function initColumns() {\n      //权限过滤（列权限控制时打开，修改第二个参数为授权码前缀）\n      //this.defColumns = colAuthFilter(this.defColumns,'testdemo:');\n      var key = this.$route.name + \"/stkIoBillEntryTable:colsettings\";\n      var colSettings = Vue.ls.get(key);\n      var that = this;\n\n      if (colSettings == null) {\n        this.stkIoBillEntryTable.columns.forEach(function (item, i, array) {\n          that.stkIoBillEntryTable.settingColumns.push(item.key);\n        });\n      } else {\n        this.stkIoBillEntryTable.settingColumns = colSettings;\n        this.stkIoBillEntryTable.columns.forEach(function (item, i, array) {\n          if (colSettings.includes(item.key)) {\n            if (item.typeDef !== undefined && item.typeDef !== null && item.typeDef !== \"\" && item.typeDef !== FormTypes.hidden) {\n              item.type = item.typeDef;\n            }\n          } else {\n            item.typeDef = item.type;\n            item.type = FormTypes.hidden;\n          }\n        });\n      }\n    },\n    onOutEntryAdded: function onOutEntryAdded(event) {\n      var row = event.row,\n          target = event.target;\n\n      var _target$getValuesSync = target.getValuesSync({\n        validate: false\n      }),\n          values = _target$getValuesSync.values;\n\n      var maxEntryNo = 0;\n      var _iteratorNormalCompletion = true;\n      var _didIteratorError = false;\n      var _iteratorError = undefined;\n\n      try {\n        for (var _iterator = values[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n          var val = _step.value;\n          var entryNo = Number(val['entryNo']);\n          if (!isNaN(entryNo) && entryNo > maxEntryNo) maxEntryNo = entryNo;\n        }\n      } catch (err) {\n        _didIteratorError = true;\n        _iteratorError = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion && _iterator.return != null) {\n            _iterator.return();\n          }\n        } finally {\n          if (_didIteratorError) {\n            throw _iteratorError;\n          }\n        }\n      }\n\n      maxEntryNo += 10;\n      target.setValues([{\n        rowKey: row.id,\n        values: {\n          entryNo: maxEntryNo\n        }\n      }]);\n    },\n    //单元值改变一个字符就触发一次\n    onValueChange: function onValueChange(event) {\n      var type = event.type,\n          row = event.row,\n          column = event.column,\n          value = event.value,\n          target = event.target; //触发：物料ID、仓库id、批次号、出库数量触发，前三者引起库存数量、库存成本等变化，\n      //      这都需要重新计算，所以：简化为每次change都计算。\n      //联动：出库成本\n\n      var qty = Number(value),\n          inventoryQty = Number(row.inventoryQty),\n          inventoryConst = Number(row.inventoryCost);\n\n      if (!isNaN(qty) && !isNaN(inventoryQty) && !isNaN(inventoryConst) && inventoryQty > 0 && row.unitId && row.unitId !== \"\" && row.inventoryUnitId && row.inventoryUnitId !== \"\") {\n        var key = row.unitId + \"/\" + row.inventoryUnitId;\n        var rate = row.unitId === row.inventoryUnitId ? 1 : Vue.ls.get(key);\n\n        if (rate == null) {\n          var url = '/bas/basMeasureUnit/getRate';\n          var params = {\n            toId: row.unitId,\n            fromId: row.inventoryUnitId\n          };\n          getAction(url, params).then(function (res) {\n            if (res.success) {\n              rate = res.result;\n              Vue.ls.set(key, rate, 7 * 24 * 60 * 60 * 1000);\n              var cost = inventoryConst * qty / (inventoryQty * rate);\n              cost = cost.toFixed(2);\n              target.setValues([{\n                rowKey: row.id,\n                values: {\n                  cost: cost\n                }\n              }]);\n            }\n          });\n        } else {\n          var cost = inventoryConst * qty / (inventoryQty * rate);\n          cost = cost.toFixed(2);\n          target.setValues([{\n            rowKey: row.id,\n            values: {\n              cost: cost\n            }\n          }]);\n        }\n      }\n    },\n    handleBatchNoSelect: function handleBatchNoSelect(props) {\n      var row = props.getValue();\n      var orgFields = props.column.orgFields.split(',');\n      var destFields = props.column.destFields.split(',');\n      var queryParams = {};\n\n      for (var i = 0; i < orgFields.length; i++) {\n        queryParams[orgFields[i]] = row[destFields[i]];\n      }\n\n      this.$refs.selectModal.initQueryParams(queryParams);\n      this.$refs.selectModal.visible = true;\n    },\n    handleBatchNoSelectCallback: function handleBatchNoSelectCallback(props, selectedRows) {\n      var rowId = props.rowId,\n          target = props.target;\n      var orgFields = props.column.orgFields.split(',');\n      var destFields = props.column.destFields.split(',');\n\n      for (var i = 0; i < selectedRows.length; i++) {\n        var values = {};\n\n        for (var j = 0; j < orgFields.length; j++) {\n          values[destFields[j]] = selectedRows[i][orgFields[j]];\n        }\n\n        if (i === 0) {\n          target.setValues([{\n            rowKey: rowId,\n            values: values\n          }]);\n        } else {\n          target.add();\n          var rowId2 = target.rows[target.rows.length - 1].id;\n          target.setValues([{\n            rowKey: rowId2,\n            values: values\n          }]);\n        }\n      }\n    },\n    validateEntryNoHandler: function validateEntryNoHandler(type, value, row, column, callback, target) {\n      if (type !== 'blur') {\n        callback(); //无参或者null：不做操作\n\n        return;\n      }\n\n      var _target$getValuesSync2 = target.getValuesSync({\n        validate: false\n      }),\n          values = _target$getValuesSync2.values;\n\n      var count = 0;\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = values[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var val = _step2.value;\n\n          if (Number(val['entryNo']) === Number(value)) {\n            if (++count >= 2) {\n              callback(false, '${title}不能重复');\n              return;\n            }\n          }\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      callback(true); //true：通过验证\n    },\n    validateQtyHandler: function validateQtyHandler(type, value, row, column, callback, target) {\n      if (type !== 'blur') {\n        callback();\n        return;\n      }\n\n      var _target$getValuesSync3 = target.getValuesSync({\n        validate: false,\n        rowIds: [row.id]\n      }),\n          values = _target$getValuesSync3.values;\n\n      var inventoryQty = Number(values[0].inventoryQty);\n      var qty = Number(value);\n\n      if (isNaN(qty) || isNaN(inventoryQty)) {\n        callback();\n        return;\n      }\n\n      if (qty > inventoryQty) {\n        callback(false, '不能大于库存数量！');\n        return;\n      }\n\n      var inventoryId = values[0].inventoryId;\n\n      if (!inventoryId) {\n        callback();\n        return;\n      }\n\n      var totalQty = 0;\n      var obj = target.getValuesSync({\n        validate: false\n      });\n      values = obj.values;\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = values[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var v = _step3.value;\n          qty = Number(v.qty);\n          if (!isNaN(qty)) totalQty += qty;\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      if (totalQty > inventoryQty) {\n        callback(false, '该库存批次的出库数量合计不能大于库存数量！');\n      } else {\n        callback(true);\n      }\n    }\n  },\n  created: function created() {\n    this.initColumns();\n  }\n};",{"version":3,"sources":["OtherOutBillModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgNA,OAAA,IAAA,MAAA,aAAA;AACA,SAAA,SAAA,EAAA,aAAA,EAAA,kBAAA,EAAA,qBAAA,QAAA,4BAAA;AACA,SAAA,mBAAA,QAAA,8BAAA;AACA,OAAA,KAAA,MAAA,0BAAA;AACA,OAAA,OAAA,MAAA,4BAAA;AACA,OAAA,gBAAA,MAAA,wCAAA;AACA,OAAA,cAAA,MAAA,kCAAA;AACA,SAAA,SAAA,EAAA,SAAA,QAAA,aAAA;AACA,SAAA,aAAA,QAAA,kBAAA;AACA,OAAA,GAAA,MAAA,KAAA;AACA,OAAA,sBAAA,MAAA,yCAAA;AAEA,eAAA;AACA,EAAA,IAAA,EAAA,mBADA;AAEA,EAAA,MAAA,EAAA,CAAA,mBAAA,CAFA;AAGA,EAAA,UAAA,EAAA;AACA,IAAA,KAAA,EAAA,KADA;AAEA,IAAA,OAAA,EAAA,OAFA;AAGA,IAAA,gBAAA,EAAA,gBAHA;AAIA,IAAA,cAAA,EAAA,cAJA;AAKA,IAAA,sBAAA,EAAA;AALA,GAHA;AAUA,EAAA,IAVA,kBAUA;AACA,WAAA;AACA,MAAA,MAAA,EAAA,EADA;AAEA,MAAA,UAAA,EAAA,KAFA;AAGA,MAAA,KAAA,EAAA,QAHA;AAIA,MAAA,KAAA,EAAA;AACA,QAAA,SAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SADA;AAEA,QAAA,WAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SAFA;AAGA,QAAA,SAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SAHA;AAIA,QAAA,WAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SAJA;AAKA,QAAA,SAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SALA;AAMA,QAAA,WAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SANA;AAOA,QAAA,SAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA,SAPA;AAQA,QAAA,WAAA,EAAA;AAAA,UAAA,IAAA,EAAA;AAAA;AARA,OAJA;AAeA;AACA,MAAA,gBAAA,EAAA,CAhBA;AAiBA,MAAA,cAAA,EAAA;AACA,QAAA,WAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SADA;AAGA,QAAA,MAAA,EAAA;AAAA,UAAA,KAAA,EAAA,CACA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WADA;AAAA,SAHA;AAMA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA,CACA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WADA;AAAA,SANA;AASA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SATA;AAWA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAXA;AAaA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAbA;AAeA,QAAA,OAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAfA;AAiBA,QAAA,SAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAjBA;AAmBA,QAAA,KAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAnBA;AAqBA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SArBA;AAuBA,QAAA,YAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAvBA;AAyBA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAzBA;AA2BA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SA3BA;AA6BA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SA7BA;AA+BA,QAAA,MAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SA/BA;AAiCA,QAAA,cAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAjCA;AAmCA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAnCA;AAqCA,QAAA,MAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SArCA;AAuCA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAvCA;AAyCA,QAAA,aAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAzCA;AA2CA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SA3CA;AA6CA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SA7CA;AA+CA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SA/CA;AAiDA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAjDA;AAmDA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SAnDA;AAqDA,QAAA,QAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA,SArDA;AAuDA,QAAA,UAAA,EAAA;AAAA,UAAA,KAAA,EAAA;AAAA;AAvDA,OAjBA;AA2EA,MAAA,OAAA,EAAA,CAAA,gBAAA,CA3EA;AA4EA,MAAA,SAAA,EAAA,CAAA,gBAAA,CA5EA;AA6EA,MAAA,SAAA,EAAA,gBA7EA;AA8EA;AACA,MAAA,mBAAA,EAAA;AACA,QAAA,OAAA,EAAA,KADA;AAEA,QAAA,UAAA,EAAA,EAFA;AAGA,QAAA,OAAA,EAAA,CACA;AACA,UAAA,KAAA,EAAA,KADA;AAEA,UAAA,GAAA,EAAA,SAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,WAHA;AAIA,UAAA,KAAA,EAAA,MAJA;AAKA,UAAA,aAAA,EAAA,CACA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WADA,EAEA;AAAA,YAAA,OAAA,EAAA,YAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WAFA,EAGA;AAAA,YAAA,OAAA,EAAA,KAAA;AAAA,WAHA;AALA,SADA,EAWA;AAAA;AACA,UAAA,KAAA,EAAA,OADA;AAEA,UAAA,GAAA,EAAA,eAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,KAAA,EAAA,OAJA;AAKA,UAAA,YAAA,EAAA,EALA;AAMA,UAAA,QAAA,EAAA;AANA,SAXA,EAmBA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,GAAA,EAAA,YAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,UAHA;AAIA,UAAA,QAAA,EAAA,sBAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,WAAA,EAAA,aANA;AAOA,UAAA,YAAA,EAAA,EAPA;AAQA,UAAA,aAAA,EAAA,CAAA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WAAA,CARA;AASA,UAAA,OAAA,EAAA;AATA,SAnBA,EA8BA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,GAAA,EAAA,aAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,MAHA;AAIA,UAAA,QAAA,EAAA,uBAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,WAAA,EAAA,aANA;AAOA,UAAA,YAAA,EAAA,EAPA;AAQA,UAAA,OAAA,EAAA,EARA;AASA,UAAA,aAAA,EAAA,CAAA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WAAA;AATA,SA9BA,EAyCA;AACA,UAAA,KAAA,EAAA,KADA;AAEA,UAAA,GAAA,EAAA,SAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,KAAA,EAAA,OAJA;AAKA,UAAA,WAAA,EAAA,aALA;AAMA,UAAA,YAAA,EAAA,EANA;AAOA,UAAA,aAAA,EAAA,CAAA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WAAA;AAPA,SAzCA,EAkDA;AACA,UAAA,KAAA,EAAA,EADA;AAEA,UAAA,GAAA,EAAA,oBAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,IAHA;AAIA,UAAA,QAAA,EAAA,oBAJA;AAKA,UAAA,SAAA,EAAA,+DALA;AAMA,UAAA,UAAA,EAAA,8FANA;AAOA,UAAA,KAAA,EAAA;AAPA,SAlDA,EA2DA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,GAAA,EAAA,iBAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,MAHA;AAIA,UAAA,QAAA,EAAA,0BAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,QAAA,EAAA;AANA,SA3DA,EAmEA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,GAAA,EAAA,cAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,UAAA,EAAA,MAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,QAAA,EAAA;AANA,SAnEA,EA2EA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,GAAA,EAAA,QAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,MAHA;AAIA,UAAA,QAAA,EAAA,0BAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,WAAA,EAAA,aANA;AAOA,UAAA,YAAA,EAAA,EAPA;AAQA,UAAA,aAAA,EAAA,CAAA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WAAA,CARA;AASA,UAAA,OAAA,EAAA;AATA,SA3EA,EAsFA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,GAAA,EAAA,KAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,WAHA;AAIA,UAAA,UAAA,EAAA,MAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,WAAA,EAAA,aANA;AAOA,UAAA,YAAA,EAAA,EAPA;AAQA,UAAA,aAAA,EAAA,CACA;AAAA,YAAA,QAAA,EAAA,IAAA;AAAA,YAAA,OAAA,EAAA;AAAA,WADA,EAEA;AAAA,YAAA,OAAA,EAAA,KAAA;AAAA,WAFA;AARA,SAtFA,EAkGA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,GAAA,EAAA,MAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,WAHA;AAIA,UAAA,UAAA,EAAA,MAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,WAAA,EAAA,aANA;AAOA,UAAA,YAAA,EAAA,EAPA;AAQA,UAAA,QAAA,EAAA;AARA,SAlGA,EA4GA;AACA,UAAA,KAAA,EAAA,QADA;AAEA,UAAA,GAAA,EAAA,aAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,MAHA;AAIA,UAAA,KAAA,EAAA,MAJA;AAKA,UAAA,QAAA,EAAA;AALA,SA5GA,EAmHA;AACA,UAAA,KAAA,EAAA,MADA;AAEA,UAAA,GAAA,EAAA,eAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,UAAA,EAAA,MAJA;AAKA,UAAA,KAAA,EAAA,OALA;AAMA,UAAA,QAAA,EAAA;AANA,SAnHA,EA2HA;AACA,UAAA,KAAA,EAAA,IADA;AAEA,UAAA,GAAA,EAAA,QAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,KAAA,EAAA,OAJA;AAKA,UAAA,WAAA,EAAA,aALA;AAMA,UAAA,YAAA,EAAA;AANA,SA3HA,EAmIA;AACA,UAAA,KAAA,EAAA,KADA;AAEA,UAAA,GAAA,EAAA,SAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,KAAA,EAAA,OAJA;AAKA,UAAA,WAAA,EAAA,aALA;AAMA,UAAA,YAAA,EAAA;AANA,SAnIA,EA2IA;AACA,UAAA,KAAA,EAAA,KADA;AAEA,UAAA,GAAA,EAAA,SAFA;AAGA,UAAA,IAAA,EAAA,SAAA,CAAA,KAHA;AAIA,UAAA,KAAA,EAAA,OAJA;AAKA,UAAA,WAAA,EAAA,aALA;AAMA,UAAA,YAAA,EAAA;AANA,SA3IA,CAHA;AAuJA,QAAA,cAAA,EAAA;AAvJA,OA/EA;AAwOA,MAAA,GAAA,EAAA;AACA,QAAA,GAAA,EAAA,sBADA;AAEA,QAAA,IAAA,EAAA,uBAFA;AAGA,QAAA,OAAA,EAAA,0BAHA;AAIA,QAAA,cAAA,EAAA;AACA,UAAA,IAAA,EAAA,qCADA;AAEA,UAAA,WAAA,EAAA;AAFA;AAJA;AAxOA,KAAA;AAkPA,GA7PA;AA+PA,EAAA,QAAA,EAAA;AACA,IAAA,QAAA,EAAA,oBAAA;AACA,aAAA,KAAA,MAAA,KAAA,KAAA,IAAA,KAAA,MAAA,KAAA,MAAA;AACA;AAHA,GA/PA;AAqQA,EAAA,OAAA,EAAA;AACA,IAAA,WADA,yBACA;AAAA;;AACA,UAAA,MAAA,GAAA,KAAA,SAAA,CAAA,GAAA,CAAA,UAAA,GAAA;AAAA,eAAA,aAAA,CAAA,KAAA,EAAA,GAAA,CAAA;AAAA,OAAA,CAAA;AACA,aAAA,OAAA,CAAA,GAAA,CAAA,MAAA,CAAA;AACA,KAJA;AAMA,IAAA,OANA,qBAMA;AACA;AACA,WAAA,KAAA,CAAA,WAAA,GAAA,KAAA;AACA,WAAA,KAAA,CAAA,QAAA,GAAA,CAAA,CAHA,CAIA;;AACA,WAAA,KAAA,CAAA,KAAA,GAAA,CAAA,CALA,CAMA;;AACA,WAAA,KAAA,CAAA,YAAA,GAAA,CAAA,CAPA,CAQA;;AACA,WAAA,KAAA,CAAA,cAAA,GAAA,IAAA,CATA,CAWA;;AACA,UAAA,GAAA,GAAA,kCAAA;AACA,UAAA,QAAA,GAAA,kBAAA;AACA,UAAA,IAAA,GAAA,IAAA;AACA,MAAA,SAAA,CAAA,GAAA,GAAA,QAAA,EAAA,EAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA;AACA,YAAA,GAAA,CAAA,OAAA,EAAA;AACA,UAAA,IAAA,CAAA,KAAA,CAAA,MAAA,GAAA,GAAA,CAAA,MAAA;AACA,UAAA,IAAA,CAAA,SAAA,CAAA,YAAA;AACA,YAAA,IAAA,CAAA,IAAA,CAAA,cAAA,CAAA;AAAA,wBAAA,GAAA,CAAA,MAAA;AAAA,0BAAA,aAAA;AAAA,aAAA;AACA,WAFA;AAGA;AACA,OARA;AASA,KA9BA;;AA+BA;AACA,IAAA,SAhCA,uBAgCA;AAAA;;AACA,UAAA,KAAA,MAAA,KAAA,KAAA,EAAA;AACA,aAAA,OAAA;AACA;;AAEA,UAAA,QAAA,GAAA,IAAA,CAAA,KAAA,KAAA,EAAA,QAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,UAAA,EAAA,SAAA,EAAA,WAAA,EAAA,UAAA,EAAA,YAAA,EAAA,YAAA,EAAA,YAAA,EAAA,QAAA,EAAA,gBAAA,EAAA,YAAA,EAAA,QAAA,EAAA,YAAA,EAAA,eAAA,EAAA,UAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,YAAA,CAAA;AACA,WAAA,SAAA,CAAA;AAAA,eAAA,MAAA,CAAA,IAAA,CAAA,cAAA,CAAA,QAAA,CAAA;AAAA,OAAA,EANA,CAOA;;AACA,UAAA,KAAA,KAAA,CAAA,EAAA,EAAA;AACA,YAAA,MAAA,GAAA;AAAA,UAAA,EAAA,EAAA,KAAA,KAAA,CAAA;AAAA,SAAA;AACA,YAAA,GAAA,GAAA,KAAA,QAAA,GAAA,KAAA,GAAA,CAAA,cAAA,CAAA,IAAA,GAAA,KAAA,GAAA,CAAA,cAAA,CAAA,WAAA;AACA,aAAA,mBAAA,CAAA,GAAA,EAAA,MAAA,EAAA,KAAA,mBAAA;AACA;AACA,KA7CA;;AA8CA;AACA,IAAA,oBA/CA,gCA+CA,SA/CA,EA+CA;AACA,UAAA,IAAA,GAAA,MAAA,CAAA,MAAA,CAAA,KAAA,KAAA,EAAA,SAAA,CAAA,SAAA,CAAA;AAEA,+BACA,IADA;AACA;AACA,QAAA,kBAAA,EAAA,SAAA,CAAA,WAAA,CAAA,CAAA,EAAA;AAFA;AAIA,KAtDA;AAuDA,IAAA,aAvDA,yBAuDA,GAvDA,EAuDA;AACA,WAAA,QAAA,CAAA,KAAA,CAAA,GAAA;AACA,KAzDA;AA0DA,IAAA,aA1DA,yBA0DA,GA1DA,EA0DA;AACA,WAAA,IAAA,CAAA,cAAA,CAAA,IAAA,CAAA,GAAA,EAAA,QAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,UAAA,EAAA,SAAA,EAAA,WAAA,EAAA,UAAA,EAAA,YAAA,EAAA,YAAA,EAAA,YAAA,EAAA,QAAA,EAAA,gBAAA,EAAA,YAAA,EAAA,QAAA,EAAA,YAAA,EAAA,eAAA,EAAA,UAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,YAAA,EAAA,UAAA,EAAA,YAAA,CAAA;AACA,KA5DA;AA8DA,IAAA,UA9DA,wBA8DA;AACA,WAAA,QAAA;AACA,KAhEA;AAiEA,IAAA,YAjEA,0BAiEA;AAAA;;AACA;AACA,WAAA,IAAA,CAAA,cAAA,CAAA;AAAA,QAAA,cAAA,EAAA;AAAA,OAAA;AAEA;;AACA,WAAA,WAAA,GAAA,IAAA,CAAA,UAAA,MAAA,EAAA;AACA;AACA,eAAA,qBAAA,CAAA,MAAA,CAAA,IAAA,EAAA,MAAA,CAAA;AACA,OAHA,EAGA,IAHA,CAGA,UAAA,SAAA,EAAA;AACA,YAAA,OAAA,MAAA,CAAA,oBAAA,KAAA,UAAA,EAAA;AACA,gBAAA,MAAA,CAAA,gBAAA,CAAA,sBAAA,CAAA;AACA;;AACA,YAAA,QAAA,GAAA,MAAA,CAAA,oBAAA,CAAA,SAAA,CAAA,CAJA,CAKA;;;AACA,eAAA,MAAA,CAAA,OAAA,CAAA,QAAA,CAAA;AACA,OAVA,EAUA,KAVA,CAUA,UAAA,CAAA,EAAA;AACA;AACA,QAAA,MAAA,CAAA,IAAA,CAAA,cAAA,CAAA;AAAA,UAAA,cAAA,EAAA;AAAA,SAAA;;AAEA,YAAA,CAAA,CAAA,KAAA,KAAA,kBAAA,EAAA;AACA;AACA,UAAA,MAAA,CAAA,SAAA,GAAA,CAAA,CAAA,KAAA,IAAA,IAAA,GAAA,MAAA,CAAA,SAAA,GAAA,MAAA,CAAA,OAAA,CAAA,CAAA,CAAA,KAAA,CAAA;AACA,SAHA,MAGA;AACA,UAAA,OAAA,CAAA,KAAA,CAAA,CAAA;AACA;AACA,OApBA;AAqBA,KA3FA;AA6FA,IAAA,cA7FA,4BA6FA;AACA,UAAA,IAAA,GAAA,IAAA;AACA,MAAA,SAAA,CAAA,IAAA,CAAA,GAAA,CAAA,OAAA,EAAA;AAAA,QAAA,EAAA,EAAA,IAAA,CAAA,KAAA,CAAA;AAAA,OAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,YAAA,GAAA,CAAA,OAAA,EAAA;AACA,UAAA,IAAA,CAAA,QAAA,CAAA,OAAA,CAAA,GAAA,CAAA,OAAA;AACA,UAAA,IAAA,CAAA,KAAA,CAAA,IAAA;AACA,UAAA,IAAA,CAAA,KAAA;AACA,SAJA,MAIA;AACA,UAAA,IAAA,CAAA,QAAA,CAAA,OAAA,CAAA,GAAA,CAAA,OAAA;AACA;AACA,OARA;AASA,KAxGA;AA0GA,IAAA,gBA1GA,8BA0GA;AACA,WAAA,UAAA,GAAA,CAAA,KAAA,UAAA;AACA,KA5GA;AA8GA;AACA,IAAA,mBA/GA,+BA+GA,aA/GA,EA+GA;AACA,UAAA,GAAA,GAAA,KAAA,MAAA,CAAA,IAAA,GAAA,kCAAA;AACA,MAAA,GAAA,CAAA,EAAA,CAAA,GAAA,CAAA,GAAA,EAAA,aAAA,EAAA,IAAA,EAAA,GAAA,EAAA,GAAA,EAAA,GAAA,IAAA;AACA,WAAA,mBAAA,CAAA,cAAA,GAAA,aAAA;AACA,WAAA,mBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA,CAAA,EAAA,KAAA,EAAA;AACA,YAAA,aAAA,CAAA,QAAA,CAAA,IAAA,CAAA,GAAA,CAAA,EAAA;AACA,cAAA,IAAA,CAAA,OAAA,KAAA,SAAA,IAAA,IAAA,CAAA,OAAA,KAAA,IAAA,IACA,IAAA,CAAA,OAAA,KAAA,EADA,IACA,IAAA,CAAA,OAAA,KAAA,SAAA,CAAA,MADA,EACA;AACA,YAAA,IAAA,CAAA,IAAA,GAAA,IAAA,CAAA,OAAA;AACA;AACA,SALA,MAKA,IAAA,IAAA,CAAA,IAAA,KAAA,SAAA,CAAA,MAAA,EAAA;AACA,UAAA,IAAA,CAAA,OAAA,GAAA,IAAA,CAAA,IAAA;AACA,UAAA,IAAA,CAAA,IAAA,GAAA,SAAA,CAAA,MAAA;AACA;AACA,OAVA;AAWA,KA9HA;AAgIA,IAAA,WAhIA,yBAgIA;AACA;AACA;AAEA,UAAA,GAAA,GAAA,KAAA,MAAA,CAAA,IAAA,GAAA,kCAAA;AACA,UAAA,WAAA,GAAA,GAAA,CAAA,EAAA,CAAA,GAAA,CAAA,GAAA,CAAA;AACA,UAAA,IAAA,GAAA,IAAA;;AACA,UAAA,WAAA,IAAA,IAAA,EAAA;AACA,aAAA,mBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA,CAAA,EAAA,KAAA,EAAA;AACA,UAAA,IAAA,CAAA,mBAAA,CAAA,cAAA,CAAA,IAAA,CAAA,IAAA,CAAA,GAAA;AACA,SAFA;AAGA,OAJA,MAIA;AACA,aAAA,mBAAA,CAAA,cAAA,GAAA,WAAA;AACA,aAAA,mBAAA,CAAA,OAAA,CAAA,OAAA,CAAA,UAAA,IAAA,EAAA,CAAA,EAAA,KAAA,EAAA;AACA,cAAA,WAAA,CAAA,QAAA,CAAA,IAAA,CAAA,GAAA,CAAA,EAAA;AACA,gBAAA,IAAA,CAAA,OAAA,KAAA,SAAA,IAAA,IAAA,CAAA,OAAA,KAAA,IAAA,IACA,IAAA,CAAA,OAAA,KAAA,EADA,IACA,IAAA,CAAA,OAAA,KAAA,SAAA,CAAA,MADA,EACA;AACA,cAAA,IAAA,CAAA,IAAA,GAAA,IAAA,CAAA,OAAA;AACA;AACA,WALA,MAKA;AACA,YAAA,IAAA,CAAA,OAAA,GAAA,IAAA,CAAA,IAAA;AACA,YAAA,IAAA,CAAA,IAAA,GAAA,SAAA,CAAA,MAAA;AACA;AACA,SAVA;AAWA;AACA,KAzJA;AA2JA,IAAA,eA3JA,2BA2JA,KA3JA,EA2JA;AAAA,UACA,GADA,GACA,KADA,CACA,GADA;AAAA,UACA,MADA,GACA,KADA,CACA,MADA;;AAAA,kCAEA,MAAA,CAAA,aAAA,CAAA;AAAA,QAAA,QAAA,EAAA;AAAA,OAAA,CAFA;AAAA,UAEA,MAFA,yBAEA,MAFA;;AAGA,UAAA,UAAA,GAAA,CAAA;AAHA;AAAA;AAAA;;AAAA;AAIA,6BAAA,MAAA,8HAAA;AAAA,cAAA,GAAA;AACA,cAAA,OAAA,GAAA,MAAA,CAAA,GAAA,CAAA,SAAA,CAAA,CAAA;AACA,cAAA,CAAA,KAAA,CAAA,OAAA,CAAA,IAAA,OAAA,GAAA,UAAA,EAAA,UAAA,GAAA,OAAA;AACA;AAPA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAQA,MAAA,UAAA,IAAA,EAAA;AACA,MAAA,MAAA,CAAA,SAAA,CAAA,CAAA;AAAA,QAAA,MAAA,EAAA,GAAA,CAAA,EAAA;AAAA,QAAA,MAAA,EAAA;AAAA,UAAA,OAAA,EAAA;AAAA;AAAA,OAAA,CAAA;AACA,KArKA;AAuKA;AACA,IAAA,aAxKA,yBAwKA,KAxKA,EAwKA;AAAA,UACA,IADA,GACA,KADA,CACA,IADA;AAAA,UACA,GADA,GACA,KADA,CACA,GADA;AAAA,UACA,MADA,GACA,KADA,CACA,MADA;AAAA,UACA,KADA,GACA,KADA,CACA,KADA;AAAA,UACA,MADA,GACA,KADA,CACA,MADA,EAGA;AACA;AACA;;AACA,UAAA,GAAA,GAAA,MAAA,CAAA,KAAA,CAAA;AAAA,UACA,YAAA,GAAA,MAAA,CAAA,GAAA,CAAA,YAAA,CADA;AAAA,UAEA,cAAA,GAAA,MAAA,CAAA,GAAA,CAAA,aAAA,CAFA;;AAGA,UAAA,CAAA,KAAA,CAAA,GAAA,CAAA,IAAA,CAAA,KAAA,CAAA,YAAA,CAAA,IAAA,CAAA,KAAA,CAAA,cAAA,CAAA,IAAA,YAAA,GAAA,CAAA,IACA,GAAA,CAAA,MADA,IACA,GAAA,CAAA,MAAA,KAAA,EADA,IACA,GAAA,CAAA,eADA,IACA,GAAA,CAAA,eAAA,KAAA,EADA,EACA;AACA,YAAA,GAAA,GAAA,GAAA,CAAA,MAAA,GAAA,GAAA,GAAA,GAAA,CAAA,eAAA;AACA,YAAA,IAAA,GAAA,GAAA,CAAA,MAAA,KAAA,GAAA,CAAA,eAAA,GAAA,CAAA,GAAA,GAAA,CAAA,EAAA,CAAA,GAAA,CAAA,GAAA,CAAA;;AACA,YAAA,IAAA,IAAA,IAAA,EAAA;AACA,cAAA,GAAA,GAAA,6BAAA;AACA,cAAA,MAAA,GAAA;AAAA,YAAA,IAAA,EAAA,GAAA,CAAA,MAAA;AAAA,YAAA,MAAA,EAAA,GAAA,CAAA;AAAA,WAAA;AACA,UAAA,SAAA,CAAA,GAAA,EAAA,MAAA,CAAA,CAAA,IAAA,CAAA,UAAA,GAAA,EAAA;AACA,gBAAA,GAAA,CAAA,OAAA,EAAA;AACA,cAAA,IAAA,GAAA,GAAA,CAAA,MAAA;AACA,cAAA,GAAA,CAAA,EAAA,CAAA,GAAA,CAAA,GAAA,EAAA,IAAA,EAAA,IAAA,EAAA,GAAA,EAAA,GAAA,EAAA,GAAA,IAAA;AAEA,kBAAA,IAAA,GAAA,cAAA,GAAA,GAAA,IAAA,YAAA,GAAA,IAAA,CAAA;AACA,cAAA,IAAA,GAAA,IAAA,CAAA,OAAA,CAAA,CAAA,CAAA;AACA,cAAA,MAAA,CAAA,SAAA,CAAA,CAAA;AAAA,gBAAA,MAAA,EAAA,GAAA,CAAA,EAAA;AAAA,gBAAA,MAAA,EAAA;AAAA,kBAAA,IAAA,EAAA;AAAA;AAAA,eAAA,CAAA;AACA;AACA,WATA;AAUA,SAbA,MAcA;AACA,cAAA,IAAA,GAAA,cAAA,GAAA,GAAA,IAAA,YAAA,GAAA,IAAA,CAAA;AACA,UAAA,IAAA,GAAA,IAAA,CAAA,OAAA,CAAA,CAAA,CAAA;AACA,UAAA,MAAA,CAAA,SAAA,CAAA,CAAA;AAAA,YAAA,MAAA,EAAA,GAAA,CAAA,EAAA;AAAA,YAAA,MAAA,EAAA;AAAA,cAAA,IAAA,EAAA;AAAA;AAAA,WAAA,CAAA;AACA;AACA;AACA,KAzMA;AA2MA,IAAA,mBA3MA,+BA2MA,KA3MA,EA2MA;AACA,UAAA,GAAA,GAAA,KAAA,CAAA,QAAA,EAAA;AACA,UAAA,SAAA,GAAA,KAAA,CAAA,MAAA,CAAA,SAAA,CAAA,KAAA,CAAA,GAAA,CAAA;AACA,UAAA,UAAA,GAAA,KAAA,CAAA,MAAA,CAAA,UAAA,CAAA,KAAA,CAAA,GAAA,CAAA;AACA,UAAA,WAAA,GAAA,EAAA;;AACA,WAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,SAAA,CAAA,MAAA,EAAA,CAAA,EAAA,EAAA;AACA,QAAA,WAAA,CAAA,SAAA,CAAA,CAAA,CAAA,CAAA,GAAA,GAAA,CAAA,UAAA,CAAA,CAAA,CAAA,CAAA;AACA;;AACA,WAAA,KAAA,CAAA,WAAA,CAAA,eAAA,CAAA,WAAA;AACA,WAAA,KAAA,CAAA,WAAA,CAAA,OAAA,GAAA,IAAA;AACA,KArNA;AAuNA,IAAA,2BAvNA,uCAuNA,KAvNA,EAuNA,YAvNA,EAuNA;AAAA,UACA,KADA,GACA,KADA,CACA,KADA;AAAA,UACA,MADA,GACA,KADA,CACA,MADA;AAEA,UAAA,SAAA,GAAA,KAAA,CAAA,MAAA,CAAA,SAAA,CAAA,KAAA,CAAA,GAAA,CAAA;AACA,UAAA,UAAA,GAAA,KAAA,CAAA,MAAA,CAAA,UAAA,CAAA,KAAA,CAAA,GAAA,CAAA;;AACA,WAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,YAAA,CAAA,MAAA,EAAA,CAAA,EAAA,EAAA;AACA,YAAA,MAAA,GAAA,EAAA;;AACA,aAAA,IAAA,CAAA,GAAA,CAAA,EAAA,CAAA,GAAA,SAAA,CAAA,MAAA,EAAA,CAAA,EAAA,EAAA;AACA,UAAA,MAAA,CAAA,UAAA,CAAA,CAAA,CAAA,CAAA,GAAA,YAAA,CAAA,CAAA,CAAA,CAAA,SAAA,CAAA,CAAA,CAAA,CAAA;AACA;;AAEA,YAAA,CAAA,KAAA,CAAA,EAAA;AACA,UAAA,MAAA,CAAA,SAAA,CAAA,CAAA;AAAA,YAAA,MAAA,EAAA,KAAA;AAAA,YAAA,MAAA,EAAA;AAAA,WAAA,CAAA;AACA,SAFA,MAEA;AACA,UAAA,MAAA,CAAA,GAAA;AACA,cAAA,MAAA,GAAA,MAAA,CAAA,IAAA,CAAA,MAAA,CAAA,IAAA,CAAA,MAAA,GAAA,CAAA,EAAA,EAAA;AACA,UAAA,MAAA,CAAA,SAAA,CAAA,CAAA;AAAA,YAAA,MAAA,EAAA,MAAA;AAAA,YAAA,MAAA,EAAA;AAAA,WAAA,CAAA;AACA;AACA;AACA,KAzOA;AA2OA,IAAA,sBA3OA,kCA2OA,IA3OA,EA2OA,KA3OA,EA2OA,GA3OA,EA2OA,MA3OA,EA2OA,QA3OA,EA2OA,MA3OA,EA2OA;AACA,UAAA,IAAA,KAAA,MAAA,EAAA;AACA,QAAA,QAAA,GADA,CACA;;AACA;AACA;;AAJA,mCAMA,MAAA,CAAA,aAAA,CAAA;AAAA,QAAA,QAAA,EAAA;AAAA,OAAA,CANA;AAAA,UAMA,MANA,0BAMA,MANA;;AAOA,UAAA,KAAA,GAAA,CAAA;AAPA;AAAA;AAAA;;AAAA;AAQA,8BAAA,MAAA,mIAAA;AAAA,cAAA,GAAA;;AACA,cAAA,MAAA,CAAA,GAAA,CAAA,SAAA,CAAA,CAAA,KAAA,MAAA,CAAA,KAAA,CAAA,EAAA;AACA,gBAAA,EAAA,KAAA,IAAA,CAAA,EAAA;AACA,cAAA,QAAA,CAAA,KAAA,EAAA,cAAA,CAAA;AACA;AACA;AACA;AACA;AAfA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAgBA,MAAA,QAAA,CAAA,IAAA,CAAA,CAhBA,CAgBA;AACA,KA5PA;AA8PA,IAAA,kBA9PA,8BA8PA,IA9PA,EA8PA,KA9PA,EA8PA,GA9PA,EA8PA,MA9PA,EA8PA,QA9PA,EA8PA,MA9PA,EA8PA;AACA,UAAA,IAAA,KAAA,MAAA,EAAA;AACA,QAAA,QAAA;AACA;AACA;;AAJA,mCAMA,MAAA,CAAA,aAAA,CAAA;AAAA,QAAA,QAAA,EAAA,KAAA;AAAA,QAAA,MAAA,EAAA,CAAA,GAAA,CAAA,EAAA;AAAA,OAAA,CANA;AAAA,UAMA,MANA,0BAMA,MANA;;AAOA,UAAA,YAAA,GAAA,MAAA,CAAA,MAAA,CAAA,CAAA,CAAA,CAAA,YAAA,CAAA;AACA,UAAA,GAAA,GAAA,MAAA,CAAA,KAAA,CAAA;;AACA,UAAA,KAAA,CAAA,GAAA,CAAA,IAAA,KAAA,CAAA,YAAA,CAAA,EAAA;AACA,QAAA,QAAA;AACA;AACA;;AACA,UAAA,GAAA,GAAA,YAAA,EAAA;AACA,QAAA,QAAA,CAAA,KAAA,EAAA,WAAA,CAAA;AACA;AACA;;AAEA,UAAA,WAAA,GAAA,MAAA,CAAA,CAAA,CAAA,CAAA,WAAA;;AACA,UAAA,CAAA,WAAA,EAAA;AACA,QAAA,QAAA;AACA;AACA;;AACA,UAAA,QAAA,GAAA,CAAA;AACA,UAAA,GAAA,GAAA,MAAA,CAAA,aAAA,CAAA;AAAA,QAAA,QAAA,EAAA;AAAA,OAAA,CAAA;AACA,MAAA,MAAA,GAAA,GAAA,CAAA,MAAA;AAzBA;AAAA;AAAA;;AAAA;AA0BA,8BAAA,MAAA,mIAAA;AAAA,cAAA,CAAA;AACA,UAAA,GAAA,GAAA,MAAA,CAAA,CAAA,CAAA,GAAA,CAAA;AACA,cAAA,CAAA,KAAA,CAAA,GAAA,CAAA,EAAA,QAAA,IAAA,GAAA;AACA;AA7BA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AA8BA,UAAA,QAAA,GAAA,YAAA,EAAA;AACA,QAAA,QAAA,CAAA,KAAA,EAAA,uBAAA,CAAA;AACA,OAFA,MAEA;AACA,QAAA,QAAA,CAAA,IAAA,CAAA;AACA;AACA;AAjSA,GArQA;AAyiBA,EAAA,OAziBA,qBAyiBA;AACA,SAAA,WAAA;AACA;AA3iBA,CAAA","sourcesContent":["<template>\r\n  <j-modal\r\n    :title=\"'其他出库 - ' + title\"\r\n    :width=\"width\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    :maskClosable=\"false\"\r\n    :keyboard=\"false\"\r\n    :forceRender=\"true\"\r\n    switchFullscreen\r\n    @cancel=\"handleCancel\">\r\n\r\n    <template slot=\"footer\">\r\n      <a-button v-if=\"action!=='detail'\" key=\"cancel\" @click=\"handleCancel\">取消</a-button>\r\n      <a-button v-if=\"!readOnly\" key=\"save\"   @click=\"handleSave\" type=\"primary\" :loading=\"confirmLoading\">保存</a-button>\r\n      <a-button v-if=\"!readOnly\" key=\"submit\" @click=\"handleSubmit\" type=\"primary\" :loading=\"confirmLoading\">提交</a-button>\r\n      <a-button v-if=\"action==='detail'\"  key=\"close\"  @click=\"handleCancel\" type=\"primary\">关闭</a-button>\r\n      <a-button v-if=\"action==='approve'\"  key=\"approved\"  @click=\"handleApproved\" type=\"primary\">审核通过</a-button>\r\n    </template>\r\n\r\n    <a-spin :spinning=\"confirmLoading\">\r\n      <!-- 主表单区域 -->\r\n      <a-form :form=\"form\">\r\n        <a-row>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"处理状态\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['billProcStatus', validatorRules.billProcStatus]\" :trigger-change=\"true\" dictCode=\"x_bill_proc_status\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否通过\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isApproved', validatorRules.isApproved]\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否关闭\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isClosed', validatorRules.isClosed]\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否作废\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isVoided', validatorRules.isVoided]\" :trigger-change=\"true\" dictCode=\"yn\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a @click=\"handleToggleMore\" style=\"float: right; margin-top: 10px\">\r\n              {{ moreStatus ? '收起' : '展开' }}\r\n              <a-icon :type=\"moreStatus ? 'up' : 'down'\"/>\r\n            </a>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row v-show=\"moreStatus\">\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'createTime', validatorRules.createTime]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['createBy', validatorRules.createBy]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建部门\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['sysOrgCode', validatorRules.sysOrgCode]\" :trigger-change=\"true\" dictCode=\"sys_depart,depart_name,org_code\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"生效时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'effectiveTime', validatorRules.effectiveTime]\" :showTime=\"true\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"审核人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['approverId', validatorRules.approverId]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"流程\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'flowId', validatorRules.flowId]\" ></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"修改时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'updateTime', validatorRules.updateTime]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"修改人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['updateBy', validatorRules.updateBy]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"是否红字\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag type=\"list\" v-decorator=\"['isRubric', validatorRules.isRubric]\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"单据编号\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'billNo', validatorRules.billNo]\" ></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"单据日期\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"readOnly\" placeholder=\"请选择单据日期\" v-decorator=\"[ 'billDate', validatorRules.billDate]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item  label=\"制单人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled  type=\"list\" v-decorator=\"['createBy', validatorRules.createBy]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"源单类型\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag :disabled=\"readOnly\" type=\"list\" v-decorator=\"['sourceType', validatorRules.sourceType]\" :trigger-change=\"true\" dictCode=\"x_bill_type\" placeholder=\"请选择源单类型\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <!--sourceType、sourceId、sourceNo应一起考虑-->\r\n            <a-form-item label=\"源单号\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"readOnly\" v-decorator=\"[ 'sourceNo', validatorRules.sourceNo]\" placeholder=\"请输入源单号\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"业务员\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-select-user-by-dep :disabled=\"readOnly\" v-decorator=\"['clerkId', validatorRules.clerkId]\" :trigger-change=\"true\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"出库经办\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-select-user-by-dep :disabled=\"readOnly\" v-decorator=\"['handlerId', validatorRules.handlerId]\" :trigger-change=\"true\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"客户\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag :disabled=\"readOnly\" type=\"list\" v-decorator=\"['supplierId', validatorRules.customerId]\" :trigger-change=\"true\" dictCode=\"bas_customer,name,id\" placeholder=\"请选择客户\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row>\r\n          <a-col :span=\"24\">\r\n            <a-form-item label=\"备注\" :labelCol=\"spans.labelCol1\" :wrapperCol=\"spans.wrapperCol1\">\r\n              <a-textarea :readOnly=\"readOnly\" v-decorator=\"[ 'remark', validatorRules.remark]\"  rows=\"1\" autoSize></a-textarea>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"24\">\r\n            <a-form-item label=\"附件\" :labelCol=\"spans.labelCol1\" :wrapperCol=\"spans.wrapperCol1\">\r\n              <j-upload :disabled=\"readOnly\" v-decorator=\"['attachment', validatorRules.attachment]\" :trigger-change=\"true\"></j-upload>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n      </a-form>\r\n\r\n      <!-- 子表单区域 -->\r\n      <a-tabs v-model=\"activeKey\" @change=\"handleChangeTabs\">\r\n        <a-tab-pane tab=\"明细\" :key=\"refKeys[0]\" :forceRender=\"true\">\r\n          <j-editable-table\r\n            :disabled=\"readOnly\"\r\n            :ref=\"refKeys[0]\"\r\n            :loading=\"stkIoBillEntryTable.loading\"\r\n            :columns=\"stkIoBillEntryTable.columns\"\r\n            :dataSource=\"stkIoBillEntryTable.dataSource\"\r\n            :maxHeight=\"300\"\r\n            :rowNumber=\"false\"\r\n            :rowSelection=\"true\"\r\n            :actionButton=\"!readOnly\"\r\n            @valueChange=\"onValueChange\"\r\n            @added=\"onOutEntryAdded\">\r\n\r\n            <template v-slot:batchNoSelectModal=\"props\" style=\"padding-left: 0\">\r\n              <a-button @click=\"handleBatchNoSelect(props)\" icon=\"ellipsis\"></a-button>\r\n              <onl-cgreport-select-modal\r\n                ref=\"selectModal\"\r\n                title=\"选择库存批次\"\r\n                reportId=\"49d9b3c81f5647dea5b4d1f431613920\"\r\n                :width=\"1100\"\r\n                :multiSelectable=\"true\"\r\n                @callback=\"(selectedRows)=>handleBatchNoSelectCallback(props,selectedRows)\"/>\r\n            </template>\r\n\r\n          </j-editable-table>\r\n        </a-tab-pane>\r\n\r\n        <template slot=\"tabBarExtraContent\">\r\n          <a-popover title=\"自定义列\" trigger=\"click\" placement=\"topRight\">\r\n            <template slot=\"content\">\r\n              <a-checkbox-group @change=\"onColSettingsChange\" :defaultValue=\"stkIoBillEntryTable.settingColumns\" style=\"width: 400px;\">\r\n                <a-row>\r\n                  <template v-for=\"(item,index) in stkIoBillEntryTable.columns\">\r\n                    <template v-if=\"item.key!=='rowIndex'&& item.key!=='action' && item.key!=='flag'\">\r\n                      <a-col :span=\"12\"><a-checkbox :value=\"item.key\">{{ item.title }}</a-checkbox></a-col>\r\n                    </template>\r\n                  </template>\r\n                </a-row>\r\n              </a-checkbox-group>\r\n            </template>\r\n            <a-button type=\"link\" icon=\"setting\">自定义列</a-button>\r\n          </a-popover>\r\n        </template>\r\n      </a-tabs>\r\n    </a-spin>\r\n  </j-modal>\r\n</template>\r\n\r\n<script>\r\n\r\n  import pick from 'lodash.pick'\r\n  import { FormTypes,getRefPromise,VALIDATE_NO_PASSED, validateFormAndTables } from '@/utils/JEditableTableUtil'\r\n  import { JEditableTableMixin } from '@/mixins/JEditableTableMixin'\r\n  import JDate from '@/components/jeecg/JDate'\r\n  import JUpload from '@/components/jeecg/JUpload'\r\n  import JSelectUserByDep from '@/components/jeecgbiz/JSelectUserByDep'\r\n  import JDictSelectTag from \"@/components/dict/JDictSelectTag\"\r\n  import { getAction, putAction } from '@api/manage'\r\n  import {getFormatDate} from '../../utils/util'\r\n  import Vue from \"vue\";\r\n  import OnlCgreportSelectModal from '../../components/OnlCgreportSelectModal'\r\n\r\n  export default {\r\n    name: 'OtherOutBillModal',\r\n    mixins: [JEditableTableMixin],\r\n    components: {\r\n      JDate,\r\n      JUpload,\r\n      JSelectUserByDep,\r\n      JDictSelectTag,\r\n      OnlCgreportSelectModal\r\n    },\r\n    data() {\r\n      return {\r\n        action: '',\r\n        moreStatus: false,\r\n        width: '1200px',\r\n        spans: {\r\n          labelCol1: { span: 2 },\r\n          wrapperCol1: { span: 22 },\r\n          labelCol2: { span: 4 },\r\n          wrapperCol2: { span: 20 },\r\n          labelCol3: { span: 6 },\r\n          wrapperCol3: { span: 18 },\r\n          labelCol6: { span: 12 },\r\n          wrapperCol6: { span: 12 }\r\n         },\r\n\r\n        // 新增时子表默认添加几行空数据\r\n        addDefaultRowNum: 1,\r\n        validatorRules: {\r\n          stockIoType: {rules: [\r\n          ]},\r\n          billNo: {rules: [\r\n            {required: true, message: '请输入单据编号!'},\r\n          ]},\r\n          billDate: {rules: [\r\n            {required: true, message: '请输入单据日期!'},\r\n          ]},\r\n          sourceType: {rules: [\r\n          ]},\r\n          sourceId: {rules: [\r\n          ]},\r\n          sourceNo: {rules: [\r\n          ]},\r\n          clerkId: {rules: [\r\n          ]},\r\n          handlerId: {rules: [\r\n          ]},\r\n          hasRp: {rules: [\r\n          ]},\r\n          isRubric: {rules: [\r\n          ]},\r\n          isSameSettle: {rules: [\r\n          ]},\r\n          supplierId: {rules: [\r\n          ]},\r\n          customerId: {rules: [\r\n          ]},\r\n          attachment: {rules: [\r\n          ]},\r\n          remark: {rules: [\r\n          ]},\r\n          billProcStatus: {rules: [\r\n          ]},\r\n          approverId: {rules: [\r\n          ]},\r\n          flowId: {rules: [\r\n          ]},\r\n          isApproved: {rules: [\r\n          ]},\r\n          effectiveTime: {rules: [\r\n          ]},\r\n          isVoided: {rules: [\r\n          ]},\r\n          isClosed: {rules: [\r\n          ]},\r\n          sysOrgCode: {rules: [\r\n          ]},\r\n          createBy: {rules: [\r\n          ]},\r\n          createTime: {rules: [\r\n          ]},\r\n          updateBy: {rules: [\r\n          ]},\r\n          updateTime: {rules: [\r\n          ]},\r\n        },\r\n        refKeys: ['stkIoBillEntry', ],\r\n        tableKeys:['stkIoBillEntry', ],\r\n        activeKey: 'stkIoBillEntry',\r\n        // 明细\r\n        stkIoBillEntryTable: {\r\n          loading: false,\r\n          dataSource: [],\r\n          columns: [\r\n            {\r\n              title: '分录号',\r\n              key: 'entryNo',\r\n              type: FormTypes.inputNumber,\r\n              width:\"60px\",\r\n              validateRules: [\r\n                { required: true, message: '${title}不能为空' },\r\n                { pattern: /^[1-9]\\d*$/, message: '请输入零以上的正整数' },\r\n                { handler: this.validateEntryNoHandler}],\r\n            },\r\n            { //sourceType、sourceEntryId、sourceEntryNo应一起考虑\r\n              title: '源单分录号',\r\n              key: 'sourceEntryNo',\r\n              type: FormTypes.input,\r\n              width:\"180px\",\r\n              defaultValue: '',\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '物料',\r\n              key: 'materialId',\r\n              type: FormTypes.sel_search,\r\n              dictCode:\"bas_material,name,id\",\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules: [{ required: true, message: '${title}不能为空' }],\r\n              options:[],\r\n            },\r\n            {\r\n              title: '仓库',\r\n              key: 'warehouseId',\r\n              type: FormTypes.select,\r\n              dictCode:\"bas_warehouse,name,id\",\r\n              width:\"150px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              options:[],\r\n              validateRules: [{ required: true, message: '${title}不能为空' }],\r\n            },\r\n            {\r\n              title: '批次号',\r\n              key: 'batchNo',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules: [{ required: true, message: '${title}不能为空' }],\r\n            },\r\n            {\r\n              title: '',\r\n              key: 'batchNoSelectModal',\r\n              type: FormTypes.slot,\r\n              slotName: 'batchNoSelectModal',\r\n              orgFields: \"material_id,warehouse_id,batch_no,unit_id,unit_id,qty,cost,id\",\r\n              destFields: \"materialId,warehouseId,batchNo,unitId,inventoryUnitId,inventoryQty,inventoryCost,inventoryId\",\r\n              width:\"45px\",\r\n            },\r\n            {\r\n              title: '库存单位',\r\n              key: 'inventoryUnitId',\r\n              type: FormTypes.select,\r\n              dictCode:\"bas_measure_unit,name,id\",\r\n              width:\"100px\",\r\n              disabled:true,\r\n            },\r\n            {\r\n              title: '库存数量',\r\n              key: 'inventoryQty',\r\n              type: FormTypes.input,\r\n              statistics: \"true\",\r\n              width:\"100px\",\r\n              disabled:true,\r\n            },\r\n            {\r\n              title: '出库单位',\r\n              key: 'unitId',\r\n              type: FormTypes.select,\r\n              dictCode:\"bas_measure_unit,name,id\",\r\n              width:\"100px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules: [{ required: true, message: '${title}不能为空' }],\r\n              options:[],\r\n            },\r\n            {\r\n              title: '出库数量',\r\n              key: 'qty',\r\n              type: FormTypes.inputNumber,\r\n              statistics: \"true\",\r\n              width:\"100px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              validateRules:[\r\n                { required: true, message: '${title}不能为空' },\r\n                { handler: this.validateQtyHandler}]\r\n            },\r\n            {\r\n              title: '出库成本',\r\n              key: 'cost',\r\n              type: FormTypes.inputNumber,\r\n              statistics: \"true\",\r\n              width:\"100px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n              disabled: true,\r\n            },\r\n            {\r\n              title: '库存批次id',\r\n              key: 'inventoryId',\r\n              type: FormTypes.hidden,\r\n              width:\"10px\",\r\n              disabled:true,\r\n            },\r\n            {\r\n              title: '库存成本',\r\n              key: 'inventoryCost',\r\n              type: FormTypes.input,\r\n              statistics: \"true\",\r\n              width:\"100px\",\r\n              disabled:true,\r\n            },\r\n            {\r\n              title: '备注',\r\n              key: 'remark',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n            {\r\n              title: '备注2',\r\n              key: 'remark2',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n            {\r\n              title: '备注3',\r\n              key: 'remark3',\r\n              type: FormTypes.input,\r\n              width:\"200px\",\r\n              placeholder: '请输入${title}',\r\n              defaultValue: '',\r\n            },\r\n          ],\r\n          settingColumns: []\r\n        },\r\n        url: {\r\n          add: \"/stock/stkIoBill/add\",\r\n          edit: \"/stock/stkIoBill/edit\",\r\n          approve: \"/stock/stkIoBill/approve\",\r\n          stkIoBillEntry: {\r\n            list: '/stock/stkIoBill/queryEntryByMainId',\r\n            editingList: '/stock/stkIoBill/queryEditingEntryByMainId'\r\n          },\r\n        }\r\n      }\r\n    },\r\n\r\n    computed: {\r\n      readOnly: function() {\r\n        return this.action !== \"add\" && this.action !== \"edit\";\r\n      }\r\n    },\r\n\r\n    methods: {\r\n      getAllTable() {\r\n        let values = this.tableKeys.map(key => getRefPromise(this, key))\r\n        return Promise.all(values)\r\n      },\r\n\r\n      addInit() {\r\n        //销售出库\r\n        this.model.stockIoType = '299'\r\n        this.model.isRubric = 0\r\n        //是否有往来\r\n        this.model.hasRp = 0\r\n        //结算是否同出库（或取自系统参数）\r\n        this.model.isSameSettle = 0\r\n        //处理状态：编辑中\r\n        this.model.billProcStatus = '12'\r\n\r\n        // 请求后台的填值规则接口地址\r\n        const url = '/sys/fillRule/executeRuleByCode/'\r\n        const ruleCode = 'stock_io_bill_no'\r\n        const that = this\r\n        putAction(url + ruleCode, {}).then(res => {\r\n          // 执行成功，获取返回的值，并赋到页面上\r\n          if (res.success) {\r\n            that.model.billNo = res.result;\r\n            that.$nextTick(() => {\r\n              that.form.setFieldsValue({'billNo':res.result, 'billDate':getFormatDate()})\r\n            })\r\n          }\r\n        })\r\n      },\r\n      /** 调用完edit()方法之后会自动调用此方法 */\r\n      editAfter() {\r\n        if (this.action === 'add') {\r\n            this.addInit()\r\n        }\r\n\r\n        let fieldval = pick(this.model,'billNo','billDate','sourceType','sourceId','sourceNo','clerkId','handlerId','isRubric','supplierId','customerId','attachment','remark','billProcStatus','approverId','flowId','isApproved','effectiveTime','isVoided','isClosed','sysOrgCode','createBy','createTime','updateBy','updateTime')\r\n        this.$nextTick( ()=>this.form.setFieldsValue(fieldval) );\r\n        // 加载子表数据\r\n        if (this.model.id) {\r\n          let params = { id: this.model.id }\r\n          let url = this.readOnly ? this.url.stkIoBillEntry.list : this.url.stkIoBillEntry.editingList;\r\n          this.requestSubTableData(url, params, this.stkIoBillEntryTable);\r\n        }\r\n      },\r\n      /** 整理成formData */\r\n      classifyIntoFormData(allValues) {\r\n        let main = Object.assign(this.model, allValues.formValue)\r\n\r\n        return {\r\n          ...main, // 展开\r\n          stkIoBillEntryList: allValues.tablesValue[0].values,\r\n        }\r\n      },\r\n      validateError(msg){\r\n        this.$message.error(msg)\r\n      },\r\n      popupCallback(row){\r\n        this.form.setFieldsValue(pick(row,'billNo','billDate','sourceType','sourceId','sourceNo','clerkId','handlerId','isRubric','supplierId','customerId','attachment','remark','billProcStatus','approverId','flowId','isApproved','effectiveTime','isVoided','isClosed','sysOrgCode','createBy','createTime','updateBy','updateTime'))\r\n      },\r\n\r\n      handleSave() {\r\n        this.handleOk()\r\n      },\r\n      handleSubmit() {\r\n        //处理状态=编辑完成\r\n        this.form.setFieldsValue({billProcStatus:'13'})\r\n\r\n        /** 触发表单验证 */\r\n        this.getAllTable().then(tables => {\r\n          /** 一次性验证主表和所有的次表 */\r\n          return validateFormAndTables(this.form, tables)\r\n        }).then(allValues => {\r\n          if (typeof this.classifyIntoFormData !== 'function') {\r\n            throw this.throwNotFunction('classifyIntoFormData')\r\n          }\r\n          let formData = this.classifyIntoFormData(allValues)\r\n          // 发起请求\r\n          return this.request(formData)\r\n        }).catch(e => {\r\n          //处理状态=编辑中\r\n          this.form.setFieldsValue({billProcStatus:'12'})\r\n\r\n          if (e.error === VALIDATE_NO_PASSED) {\r\n            // 如果有未通过表单验证的子表，就自动跳转到它所在的tab\r\n            this.activeKey = e.index == null ? this.activeKey : this.refKeys[e.index]\r\n          } else {\r\n            console.error(e)\r\n          }\r\n        })\r\n      },\r\n\r\n      handleApproved() {\r\n        const that = this;\r\n        putAction(that.url.approve, {id: that.model.id}).then((res) => {\r\n          if (res.success) {\r\n            that.$message.success(res.message);\r\n            that.$emit('ok')\r\n            that.close()\r\n          } else {\r\n            that.$message.warning(res.message);\r\n          }\r\n        })\r\n      },\r\n\r\n      handleToggleMore() {\r\n        this.moreStatus = !this.moreStatus\r\n      },\r\n\r\n      //列设置更改事件\r\n      onColSettingsChange (checkedValues) {\r\n        let key = this.$route.name+\"/stkIoBillEntryTable:colsettings\";\r\n        Vue.ls.set(key, checkedValues, 7*24*60*60*1000)\r\n        this.stkIoBillEntryTable.settingColumns = checkedValues;\r\n        this.stkIoBillEntryTable.columns.forEach (function (item,i,array ) {\r\n          if (checkedValues.includes(item.key)) {\r\n            if (item.typeDef !== undefined && item.typeDef !== null\r\n              && item.typeDef !== \"\" && item.typeDef !== FormTypes.hidden) {\r\n              item.type = item.typeDef;\r\n            }\r\n          } else if (item.type !== FormTypes.hidden) {\r\n            item.typeDef = item.type;\r\n            item.type = FormTypes.hidden;\r\n          }\r\n        });\r\n      },\r\n\r\n      initColumns(){\r\n        //权限过滤（列权限控制时打开，修改第二个参数为授权码前缀）\r\n        //this.defColumns = colAuthFilter(this.defColumns,'testdemo:');\r\n\r\n        const key = this.$route.name+\"/stkIoBillEntryTable:colsettings\";\r\n        let colSettings = Vue.ls.get(key);\r\n        let that = this;\r\n        if (colSettings == null) {\r\n          this.stkIoBillEntryTable.columns.forEach(function (item,i,array ) {\r\n            that.stkIoBillEntryTable.settingColumns.push(item.key);\r\n          })\r\n        }else{\r\n          this.stkIoBillEntryTable.settingColumns = colSettings;\r\n          this.stkIoBillEntryTable.columns.forEach(function (item,i,array ) {\r\n            if (colSettings.includes(item.key)) {\r\n              if (item.typeDef !== undefined && item.typeDef !== null\r\n                && item.typeDef !== \"\" && item.typeDef !== FormTypes.hidden) {\r\n                item.type = item.typeDef;\r\n              }\r\n            } else {\r\n              item.typeDef = item.type;\r\n              item.type = FormTypes.hidden;\r\n            }\r\n          });\r\n        }\r\n      },\r\n\r\n      onOutEntryAdded(event){\r\n        const { row, target } = event\r\n        let { values } = target.getValuesSync({ validate: false });\r\n        let maxEntryNo = 0;\r\n        for (let val of values) {\r\n          let entryNo = Number(val['entryNo']);\r\n          if (!isNaN(entryNo) && entryNo > maxEntryNo) maxEntryNo = entryNo;\r\n        }\r\n        maxEntryNo += 10;\r\n        target.setValues([{rowKey: row.id, values: {entryNo: maxEntryNo}}]);\r\n      },\r\n\r\n      //单元值改变一个字符就触发一次\r\n      onValueChange(event) {\r\n        const { type, row, column, value, target } = event\r\n\r\n        //触发：物料ID、仓库id、批次号、出库数量触发，前三者引起库存数量、库存成本等变化，\r\n        //      这都需要重新计算，所以：简化为每次change都计算。\r\n        //联动：出库成本\r\n        let qty = Number(value),\r\n            inventoryQty = Number(row.inventoryQty),\r\n            inventoryConst = Number(row.inventoryCost);\r\n        if (!isNaN(qty) && !isNaN(inventoryQty) && !isNaN(inventoryConst) && inventoryQty>0 &&\r\n            row.unitId && row.unitId!==\"\" && row.inventoryUnitId && row.inventoryUnitId!==\"\") {\r\n          const key = row.unitId + \"/\" + row.inventoryUnitId;\r\n          let rate = row.unitId===row.inventoryUnitId ? 1 : Vue.ls.get(key);\r\n          if (rate==null) {\r\n            const url = '/bas/basMeasureUnit/getRate';\r\n            const params = {toId: row.unitId, fromId: row.inventoryUnitId};\r\n            getAction(url, params).then(res => {\r\n              if (res.success) {\r\n                rate = res.result;\r\n                Vue.ls.set(key, rate, 7*24*60*60*1000)\r\n\r\n                let cost = inventoryConst * qty / (inventoryQty * rate);\r\n                cost = cost.toFixed(2)\r\n                target.setValues([{rowKey: row.id, values: {cost: cost}}]);\r\n              }\r\n            });\r\n          }\r\n          else {\r\n            let cost = inventoryConst * qty / (inventoryQty * rate);\r\n            cost = cost.toFixed(2);\r\n            target.setValues([{rowKey: row.id, values: {cost: cost}}]);\r\n          }\r\n        }\r\n      },\r\n\r\n      handleBatchNoSelect(props){\r\n        let row = props.getValue();\r\n        let orgFields = props.column.orgFields.split(',');\r\n        let destFields = props.column.destFields.split(',');\r\n        let queryParams = {};\r\n        for(let i = 0; i < orgFields.length; i++) {\r\n          queryParams[orgFields[i]] = row[destFields[i]];\r\n        }\r\n        this.$refs.selectModal.initQueryParams(queryParams);\r\n        this.$refs.selectModal.visible = true;\r\n      },\r\n\r\n      handleBatchNoSelectCallback(props, selectedRows){\r\n        let { rowId, target } = props;\r\n        let orgFields = props.column.orgFields.split(',');\r\n        let destFields = props.column.destFields.split(',');\r\n        for(let i = 0; i < selectedRows.length; i++) {\r\n          let values = {};\r\n          for(let j = 0; j < orgFields.length; j++) {\r\n            values[destFields[j]] = selectedRows[i][orgFields[j]];\r\n          }\r\n\r\n          if (i===0) {\r\n            target.setValues([{rowKey: rowId, values: values}]);\r\n          } else {\r\n            target.add();\r\n            let rowId2 = target.rows[target.rows.length - 1].id;\r\n            target.setValues([{rowKey: rowId2, values: values}]);\r\n          }\r\n        }\r\n      },\r\n\r\n      validateEntryNoHandler(type, value, row, column, callback, target) {\r\n        if (type !== 'blur') {\r\n          callback();//无参或者null：不做操作\r\n          return;\r\n        }\r\n\r\n        let { values } = target.getValuesSync({ validate: false });\r\n        let count = 0;\r\n        for (let val of values) {\r\n          if (Number(val['entryNo']) === Number(value)) {\r\n            if (++count >= 2) {\r\n              callback(false, '${title}不能重复');\r\n              return;\r\n            }\r\n          }\r\n        }\r\n        callback(true); //true：通过验证\r\n      },\r\n\r\n      validateQtyHandler(type, value, row, column, callback, target) {\r\n        if (type !== 'blur') {\r\n          callback();\r\n          return;\r\n        }\r\n\r\n        let { values } = target.getValuesSync({ validate: false, rowIds: [row.id]});\r\n        let inventoryQty = Number(values[0].inventoryQty);\r\n        let qty = Number(value);\r\n        if (isNaN(qty) || isNaN(inventoryQty)) {\r\n          callback();\r\n          return;\r\n        }\r\n        if (qty > inventoryQty) {\r\n          callback(false, '不能大于库存数量！');\r\n          return;\r\n        }\r\n\r\n        let inventoryId = values[0].inventoryId;\r\n        if (!inventoryId) {\r\n          callback();\r\n          return;\r\n        }\r\n        let totalQty = 0;\r\n        let obj = target.getValuesSync({ validate: false});\r\n        values = obj.values;\r\n        for(let v of values) {\r\n          qty = Number(v.qty);\r\n          if (!isNaN(qty)) totalQty += qty;\r\n        }\r\n        if (totalQty > inventoryQty) {\r\n          callback(false, '该库存批次的出库数量合计不能大于库存数量！');\r\n        } else {\r\n          callback(true);\r\n        }\r\n      },\r\n    },\r\n\r\n    created() {\r\n      this.initColumns();\r\n    },\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .ant-row.ant-form-item {\r\n    margin-bottom: 12px;\r\n  }\r\n</style>\r\n"],"sourceRoot":"src/views/erp/stock/modules"}]}