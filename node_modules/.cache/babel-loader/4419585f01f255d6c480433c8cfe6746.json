{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\stock\\modules\\RubricPurInBillModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\stock\\modules\\RubricPurInBillModal.vue","mtime":1648374777647},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1648365139913},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["function _toConsumableArray(arr) { return _arrayWithoutHoles(arr) || _iterableToArray(arr) || _nonIterableSpread(); }\n\nfunction _nonIterableSpread() { throw new TypeError(\"Invalid attempt to spread non-iterable instance\"); }\n\nfunction _iterableToArray(iter) { if (Symbol.iterator in Object(iter) || Object.prototype.toString.call(iter) === \"[object Arguments]\") return Array.from(iter); }\n\nfunction _arrayWithoutHoles(arr) { if (Array.isArray(arr)) { for (var i = 0, arr2 = new Array(arr.length); i < arr.length; i++) { arr2[i] = arr[i]; } return arr2; } }\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport pick from 'lodash.pick';\nimport { FormTypes, getRefPromise, VALIDATE_NO_PASSED, validateFormAndTables } from '@/utils/JEditableTableUtil';\nimport { JEditableTableMixin } from '@/mixins/JEditableTableMixin';\nimport JDate from '@/components/jeecg/JDate';\nimport JUpload from '@/components/jeecg/JUpload';\nimport JSelectUserByDep from '@/components/jeecgbiz/JSelectUserByDep';\nimport JDictSelectTag from \"@/components/dict/JDictSelectTag\";\nimport { putAction } from '@api/manage';\nimport { billModalMixin } from '../../mixins/billModalMixin';\nimport OnlCgreportSelectModal from '../../components/OnlCgreportSelectModal';\nimport EditableTableColumnsSetter from \"../../components/EditableTableColumnsSetter\";\nimport { getFormatDate } from '../../utils/util';\nimport { validateEntryNo } from '../../utils/editableTableValidate';\nexport default {\n  name: 'RubricPurInBillModal',\n  mixins: [JEditableTableMixin, billModalMixin],\n  components: {\n    EditableTableColumnsSetter: EditableTableColumnsSetter,\n    JDate: JDate,\n    JUpload: JUpload,\n    JSelectUserByDep: JSelectUserByDep,\n    JDictSelectTag: JDictSelectTag,\n    OnlCgreportSelectModal: OnlCgreportSelectModal\n  },\n  data: function data() {\n    return {\n      width: '1200px',\n      moreStatus: false,\n      // 新增时子表默认添加几行空数据\n      addDefaultRowNum: 0,\n      refKeys: ['stkIoBillEntry', 'sourceStkIoBillEntry'],\n      tableKeys: ['stkIoBillEntry'],\n      activeKey: 'stkIoBillEntry',\n      // 采购退货出库明细\n      stkIoBillEntryTable: {\n        loading: false,\n        dataSource: [],\n        selectedRowCount: 0,\n        settingColumns: [],\n        //显示列设置\n        columns: [{\n          title: '分录号',\n          key: 'entryNo',\n          type: FormTypes.inputNumber,\n          width: \"60px\",\n          disabled: true\n        }, {\n          title: '源单类型',\n          key: 'sourceType',\n          type: FormTypes.hidden,\n          width: \"100px\",\n          disabled: true\n        }, {\n          title: '源单分录id',\n          key: 'sourceEntryId',\n          type: FormTypes.hidden,\n          width: \"180px\",\n          disabled: true\n        }, {\n          title: '源单分录号',\n          key: 'sourceEntryNo',\n          type: FormTypes.hidden,\n          width: \"180px\",\n          disabled: true\n        }, {\n          title: '物料',\n          key: 'materialId',\n          type: FormTypes.sel_search,\n          dictCode: \"bas_material,name,id\",\n          width: \"200px\",\n          options: [],\n          disabled: true\n        }, {\n          title: '计量单位',\n          key: 'unitId',\n          type: FormTypes.select,\n          dictCode: \"bas_measure_unit,name,id\",\n          width: \"100px\",\n          options: [],\n          disabled: true\n        }, {\n          title: '入库数量',\n          key: 'qty',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '入库成本',\n          key: 'cost',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '成本含税',\n          key: 'isInclTax',\n          type: FormTypes.select,\n          dictCode: \"yn\",\n          width: \"80px\",\n          options: [],\n          disabled: true\n        }, {\n          title: '仓库',\n          key: 'warehouseId',\n          type: FormTypes.select,\n          dictCode: \"bas_warehouse,name,id\",\n          width: \"150px\",\n          options: [],\n          disabled: true\n        }, {\n          title: '批次号',\n          key: 'batchNo',\n          type: FormTypes.input,\n          width: \"200px\",\n          disabled: true\n        }, {\n          title: '结算数量',\n          key: 'settleQty',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '含税单价',\n          key: 'settlePrice',\n          type: FormTypes.inputNumber,\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '税率%',\n          key: 'taxRate',\n          type: FormTypes.inputNumber,\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '税额',\n          key: 'tax',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '折让金额',\n          key: 'discountAmt',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '折让税额',\n          key: 'discountTax',\n          type: FormTypes.inputNumber,\n          width: \"100px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '结算金额',\n          key: 'settleAmt',\n          type: FormTypes.inputNumber,\n          statistics: \"true\",\n          width: \"120px\",\n          placeholder: '请输入${title}',\n          defaultValue: '',\n          validateRules: [{\n            required: true,\n            message: '${title}不能为空'\n          }, {\n            pattern: /^((-\\d+(\\.\\d+)?)|(0+(\\.0+)?))$/,\n            message: '请输入0或负数!'\n          }, {\n            handler: this.validateRubric\n          }]\n        }, {\n          title: '已开票数量',\n          key: 'invoicedQty',\n          type: FormTypes.input,\n          statistics: \"true\",\n          width: \"120px\",\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '已开票金额',\n          key: 'invoicedAmt',\n          type: FormTypes.input,\n          statistics: \"true\",\n          width: \"120px\",\n          defaultValue: '',\n          disabled: true\n        }, {\n          title: '备注',\n          key: 'remark',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '备注2',\n          key: 'remark2',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '备注3',\n          key: 'remark3',\n          type: FormTypes.input,\n          width: \"200px\",\n          placeholder: '请输入${title}',\n          defaultValue: ''\n        }, {\n          title: '',\n          key: 'flag',\n          type: FormTypes.hidden,\n          width: \"1px\",\n          placeholder: '',\n          defaultValue: ''\n        }]\n      },\n      //原采购入库单\n      sourceStkIoBillEntryTable: {\n        loading: false,\n        dataSource: [],\n        selectedRowCount: 0,\n        disabledRows: {}\n      },\n      validatorRules: {\n        stockIoType: {\n          rules: []\n        },\n        billNo: {\n          rules: [{\n            required: true,\n            message: '请输入单据编号!'\n          }]\n        },\n        billDate: {\n          rules: [{\n            required: true,\n            message: '请输入单据日期!'\n          }]\n        },\n        sourceType: {\n          rules: []\n        },\n        sourceNo: {\n          rules: [{\n            required: true,\n            message: '请选择采购入库单!'\n          }]\n        },\n        clerkId: {\n          rules: []\n        },\n        handlerId: {\n          rules: []\n        },\n        hasRp: {\n          rules: []\n        },\n        isRubric: {\n          rules: []\n        },\n        isSameSettle: {\n          rules: []\n        },\n        supplierId: {\n          rules: []\n        },\n        customerId: {\n          rules: []\n        },\n        attachment: {\n          rules: []\n        },\n        remark: {\n          rules: []\n        },\n        billProcStatus: {\n          rules: []\n        },\n        approverId: {\n          rules: []\n        },\n        flowId: {\n          rules: []\n        },\n        isApproved: {\n          rules: []\n        },\n        effectiveTime: {\n          rules: []\n        },\n        isVoided: {\n          rules: []\n        },\n        isClosed: {\n          rules: []\n        },\n        sysOrgCode: {\n          rules: []\n        },\n        createBy: {\n          rules: []\n        },\n        createTime: {\n          rules: []\n        },\n        updateBy: {\n          rules: []\n        },\n        updateTime: {\n          rules: []\n        }\n      },\n      url: {\n        add: \"/stock/stkIoBill/add\",\n        edit: \"/stock/stkIoBill/edit\",\n        approve: \"/stock/stkIoBill/approve\",\n        stkIoBillEntry: {\n          list: '/stock/stkIoBill/queryEntryByMainId'\n        }\n      }\n    };\n  },\n  methods: {\n    getAllTable: function getAllTable() {\n      var _this = this;\n\n      var values = this.tableKeys.map(function (key) {\n        return getRefPromise(_this, key);\n      });\n      return Promise.all(values);\n    },\n    addInit: function addInit() {\n      //采购入库（红字）\n      this.model.stockIoType = '1011';\n      this.model.isRubric = 1; //是否有往来\n\n      this.model.hasRp = 1; //结算是否同入库（或取自系统参数）\n\n      this.model.isSameSettle = 0; //源单类型：采购入库\n\n      this.model.sourceType = 'stk_io_bill..101'; //处理状态：编辑中\n\n      this.model.billProcStatus = '12'; // 请求后台的填值规则接口地址\n\n      var url = '/sys/fillRule/executeRuleByCode/';\n      var ruleCode = 'stock_io_bill_no';\n      var that = this;\n      putAction(url + ruleCode, {}).then(function (res) {\n        // 执行成功，获取返回的值，并赋到页面上\n        if (res.success) {\n          that.model.billNo = res.result;\n          that.$nextTick(function () {\n            return that.form.setFieldsValue({\n              'billNo': res.result,\n              'billDate': getFormatDate()\n            });\n          });\n        }\n      });\n    },\n\n    /** 调用完edit()方法之后会自动调用此方法 */\n    editAfter: function editAfter() {\n      var _this2 = this;\n\n      var that = this; //sourceStkIoBillEntry未在tableKeys中\n\n      this.$nextTick(function () {\n        return that.$refs.sourceStkIoBillEntry.initialize();\n      });\n\n      if (this.action === 'add') {\n        this.addInit();\n        this.activeKey = 'sourceStkIoBillEntry';\n      } else {\n        this.activeKey = 'stkIoBillEntry';\n      }\n\n      var fieldval = pick(this.model, 'billNo', 'billDate', 'sourceType', 'sourceNo', 'clerkId', 'handlerId', 'isRubric', 'isSameSettle', 'supplierId', 'attachment', 'remark', 'billProcStatus', 'approverId', 'flowId', 'isApproved', 'effectiveTime', 'isVoided', 'isClosed', 'sysOrgCode', 'createBy', 'createTime', 'updateBy', 'updateTime');\n      this.$nextTick(function () {\n        that.form.setFieldsValue(fieldval);\n        that.onIsSameSettleChange(_this2.model.isSameSettle.toString());\n      }); // 加载子表数据\n\n      if (this.model.id) {\n        var loadSecondSubTableData = function loadSecondSubTableData() {\n          var params = {\n            id: that.model.sourceId\n          };\n          that.requestSubTableData(that.url.stkIoBillEntry.list, params, that.sourceStkIoBillEntryTable, that.refreshDisabledRows);\n        };\n\n        var params = {\n          id: this.model.id\n        };\n        this.requestSubTableData(this.url.stkIoBillEntry.list, params, this.stkIoBillEntryTable, loadSecondSubTableData);\n      }\n    },\n\n    /** 整理成formData */\n    classifyIntoFormData: function classifyIntoFormData(allValues) {\n      var main = Object.assign(this.model, allValues.formValue);\n      return _objectSpread({}, main, {\n        // 展开source.dataSource =\n        stkIoBillEntryList: allValues.tablesValue[0].values\n      });\n    },\n    validateError: function validateError(msg) {\n      this.$message.error(msg);\n    },\n    popupCallback: function popupCallback(row) {\n      this.form.setFieldsValue(pick(row, 'billNo', 'billDate', 'sourceType', 'sourceNo', 'clerkId', 'handlerId', 'isRubric', 'isSameSettle', 'supplierId', 'attachment', 'remark', 'billProcStatus', 'approverId', 'flowId', 'isApproved', 'effectiveTime', 'isVoided', 'isClosed', 'sysOrgCode', 'createBy', 'createTime', 'updateBy', 'updateTime'));\n    },\n    onIsSameSettleChange: function onIsSameSettleChange(val) {\n      this.$refs.stkIoBillEntry.columns.forEach(function (item, i, array) {\n        if (item.key === \"settleQty\" || item.key === \"settleAmt\") {\n          item.disabled = val === '1';\n        }\n      });\n\n      if (val === '1') {\n        var _this$$refs$stkIoBill = this.$refs.stkIoBillEntry.getValuesSync({\n          validate: false\n        }),\n            error = _this$$refs$stkIoBill.error,\n            values = _this$$refs$stkIoBill.values;\n\n        var _iteratorNormalCompletion = true;\n        var _didIteratorError = false;\n        var _iteratorError = undefined;\n\n        try {\n          for (var _iterator = values[Symbol.iterator](), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {\n            var v = _step.value;\n            this.$refs.stkIoBillEntry.setValues([{\n              rowKey: v.id,\n              values: {\n                settleQty: v.qty,\n                settleAmt: v.cost\n              }\n            }]);\n          }\n        } catch (err) {\n          _didIteratorError = true;\n          _iteratorError = err;\n        } finally {\n          try {\n            if (!_iteratorNormalCompletion && _iterator.return != null) {\n              _iterator.return();\n            }\n          } finally {\n            if (_didIteratorError) {\n              throw _iteratorError;\n            }\n          }\n        }\n      }\n    },\n    //单元值改变一个字符就触发一次\n    onValueChange: function onValueChange(event) {\n      var type = event.type,\n          row = event.row,\n          column = event.column,\n          value = event.value,\n          target = event.target; //联动\n      //触发：入库数量, 联动列结算数量\n\n      if (column.key === 'qty') {\n        if (this.form.getFieldValue(\"isSameSettle\") === '1') {\n          target.setValues([{\n            rowKey: row.id,\n            values: {\n              settleQty: value\n            }\n          }]);\n        }\n      } //触发：入库成本, 联动：结算金额\n      else if (column.key === 'cost') {\n          if (this.form.getFieldValue(\"isSameSettle\") === '1') {\n            target.setValues([{\n              rowKey: row.id,\n              values: {\n                settleAmt: value\n              }\n            }]);\n          }\n        }\n    },\n    handleSourceSelect: function handleSourceSelect() {\n      var queryParams = {};\n      queryParams['supplier_id'] = this.form.getFieldValue('supplierId');\n      this.$refs.selectModal.initQueryParams(queryParams);\n      this.$refs.selectModal.visible = true;\n    },\n    handleSourceSelectCallback: function handleSourceSelectCallback(selectedRows) {\n      if (this.model.sourceId === selectedRows[0]['id']) return;\n      this.model.sourceId = selectedRows[0]['id'];\n      this.form.setFieldsValue({\n        sourceNo: selectedRows[0]['bill_no'],\n        supplierId: selectedRows[0]['supplier_id']\n      }); // 加载子表数据\n\n      var params = {\n        id: this.model.sourceId\n      };\n      this.requestSubTableData(this.url.stkIoBillEntry.list, params, this.sourceStkIoBillEntryTable, this.refreshDisabledRows);\n    },\n    handleAddEntry: function handleAddEntry() {\n      var source = this.$refs.sourceStkIoBillEntry,\n          target = this.$refs.stkIoBillEntry;\n\n      var _source$getValuesSync = source.getValuesSync({\n        validate: false,\n        rowIds: source.selectedRowIds\n      }),\n          values = _source$getValuesSync.values;\n\n      var _iteratorNormalCompletion2 = true;\n      var _didIteratorError2 = false;\n      var _iteratorError2 = undefined;\n\n      try {\n        for (var _iterator2 = values[Symbol.iterator](), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {\n          var v = _step2.value;\n          var row = pick(v, 'entryNo', 'materialId', 'unitId', 'isInclTax', 'warehouseId', 'batchNo', 'settlePrice', 'taxRate');\n          row.sourceType = 'stk_io_bill.stk_io_bill_entry.101';\n          row.sourceEntryId = v.id;\n          row.sourceEntryNo = this.form.getFieldValue(\"sourceNo\") + '.' + v.entryNo;\n          row.qty = -v.qty;\n          row.cost = -v.cost;\n          row.settleQty = -v.settleQty;\n          row.tax = -v.tax;\n          row.discountAmt = -v.discountAmt;\n          row.discountTax = -v.discountTax;\n          row.settleAmt = -v.settleAmt;\n          target.add();\n          var rowId = target.rows[target.rows.length - 1].id;\n          target.setValues([{\n            rowKey: rowId,\n            values: row\n          }]);\n        }\n      } catch (err) {\n        _didIteratorError2 = true;\n        _iteratorError2 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion2 && _iterator2.return != null) {\n            _iterator2.return();\n          }\n        } finally {\n          if (_didIteratorError2) {\n            throw _iteratorError2;\n          }\n        }\n      }\n\n      this.refreshDisabledRows();\n    },\n    handleRemoveEntry: function handleRemoveEntry() {\n      this.$refs.stkIoBillEntry.removeSelectedRows();\n      this.refreshDisabledRows();\n    },\n    refreshDisabledRows: function refreshDisabledRows() {\n      var that = this;\n      var entryNos = [];\n\n      var _that$$refs$stkIoBill = that.$refs.stkIoBillEntry.getValuesSync({\n        validate: false\n      }),\n          values = _that$$refs$stkIoBill.values;\n\n      var _iteratorNormalCompletion3 = true;\n      var _didIteratorError3 = false;\n      var _iteratorError3 = undefined;\n\n      try {\n        for (var _iterator3 = values[Symbol.iterator](), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {\n          var v = _step3.value;\n          entryNos.push(Number(v.entryNo));\n        }\n      } catch (err) {\n        _didIteratorError3 = true;\n        _iteratorError3 = err;\n      } finally {\n        try {\n          if (!_iteratorNormalCompletion3 && _iterator3.return != null) {\n            _iterator3.return();\n          }\n        } finally {\n          if (_didIteratorError3) {\n            throw _iteratorError3;\n          }\n        }\n      }\n\n      that.sourceStkIoBillEntryTable.disabledRows = entryNos.length === 0 ? {} : {\n        entryNo: entryNos\n      }; //disabledRowIds不初始会保留前面的数据，导致与disabledRows不一致！\n\n      that.$refs.sourceStkIoBillEntry.disabledRowIds = []; //使新的disabledRows生效\n\n      var dataSource = _toConsumableArray(that.sourceStkIoBillEntryTable.dataSource);\n\n      that.sourceStkIoBillEntryTable.dataSource = dataSource;\n    },\n    validateRubric: function validateRubric(type, value, row, column, callback, target) {\n      if (type !== 'blur') {\n        callback();\n        return;\n      }\n\n      var _target$getValuesSync = target.getValuesSync({\n        validate: false,\n        rowIds: [row.id]\n      }),\n          values = _target$getValuesSync.values;\n\n      var rubric = Number(values[0][column.key]);\n\n      if (isNaN(rubric)) {\n        callback();\n        return;\n      }\n\n      var sourceEntryId = values[0].sourceEntryId;\n      var rows = this.sourceStkIoBillEntryTable.dataSource.filter(function (row) {\n        return row.id === sourceEntryId;\n      });\n      var blue = rows[0][column.key];\n\n      if (isNaN(blue)) {\n        callback();\n        return;\n      }\n\n      if (-rubric > blue) {\n        callback(false, '不能超出入库！');\n        return;\n      }\n\n      callback(true); //true：通过验证\n    }\n  }\n};",null]}