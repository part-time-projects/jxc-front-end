{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js??ref--0-0!D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\components\\jeecg\\JImageUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\components\\jeecg\\JImageUpload.vue","mtime":1648374777534},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\nimport Vue from 'vue';\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nimport { getFileAccessHttpUrl } from '@/api/manage';\n\nvar uidGenerator = function uidGenerator() {\n  return '-' + parseInt(Math.random() * 10000 + 1, 10);\n};\n\nvar getFileName = function getFileName(path) {\n  if (path.lastIndexOf(\"\\\\\") >= 0) {\n    var reg = new RegExp(\"\\\\\\\\\", \"g\");\n    path = path.replace(reg, \"/\");\n  }\n\n  return path.substring(path.lastIndexOf(\"/\") + 1);\n};\n\nexport default {\n  name: 'JImageUpload',\n  data: function data() {\n    return {\n      uploadAction: window._CONFIG['domianURL'] + \"/sys/common/upload\",\n      uploadLoading: false,\n      picUrl: false,\n      headers: {},\n      fileList: [],\n      previewImage: \"\",\n      previewVisible: false\n    };\n  },\n  props: {\n    text: {\n      type: String,\n      required: false,\n      default: \"上传\"\n    },\n\n    /*这个属性用于控制文件上传的业务路径*/\n    bizPath: {\n      type: String,\n      required: false,\n      default: \"temp\"\n    },\n    value: {\n      type: [String, Array],\n      required: false\n    },\n    disabled: {\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    isMultiple: {\n      type: Boolean,\n      required: false,\n      default: false\n    }\n  },\n  watch: {\n    value: function value(val) {\n      if (val instanceof Array) {\n        this.initFileList(val.join(','));\n      } else {\n        this.initFileList(val);\n      }\n    }\n  },\n  created: function created() {\n    var token = Vue.ls.get(ACCESS_TOKEN);\n    this.headers = {\n      \"X-Access-Token\": token\n    };\n  },\n  methods: {\n    initFileList: function initFileList(paths) {\n      if (!paths || paths.length == 0) {\n        this.fileList = [];\n        return;\n      }\n\n      this.picUrl = true;\n      var fileList = [];\n      var arr = paths.split(\",\");\n\n      for (var a = 0; a < arr.length; a++) {\n        var url = getFileAccessHttpUrl(arr[a]);\n        fileList.push({\n          uid: uidGenerator(),\n          name: getFileName(arr[a]),\n          status: 'done',\n          url: url,\n          response: {\n            status: \"history\",\n            message: arr[a]\n          }\n        });\n      }\n\n      this.fileList = fileList;\n    },\n    beforeUpload: function beforeUpload(file) {\n      var fileType = file.type;\n\n      if (fileType.indexOf('image') < 0) {\n        this.$message.warning('请上传图片');\n        return false;\n      }\n    },\n    handleChange: function handleChange(info) {\n      this.picUrl = false;\n      var fileList = info.fileList;\n\n      if (info.file.status === 'done') {\n        if (info.file.response.success) {\n          this.picUrl = true;\n          fileList = fileList.map(function (file) {\n            if (file.response) {\n              file.url = file.response.message;\n            }\n\n            return file;\n          });\n        } //this.$message.success(`${info.file.name} 上传成功!`);\n\n      } else if (info.file.status === 'error') {\n        this.$message.error(\"\".concat(info.file.name, \" \\u4E0A\\u4F20\\u5931\\u8D25.\"));\n      } else if (info.file.status === 'removed') {\n        this.handleDelete(info.file);\n      }\n\n      this.fileList = fileList;\n\n      if (info.file.status === 'done' || info.file.status === 'removed') {\n        this.handlePathChange();\n      }\n    },\n    // 预览\n    handlePreview: function handlePreview(file) {\n      this.previewImage = file.url || file.thumbUrl;\n      this.previewVisible = true;\n    },\n    getAvatarView: function getAvatarView() {\n      if (this.fileList.length > 0) {\n        var url = this.fileList[0].url;\n        return getFileAccessHttpUrl(url);\n      }\n    },\n    handlePathChange: function handlePathChange() {\n      var uploadFiles = this.fileList;\n      var path = '';\n\n      if (!uploadFiles || uploadFiles.length == 0) {\n        path = '';\n      }\n\n      var arr = [];\n\n      if (!this.isMultiple) {\n        arr.push(uploadFiles[uploadFiles.length - 1].response.message);\n      } else {\n        for (var a = 0; a < uploadFiles.length; a++) {\n          arr.push(uploadFiles[a].response.message);\n        }\n      }\n\n      if (arr.length > 0) {\n        path = arr.join(\",\");\n      }\n\n      this.$emit('change', path);\n    },\n    handleDelete: function handleDelete(file) {\n      //如有需要新增 删除逻辑\n      console.log(file);\n    },\n    handleCancel: function handleCancel() {\n      this.close();\n      this.previewVisible = false;\n    },\n    close: function close() {}\n  },\n  model: {\n    prop: 'value',\n    event: 'change'\n  }\n};",{"version":3,"sources":["JImageUpload.vue"],"names":[],"mappings":"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","sourcesContent":["<template>\r\n  <a-upload\r\n    name=\"file\"\r\n    listType=\"picture-card\"\r\n    :multiple=\"isMultiple\"\r\n    :action=\"uploadAction\"\r\n    :headers=\"headers\"\r\n    :data=\"{biz:bizPath}\"\r\n    :fileList=\"fileList\"\r\n    :beforeUpload=\"beforeUpload\"\r\n    :disabled=\"disabled\"\r\n    :isMultiple=\"isMultiple\"\r\n    :showUploadList=\"isMultiple\"\r\n    @change=\"handleChange\"\r\n    @preview=\"handlePreview\">\r\n    <img v-if=\"!isMultiple && picUrl\" :src=\"getAvatarView()\" style=\"height:104px;max-width:300px\"/>\r\n    <div v-else >\r\n      <a-icon :type=\"uploadLoading ? 'loading' : 'plus'\" />\r\n      <div class=\"ant-upload-text\">{{ text }}</div>\r\n    </div>\r\n    <a-modal :visible=\"previewVisible\" :footer=\"null\" @cancel=\"handleCancel()\">\r\n      <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\"/>\r\n    </a-modal>\r\n  </a-upload>\r\n</template>\r\n\r\n<script>\r\n  import Vue from 'vue'\r\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\"\r\n  import { getFileAccessHttpUrl } from '@/api/manage'\r\n\r\n  const uidGenerator=()=>{\r\n    return '-'+parseInt(Math.random()*10000+1,10);\r\n  }\r\n  const getFileName=(path)=>{\r\n    if(path.lastIndexOf(\"\\\\\")>=0){\r\n      let reg=new RegExp(\"\\\\\\\\\",\"g\");\r\n      path = path.replace(reg,\"/\");\r\n    }\r\n    return path.substring(path.lastIndexOf(\"/\")+1);\r\n  }\r\n  export default {\r\n    name: 'JImageUpload',\r\n    data(){\r\n      return {\r\n        uploadAction:window._CONFIG['domianURL']+\"/sys/common/upload\",\r\n        uploadLoading:false,\r\n        picUrl:false,\r\n        headers:{},\r\n        fileList: [],\r\n        previewImage:\"\",\r\n        previewVisible: false,\r\n      }\r\n    },\r\n    props:{\r\n      text:{\r\n        type:String,\r\n        required:false,\r\n        default:\"上传\"\r\n      },\r\n      /*这个属性用于控制文件上传的业务路径*/\r\n      bizPath:{\r\n        type:String,\r\n        required:false,\r\n        default:\"temp\"\r\n      },\r\n      value:{\r\n        type:[String,Array],\r\n        required:false\r\n      },\r\n      disabled:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: false\r\n      },\r\n      isMultiple:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: false\r\n      }\r\n    },\r\n    watch:{\r\n      value(val){\r\n        if (val instanceof Array) {\r\n          this.initFileList(val.join(','))\r\n        } else {\r\n          this.initFileList(val)\r\n        }\r\n      }\r\n    },\r\n    created(){\r\n      const token = Vue.ls.get(ACCESS_TOKEN);\r\n      this.headers = {\"X-Access-Token\":token}\r\n    },\r\n    methods:{\r\n      initFileList(paths){\r\n        if(!paths || paths.length==0){\r\n          this.fileList = [];\r\n          return;\r\n        }\r\n        this.picUrl = true;\r\n        let fileList = [];\r\n        let arr = paths.split(\",\")\r\n        for(var a=0;a<arr.length;a++){\r\n          let url = getFileAccessHttpUrl(arr[a]);\r\n          fileList.push({\r\n            uid: uidGenerator(),\r\n            name: getFileName(arr[a]),\r\n            status: 'done',\r\n            url: url,\r\n            response:{\r\n              status:\"history\",\r\n              message:arr[a]\r\n            }\r\n          })\r\n        }\r\n        this.fileList = fileList\r\n      },\r\n      beforeUpload: function(file){\r\n        var fileType = file.type;\r\n        if(fileType.indexOf('image')<0){\r\n          this.$message.warning('请上传图片');\r\n          return false;\r\n        }\r\n      },\r\n      handleChange(info) {\r\n        this.picUrl = false;\r\n        let fileList = info.fileList\r\n        if(info.file.status==='done'){\r\n          if(info.file.response.success){\r\n            this.picUrl = true;\r\n            fileList = fileList.map((file) => {\r\n              if (file.response) {\r\n                file.url = file.response.message;\r\n              }\r\n              return file;\r\n            });\r\n          }\r\n          //this.$message.success(`${info.file.name} 上传成功!`);\r\n        }else if (info.file.status === 'error') {\r\n          this.$message.error(`${info.file.name} 上传失败.`);\r\n        }else if(info.file.status === 'removed'){\r\n          this.handleDelete(info.file)\r\n        }\r\n        this.fileList = fileList\r\n        if(info.file.status==='done' || info.file.status === 'removed'){\r\n          this.handlePathChange()\r\n        }\r\n      },\r\n      // 预览\r\n      handlePreview (file) {\r\n        this.previewImage = file.url || file.thumbUrl\r\n        this.previewVisible = true\r\n      },\r\n      getAvatarView(){\r\n        if(this.fileList.length>0){\r\n          let url = this.fileList[0].url\r\n          return getFileAccessHttpUrl(url)\r\n        }\r\n      },\r\n      handlePathChange(){\r\n        let uploadFiles = this.fileList\r\n        let path = ''\r\n        if(!uploadFiles || uploadFiles.length==0){\r\n          path = ''\r\n        }\r\n        let arr = [];\r\n        if(!this.isMultiple){\r\n          arr.push(uploadFiles[uploadFiles.length-1].response.message)\r\n        }else{\r\n          for(var a=0;a<uploadFiles.length;a++){\r\n            arr.push(uploadFiles[a].response.message)\r\n          }\r\n        }\r\n        if(arr.length>0){\r\n          path = arr.join(\",\")\r\n        }\r\n        this.$emit('change', path);\r\n      },\r\n      handleDelete(file){\r\n        //如有需要新增 删除逻辑\r\n        console.log(file)\r\n      },\r\n      handleCancel() {\r\n        this.close();\r\n        this.previewVisible = false;\r\n      },\r\n      close () {\r\n\r\n      },\r\n    },\r\n    model: {\r\n      prop: 'value',\r\n      event: 'change'\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n\r\n</style>"],"sourceRoot":"src/components/jeecg"}]}