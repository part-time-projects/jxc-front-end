{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js!D:\\ideaworkspace\\jxc-front-end\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js??ref--13-0!D:\\ideaworkspace\\jxc-front-end\\src\\mixins\\JeecgListMixin.js","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\mixins\\JeecgListMixin.js","mtime":1648486081577},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\thread-loader\\dist\\cjs.js","mtime":1648365139913},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\@vue\\cli-plugin-eslint\\node_modules\\eslint-loader\\index.js","mtime":1648365119872}],"contextDependencies":[],"result":["function ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\n/**\r\n * 新增修改完成调用 modalFormOk方法 编辑弹框组件ref定义为modalForm\r\n * 高级查询按钮调用 superQuery方法  高级查询组件ref定义为superQueryModal\r\n * data中url定义 list为查询列表  delete为删除单条记录  deleteBatch为批量删除\r\n */\nimport { filterObj } from '@/utils/util';\nimport { deleteAction, getAction, downFile, getFileAccessHttpUrl } from '@/api/manage';\nimport Vue from 'vue';\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\";\nexport var JeecgListMixin = {\n  data: function data() {\n    return {\n      //token header\n      tokenHeader: {\n        'X-Access-Token': Vue.ls.get(ACCESS_TOKEN)\n      },\n\n      /* 查询条件-请不要在queryParam中声明非字符串值的属性 */\n      queryParam: {},\n\n      /* 数据源 */\n      dataSource: [],\n\n      /* 分页参数 */\n      ipagination: {\n        current: 1,\n        pageSize: 10,\n        pageSizeOptions: ['10', '20', '30'],\n        showTotal: function showTotal(total, range) {\n          return range[0] + \"-\" + range[1] + \" 共\" + total + \"条\";\n        },\n        showQuickJumper: true,\n        showSizeChanger: true,\n        total: 0\n      },\n\n      /* 排序参数 */\n      isorter: {\n        column: 'createTime',\n        order: 'desc'\n      },\n\n      /* 筛选参数 */\n      filters: {},\n\n      /* table加载状态 */\n      loading: false,\n\n      /* table选中keys*/\n      selectedRowKeys: [],\n\n      /* table选中records*/\n      selectionRows: [],\n\n      /* 查询折叠 */\n      toggleSearchStatus: false,\n\n      /* 高级查询条件生效状态 */\n      superQueryFlag: false,\n\n      /* 高级查询条件 */\n      superQueryParams: '',\n\n      /** 高级查询拼接方式 */\n      superQueryMatchType: 'and'\n    };\n  },\n  created: function created() {\n    if (!this.disableMixinCreated) {\n      console.log(' -- mixin created -- ');\n      this.loadData(); //初始化字典配置 在自己页面定义\n\n      this.initDictConfig();\n    }\n  },\n  methods: {\n    loadData: function loadData(arg) {\n      var _this = this;\n\n      if (!this.url.list) {\n        this.$message.error(\"请设置url.list属性!\");\n        return;\n      } //加载数据 若传入参数1则加载第一页的内容\n\n\n      if (arg === 1) {\n        this.ipagination.current = 1;\n      }\n\n      var params = this.getQueryParams(); //查询条件\n\n      this.loading = true;\n      getAction(this.url.list, params).then(function (res) {\n        if (res.success) {\n          _this.dataSource = res.result.records;\n          _this.ipagination.total = res.result.total;\n        }\n\n        if (res.code === 510) {\n          _this.$message.warning(res.message);\n        }\n\n        _this.loading = false;\n      });\n    },\n    initDictConfig: function initDictConfig() {\n      console.log(\"--这是一个假的方法!\");\n    },\n    handleSuperQuery: function handleSuperQuery(params, matchType) {\n      //高级查询方法\n      if (!params) {\n        this.superQueryParams = '';\n        this.superQueryFlag = false;\n      } else {\n        this.superQueryFlag = true;\n        this.superQueryParams = JSON.stringify(params);\n        this.superQueryMatchType = matchType;\n      }\n\n      this.loadData(1);\n    },\n    getQueryParams: function getQueryParams() {\n      //获取查询条件\n      var sqp = {};\n\n      if (this.superQueryParams) {\n        sqp['superQueryParams'] = encodeURI(this.superQueryParams);\n        sqp['superQueryMatchType'] = this.superQueryMatchType;\n      }\n\n      var param = Object.assign(sqp, this.queryParam, this.isorter, this.filters);\n      param.field = this.getQueryField();\n      param.pageNo = this.ipagination.current;\n      param.pageSize = this.ipagination.pageSize;\n      return filterObj(param);\n    },\n    getQueryField: function getQueryField() {\n      //TODO 字段权限控制\n      var str = \"id,\";\n      this.columns.forEach(function (value) {\n        str += \",\" + value.dataIndex;\n      });\n      return str;\n    },\n    onSelectChange: function onSelectChange(selectedRowKeys, selectionRows) {\n      this.selectedRowKeys = selectedRowKeys;\n      this.selectionRows = selectionRows;\n    },\n    onClearSelected: function onClearSelected() {\n      this.selectedRowKeys = [];\n      this.selectionRows = [];\n    },\n    searchQuery: function searchQuery() {\n      this.loadData(1);\n    },\n    superQuery: function superQuery() {\n      this.$refs.superQueryModal.show();\n    },\n    searchReset: function searchReset() {\n      this.queryParam = {};\n      this.loadData(1);\n    },\n    batchDel: function batchDel() {\n      if (!this.url.deleteBatch) {\n        this.$message.error(\"请设置url.deleteBatch属性!\");\n        return;\n      }\n\n      if (this.selectedRowKeys.length <= 0) {\n        this.$message.warning('请选择一条记录！');\n        return;\n      } else {\n        var ids = \"\";\n\n        for (var a = 0; a < this.selectedRowKeys.length; a++) {\n          ids += this.selectedRowKeys[a] + \",\";\n        }\n\n        var that = this;\n        this.$confirm({\n          title: \"确认删除\",\n          content: \"是否删除选中数据?\",\n          onOk: function onOk() {\n            that.loading = true;\n            deleteAction(that.url.deleteBatch, {\n              ids: ids\n            }).then(function (res) {\n              if (res.success) {\n                that.$message.success(res.message);\n                that.loadData();\n                that.onClearSelected();\n              } else {\n                that.$message.warning(res.message);\n              }\n            }).finally(function () {\n              that.loading = false;\n            });\n          }\n        });\n      }\n    },\n    handleDelete: function handleDelete(id) {\n      if (!this.url.delete) {\n        this.$message.error(\"请设置url.delete属性!\");\n        return;\n      }\n\n      var that = this;\n      deleteAction(that.url.delete, {\n        id: id\n      }).then(function (res) {\n        if (res.success) {\n          that.$message.success(res.message);\n          that.loadData();\n        } else {\n          that.$message.warning(res.message);\n        }\n      });\n    },\n    handleEdit: function handleEdit(record) {\n      this.$refs.modalForm.edit(record);\n      this.$refs.modalForm.title = \"编辑\";\n      this.$refs.modalForm.disableSubmit = false;\n    },\n    handleAdd: function handleAdd() {\n      this.$refs.modalForm.add();\n      this.$refs.modalForm.title = \"新增\";\n      this.$refs.modalForm.disableSubmit = false;\n    },\n    handleTableChange: function handleTableChange(pagination, filters, sorter) {\n      //分页、排序、筛选变化时触发\n      //TODO 筛选\n      if (Object.keys(sorter).length > 0) {\n        this.isorter.column = sorter.field;\n        this.isorter.order = \"ascend\" == sorter.order ? \"asc\" : \"desc\";\n      }\n\n      this.ipagination = pagination;\n      this.loadData();\n    },\n    handleToggleSearch: function handleToggleSearch() {\n      this.toggleSearchStatus = !this.toggleSearchStatus;\n    },\n    // 给popup查询使用(查询区域不支持回填多个字段，限制只返回一个字段)\n    getPopupField: function getPopupField(fields) {\n      return fields.split(',')[0];\n    },\n    modalFormOk: function modalFormOk() {\n      // 新增/修改 成功时，重载列表\n      this.loadData();\n    },\n    handleDetail: function handleDetail(record) {\n      this.$refs.modalForm.edit(record);\n      this.$refs.modalForm.title = \"详情\";\n      this.$refs.modalForm.disableSubmit = true;\n    },\n\n    /* 导出 */\n    handleExportXls2: function handleExportXls2() {\n      var paramsStr = encodeURI(JSON.stringify(this.getQueryParams()));\n      var url = \"\".concat(window._CONFIG['domianURL'], \"/\").concat(this.url.exportXlsUrl, \"?paramsStr=\").concat(paramsStr);\n      window.location.href = url;\n    },\n    handleExportXls: function handleExportXls(fileName) {\n      var _this2 = this;\n\n      if (!fileName || typeof fileName != \"string\") {\n        fileName = \"导出文件\";\n      }\n\n      var param = _objectSpread({}, this.queryParam);\n\n      if (this.selectedRowKeys && this.selectedRowKeys.length > 0) {\n        param['selections'] = this.selectedRowKeys.join(\",\");\n      }\n\n      console.log(\"导出参数\", param);\n      downFile(this.url.exportXlsUrl, param).then(function (data) {\n        if (!data) {\n          _this2.$message.warning(\"文件下载失败\");\n\n          return;\n        }\n\n        if (typeof window.navigator.msSaveBlob !== 'undefined') {\n          window.navigator.msSaveBlob(new Blob([data], {\n            type: 'application/vnd.ms-excel'\n          }), fileName + '.xls');\n        } else {\n          var url = window.URL.createObjectURL(new Blob([data], {\n            type: 'application/vnd.ms-excel'\n          }));\n          var link = document.createElement('a');\n          link.style.display = 'none';\n          link.href = url;\n          link.setAttribute('download', fileName + '.xls');\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link); //下载完成移除元素\n\n          window.URL.revokeObjectURL(url); //释放掉blob对象\n        }\n      });\n    },\n\n    /* 导入 */\n    handleImportExcel: function handleImportExcel(info) {\n      var h = this.$createElement;\n\n      if (info.file.status !== 'uploading') {\n        console.log(info.file, info.fileList);\n      }\n\n      if (info.file.status === 'done') {\n        if (info.file.response.success) {\n          // this.$message.success(`${info.file.name} 文件上传成功`);\n          if (info.file.response.code === 201) {\n            var _info$file$response = info.file.response,\n                message = _info$file$response.message,\n                _info$file$response$r = _info$file$response.result,\n                msg = _info$file$response$r.msg,\n                fileUrl = _info$file$response$r.fileUrl,\n                fileName = _info$file$response$r.fileName;\n            var href = window._CONFIG['domianURL'] + fileUrl;\n            this.$warning({\n              title: message,\n              content: h(\"div\", [h(\"span\", [msg]), h(\"br\"), h(\"span\", [\"\\u5177\\u4F53\\u8BE6\\u60C5\\u8BF7 \", h(\"a\", {\n                \"attrs\": {\n                  \"href\": href,\n                  \"target\": \"_blank\",\n                  \"download\": fileName\n                }\n              }, [\"\\u70B9\\u51FB\\u4E0B\\u8F7D\"]), \" \"])])\n            });\n          } else {\n            this.$message.success(info.file.response.message || \"\".concat(info.file.name, \" \\u6587\\u4EF6\\u4E0A\\u4F20\\u6210\\u529F\"));\n          }\n\n          this.loadData();\n        } else {\n          this.$message.error(\"\".concat(info.file.name, \" \").concat(info.file.response.message, \".\"));\n        }\n      } else if (info.file.status === 'error') {\n        this.$message.error(\"\\u6587\\u4EF6\\u4E0A\\u4F20\\u5931\\u8D25: \".concat(info.file.msg, \" \"));\n      }\n    },\n\n    /* 图片预览 */\n    getImgView: function getImgView(text) {\n      if (text && text.indexOf(\",\") > 0) {\n        text = text.substring(0, text.indexOf(\",\"));\n      }\n\n      return getFileAccessHttpUrl(text);\n    },\n\n    /* 文件下载 */\n    uploadFile: function uploadFile(text) {\n      if (!text) {\n        this.$message.warning(\"未知的文件\");\n        return;\n      }\n\n      if (text.indexOf(\",\") > 0) {\n        text = text.substring(0, text.indexOf(\",\"));\n      }\n\n      var url = getFileAccessHttpUrl(text);\n      window.open(url);\n    }\n  }\n};",null]}