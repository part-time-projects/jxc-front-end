{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-4afb1134\",\"chunk-4afb1134\"],{\"30f7\":function(e,t,a){\"use strict\";a.r(t);var r=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a(\"j-modal\",{attrs:{visible:e.visible,width:e.width,title:e.title,fullscreen:e.fullscreen,switchFullscreen:e.switchFullscreen},on:{\"update:visible\":function(t){e.visible=t},\"update:fullscreen\":function(t){e.fullscreen=t},ok:e.handleOk}},[e._v(\"\\n`\\n    \"),a(\"div\",{staticClass:\"table-page-search-wrapper\"},[a(\"a-form\",{attrs:{layout:\"inline\"}},[e.queryFields&&e.queryFields.length>0?a(\"a-row\",{attrs:{gutter:24}},[e._l(e.queryFields,(function(t,r){return[t.readOnly?[a(\"a-col\",{directives:[{name:\"show\",rawName:\"v-show\",value:r<3||e.toggleSearchStatus,expression:\"index<3 || toggleSearchStatus\"}],attrs:{md:6,sm:8}},[a(\"a-form-item\",{attrs:{label:t.label}},[a(\"a-input\",{attrs:{disabled:\"\"},model:{value:e.queryParams[t.field],callback:function(a){e.$set(e.queryParams,t.field,a)},expression:\"queryParams[item.field]\"}})],1)],1)]:[t.view.indexOf(\"Date\")>=0?a(\"a-col\",{directives:[{name:\"show\",rawName:\"v-show\",value:r<3||e.toggleSearchStatus,expression:\"index<3 || toggleSearchStatus\"}],key:\"query\"+r,attrs:{md:12,sm:16}},[a(\"onl-cgreport-query-form-item\",{attrs:{queryParam:e.queryParams,item:t,dictOptions:e.dictOptions}})],1):a(\"a-col\",{directives:[{name:\"show\",rawName:\"v-show\",value:r<3||e.toggleSearchStatus,expression:\"index<3 || toggleSearchStatus\"}],key:\"query\"+r,attrs:{md:6,sm:8}},[a(\"onl-cgreport-query-form-item\",{attrs:{queryParam:e.queryParams,item:t,dictOptions:e.dictOptions}})],1)]]})),a(\"a-col\",{attrs:{md:6,sm:8}},[a(\"span\",{staticClass:\"table-page-search-submitButtons\",staticStyle:{float:\"left\",overflow:\"hidden\"}},[a(\"a-button\",{attrs:{type:\"primary\",icon:\"search\"},on:{click:e.searchByQuery}},[e._v(\"查询\")]),a(\"a-button\",{staticStyle:{\"margin-left\":\"8px\"},attrs:{icon:\"reload\"},on:{click:e.searchReset}},[e._v(\"重置\")]),e.queryFields.length>3?a(\"a\",{staticStyle:{\"margin-left\":\"8px\"},on:{click:e.handleToggleSearch}},[e._v(\"\\n                \"+e._s(e.toggleSearchStatus?\"收起\":\"展开\")+\"\\n                \"),a(\"a-icon\",{attrs:{type:e.toggleSearchStatus?\"up\":\"down\"}})],1):e._e()],1)])],2):e._e()],1)],1),a(\"a-table\",{ref:\"table\",staticClass:\"j-table-force-nowrap\",staticStyle:{\"min-height\":\"300px\"},attrs:{size:\"small\",bordered:\"\",rowKey:\"id\",columns:e.table.columns,dataSource:e.table.dataSource,pagination:e.table.pagination,loading:e.table.loading,scroll:e.table.scroll,rowSelection:{fixed:!0,columnWidth:40,type:e.multiSelectable?\"checkbox\":\"radio\",selectedRowKeys:e.table.selectedRowKeys,onChange:e.handleChangeInTableSelect}},on:{change:e.handleChangeInTable}})],1)},n=[],s=(a(\"6eb7\"),a(\"0fea\")),i=a(\"89f2\"),l=a(\"ca00\");function o(e){return d(e)||u(e)||c()}function c(){throw new TypeError(\"Invalid attempt to spread non-iterable instance\")}function u(e){if(Symbol.iterator in Object(e)||\"[object Arguments]\"===Object.prototype.toString.call(e))return Array.from(e)}function d(e){if(Array.isArray(e)){for(var t=0,a=new Array(e.length);t<e.length;t++)a[t]=e[t];return a}}var h={name:\"OnlCgreportSelectModal\",mixins:[],components:{},props:{title:{type:String,default:\"选择\"},reportId:{type:String,required:!0},params:{type:Object,default:function(){return{}}},multiSelectable:{type:Boolean,default:!1},width:{type:Number,default:1e3},fullscreen:{type:Boolean,default:!1},switchFullscreen:{type:Boolean,default:!0}},data:function(){return{visible:!1,queryFields:[],queryParamsMap:{},sqlParams:{},sorter:{column:\"\",order:\"desc\"},dictOptions:{},toggleSearchStatus:!1,description:\"\",url:{getColumnsAndData:\"/online/cgreport/api/getColumnsAndData/\",getqueryFields:\"/online/cgreport/api/getQueryInfo/\",getSqlParams:\"/online/cgreport/api/getParamsInfo/\"},table:{loading:!0,columns:[],dataSource:[],selectedRowKeys:[],selectionRows:[],scroll:{x:!0},pagination:{current:1,pageSize:10,pageSizeOptions:[\"10\",\"20\",\"30\"],showTotal:function(e,t){return t[0]+\"-\"+t[1]+\" 共\"+e+\"条\"},showQuickJumper:!0,showSizeChanger:!0,total:0}},cgreportHeadName:\"\"}},mounted:function(){this.initSqlParams(),this.initQueryFields()},computed:{queryParams:{get:function(){return this.queryParamsMap[this.reportId]},set:function(e){this.$set(this.queryParamsMap,this.reportId,e)}}},methods:{initSqlParams:function(){var e=this;this.sqlParams={},Object(s[\"c\"])(\"\".concat(this.url.getSqlParams).concat(this.reportId)).then((function(t){if(t.success){if(t.result&&t.result.length>0){var a=!0,r=!1,n=void 0;try{for(var s,i=t.result[Symbol.iterator]();!(a=(s=i.next()).done);a=!0){var l=s.value;e.sqlParams[\"self_\"+l.paramName]=e.params[l.paramName]?e.params[l.paramName]:\"\"}}catch(o){r=!0,n=o}finally{try{a||null==i.return||i.return()}finally{if(r)throw n}}}}else e.$message.warning(t.message)}))},initQueryFields:function(){var e=this;Object(s[\"c\"])(\"\".concat(this.url.getqueryFields).concat(this.reportId)).then((function(t){t.success?e.queryFields=t.result:e.$message.warning(t.message),e.loadData()}))},initQueryParams:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=[],r=!0,n=!1,s=void 0;try{for(var i,l=this.queryFields[Symbol.iterator]();!(r=(i=l.next()).done);r=!0){var o=i.value;if(o.readOnly=!1,t)for(var c in e)if(o.field===c){e[c]&&(o.readOnly=\"\"!==e[c]);break}a.push(o)}}catch(u){n=!0,s=u}finally{try{r||null==l.return||l.return()}finally{if(n)throw s}}this.queryFields=a,this.queryParams=e,this.loadData()},loadData:function(e){var t=this;1===e&&(this.table.pagination.current=1);var a=this.getQueryParams();this.table.loading=!0,Object(s[\"c\"])(\"\".concat(this.url.getColumnsAndData).concat(this.reportId),a).then((function(e){if(e.success){var a=e.result,r=a.data,n=a.columns,s=a.cgreportHeadName,l=a.dictOptions,c=a.fieldHrefSlots;t.dictOptions=l;for(var u=0;u<n.length;u++)n[u].customRender&&function(){var e=n[u].customRender;n[u].customRender=function(a){return a?Object(i[\"c\"])(t.dictOptions[e],a+\"\"):a}}();t.table.columns=o(n),t.cgreportHeadName=s,t.fieldHrefSlots=c,r?(t.table.pagination.total=Number(r.total),t.table.dataSource=r.records):(t.table.pagination.total=0,t.table.dataSource=[])}else t.$message.warn(\"查询失败：\"+e.message)})).catch((function(e){t.$message.error(\"查询失败\")})).finally((function(){t.table.loading=!1}))},getQueryParams:function(){var e=Object.assign({},this.queryParams,this.sorter,this.sqlParams);return e.pageNo=this.table.pagination.current,e.pageSize=this.table.pagination.pageSize,Object(l[\"d\"])(e)},searchByQuery:function(){this.loadData(1)},searchReset:function(){var e={},t=!0,a=!1,r=void 0;try{for(var n,s=this.queryFields[Symbol.iterator]();!(t=(n=s.next()).done);t=!0){var i=n.value;i.readOnly&&(queryParam[i.field]=this.queryParams[i.field])}}catch(l){a=!0,r=l}finally{try{t||null==s.return||s.return()}finally{if(a)throw r}}this.queryParams=e,this.loadData(1)},handleToggleSearch:function(){this.toggleSearchStatus=!this.toggleSearchStatus},handleChangeInTableSelect:function(e,t){this.table.selectedRowKeys=e,this.table.selectionRows=t},handleChangeInTable:function(e,t,a){Object.keys(a).length>0?(this.sorter.column=a.field,this.sorter.order=\"ascend\"===a.order?\"asc\":\"desc\"):(this.sorter.column=null,this.sorter.order=null),this.table.pagination=e,this.loadData()},handleOk:function(){this.$emit(\"callback\",this.table.selectionRows)}}},m=h,f=(a(\"7842\"),a(\"2877\")),g=Object(f[\"a\"])(m,r,n,!1,null,\"a56558c8\",null);t[\"default\"]=g.exports},\"6eb7\":function(e,t,a){},7842:function(e,t,a){\"use strict\";var r=a(\"e9c9\"),n=a.n(r);n.a},e9c9:function(e,t,a){}}]);","extractedComments":[]}