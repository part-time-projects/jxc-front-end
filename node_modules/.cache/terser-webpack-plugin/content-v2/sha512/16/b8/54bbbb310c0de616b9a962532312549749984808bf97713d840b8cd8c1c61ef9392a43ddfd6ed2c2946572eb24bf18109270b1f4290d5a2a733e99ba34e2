{"code":"(window[\"webpackJsonp\"]=window[\"webpackJsonp\"]||[]).push([[\"chunk-45270f86\",\"chunk-45270f86\",\"chunk-2d21a756\"],{\"33e3\":function(e,t,a){\"use strict\";a.r(t),a.d(t,\"billModalMixin\",(function(){return o}));var r=a(\"e2e0\"),l=a(\"0fea\"),o={data:function(){return{action:\"\",spans:{labelCol1:{span:2},wrapperCol1:{span:22},labelCol1_5:{span:3},wrapperCol1_5:{span:21},labelCol2:{span:4},wrapperCol2:{span:20},labelCol3:{span:6},wrapperCol3:{span:18},labelCol6:{span:12},wrapperCol6:{span:12}}}},computed:{readOnly:function(){return\"add\"!==this.action&&\"edit\"!==this.action}},methods:{onEntryAdded:function(e){var t=e.row,a=e.target,r=a.getValuesSync({validate:!1}),l=r.values,o=0,i=!0,s=!1,n=void 0;try{for(var c,d=l[Symbol.iterator]();!(i=(c=d.next()).done);i=!0){var u=c.value,p=Number(u[\"entryNo\"]);!isNaN(p)&&p>o&&(o=p)}}catch(h){s=!0,n=h}finally{try{i||null==d.return||d.return()}finally{if(s)throw n}}o+=this.entryNoStep||10,a.setValues([{rowKey:t.id,values:{entryNo:o}}])},handleSave:function(){this.handleOk()},handleSubmit:function(){var e=this;this.form.setFieldsValue({billProcStatus:\"13\"}),this.getAllTable().then((function(t){return Object(r[\"d\"])(e.form,t)})).then((function(t){if(\"function\"!==typeof e.classifyIntoFormData)throw e.throwNotFunction(\"classifyIntoFormData\");var a=e.classifyIntoFormData(t);return e.request(a)})).catch((function(t){e.form.setFieldsValue({billProcStatus:\"12\"}),t.error===r[\"b\"]&&(e.activeKey=null==t.index?e.activeKey:e.refKeys[t.index])}))},handleApproved:function(){var e=this;Object(l[\"j\"])(e.url.approve,{id:e.model.id}).then((function(t){t.success?(e.$message.success(t.message),e.$emit(\"ok\"),e.close()):e.$message.warning(t.message)}))}}}},\"88bc\":function(e,t,a){(function(t){var a=1/0,r=9007199254740991,l=\"[object Arguments]\",o=\"[object Function]\",i=\"[object GeneratorFunction]\",s=\"[object Symbol]\",n=\"object\"==typeof t&&t&&t.Object===Object&&t,c=\"object\"==typeof self&&self&&self.Object===Object&&self,d=n||c||Function(\"return this\")();function u(e,t,a){switch(a.length){case 0:return e.call(t);case 1:return e.call(t,a[0]);case 2:return e.call(t,a[0],a[1]);case 3:return e.call(t,a[0],a[1],a[2])}return e.apply(t,a)}function p(e,t){var a=-1,r=e?e.length:0,l=Array(r);while(++a<r)l[a]=t(e[a],a,e);return l}function h(e,t){var a=-1,r=t.length,l=e.length;while(++a<r)e[l+a]=t[a];return e}var f=Object.prototype,y=f.hasOwnProperty,m=f.toString,b=d.Symbol,v=f.propertyIsEnumerable,g=b?b.isConcatSpreadable:void 0,C=Math.max;function w(e,t,a,r,l){var o=-1,i=e.length;a||(a=R),l||(l=[]);while(++o<i){var s=e[o];t>0&&a(s)?t>1?w(s,t-1,a,r,l):h(l,s):r||(l[l.length]=s)}return l}function k(e,t){return e=Object(e),N(e,t,(function(t,a){return a in e}))}function N(e,t,a){var r=-1,l=t.length,o={};while(++r<l){var i=t[r],s=e[i];a(s,i)&&(o[i]=s)}return o}function O(e,t){return t=C(void 0===t?e.length-1:t,0),function(){var a=arguments,r=-1,l=C(a.length-t,0),o=Array(l);while(++r<l)o[r]=a[t+r];r=-1;var i=Array(t+1);while(++r<t)i[r]=a[r];return i[t]=o,u(e,this,i)}}function R(e){return B(e)||x(e)||!!(g&&e&&e[g])}function j(e){if(\"string\"==typeof e||A(e))return e;var t=e+\"\";return\"0\"==t&&1/e==-a?\"-0\":t}function x(e){return I(e)&&y.call(e,\"callee\")&&(!v.call(e,\"callee\")||m.call(e)==l)}var B=Array.isArray;function S(e){return null!=e&&_(e.length)&&!T(e)}function I(e){return E(e)&&S(e)}function T(e){var t=V(e)?m.call(e):\"\";return t==o||t==i}function _(e){return\"number\"==typeof e&&e>-1&&e%1==0&&e<=r}function V(e){var t=typeof e;return!!e&&(\"object\"==t||\"function\"==t)}function E(e){return!!e&&\"object\"==typeof e}function A(e){return\"symbol\"==typeof e||E(e)&&m.call(e)==s}var D=O((function(e,t){return null==e?{}:k(e,p(w(t,1),j))}));e.exports=D}).call(this,a(\"c8ba\"))},\"92a0\":function(e,t,a){},bc32:function(e,t,a){\"use strict\";function r(){var e=new Date,t=\"-\",a=e.getFullYear(),r=e.getMonth()+1,l=e.getDate();r>=1&&r<=9&&(r=\"0\"+r),l>=0&&l<=9&&(l=\"0\"+l);var o=a+t+r+t+l;return o}a.r(t),a.d(t,\"getFormatDate\",(function(){return r})),String.prototype.format=function(){var e=arguments;return this.replace(/\\{(\\d+)\\}/g,(function(t,a){return e.length>a?e[a]:\"\"}))}},c242:function(e,t,a){\"use strict\";var r=a(\"92a0\"),l=a.n(r);l.a},d0ed:function(e,t,a){\"use strict\";a.d(t,\"a\",(function(){return i}));var r=a(\"7550\"),l=a(\"e2e0\"),o=a(\"0fea\"),i={components:{JEditableTable:r[\"default\"]},data:function(){return{title:\"操作\",visible:!1,form:this.$form.createForm(this),confirmLoading:!1,model:{},labelCol:{xs:{span:24},sm:{span:6}},wrapperCol:{xs:{span:24},sm:{span:18}}}},methods:{getAllTable:function(){var e=this;if(!(this.refKeys instanceof Array))throw this.throwNotArray(\"refKeys\");var t=this.refKeys.map((function(t){return Object(l[\"c\"])(e,t)}));return Promise.all(t)},eachAllTable:function(e){this.getAllTable().then((function(t){t.forEach((function(t,a){\"function\"===typeof e&&e(t,a)}))}))},add:function(){\"function\"===typeof this.addBefore&&this.addBefore();var e=this.addDefaultRowNum;\"number\"!==typeof e&&(e=1),this.eachAllTable((function(t){t.add(e)})),\"function\"===typeof this.addAfter&&this.addAfter(this.model),this.edit({})},edit:function(e){\"function\"===typeof this.editBefore&&this.editBefore(e),this.visible=!0,this.activeKey=this.refKeys[0],this.form.resetFields(),this.model=Object.assign({},e),\"function\"===typeof this.editAfter&&this.editAfter(this.model)},close:function(){this.visible=!1,this.eachAllTable((function(e){e.initialize()})),this.$emit(\"close\")},requestSubTableData:function(e,t,a,r){a.loading=!0,Object(o[\"c\"])(e,t).then((function(e){var t=e.result,l=[];t&&(Array.isArray(t)?l=t:Array.isArray(t.records)&&(l=t.records)),a.dataSource=l,\"function\"===typeof r&&r(e)})).finally((function(){a.loading=!1}))},request:function(e){var t=this,a=this.url.add,r=\"post\";this.model.id&&(a=this.url.edit,r=\"put\"),this.confirmLoading=!0,Object(o[\"h\"])(a,e,r).then((function(e){e.success?(t.$message.success(e.message),t.$emit(\"ok\"),t.close()):t.$message.warning(e.message)})).finally((function(){t.confirmLoading=!1}))},handleChangeTabs:function(e){Object(l[\"c\"])(this,e).then((function(e){e.resetScrollTop()}))},handleCancel:function(){this.close()},handleOk:function(){var e=this;this.getAllTable().then((function(t){return Object(l[\"d\"])(e.form,t)})).then((function(t){if(\"function\"!==typeof e.classifyIntoFormData)throw e.throwNotFunction(\"classifyIntoFormData\");var a=e.classifyIntoFormData(t);return e.request(a)})).catch((function(t){t.error===l[\"b\"]&&(e.activeKey=null==t.index?e.activeKey:e.refKeys[t.index])}))},throwNotFunction:function(e){return\"\".concat(e,\" 未定义或不是一个函数\")},throwNotArray:function(e){return\"\".concat(e,\" 未定义或不是一个数组\")}}}},d0f4:function(e,t,a){\"use strict\";a.r(t);var r=function(){var e=this,t=this,a=t.$createElement,r=t._self._c||a;return r(\"j-modal\",{attrs:{title:\"库存盘点卡 - \"+t.title,width:t.width,visible:t.visible,confirmLoading:t.confirmLoading,maskClosable:!1,keyboard:!1,forceRender:!0,switchFullscreen:\"\"},on:{ok:t.handleOk,cancel:t.handleCancel}},[r(\"template\",{slot:\"footer\"},[\"detail\"!==t.action?r(\"a-button\",{key:\"cancel\",on:{click:t.handleCancel}},[t._v(\"取消\")]):t._e(),\"add\"===t.action?r(\"a-button\",{key:\"ok\",attrs:{type:\"primary\",loading:t.confirmLoading},on:{click:t.handleOk}},[t._v(\"确定\")]):t._e(),\"edit\"===t.action?r(\"a-button\",{key:\"save\",attrs:{type:\"primary\",loading:t.confirmLoading},on:{click:t.handleSave}},[t._v(\"保存\")]):t._e(),\"edit\"===t.action?r(\"a-button\",{key:\"submit\",attrs:{type:\"primary\",loading:t.confirmLoading},on:{click:t.handleSubmit}},[t._v(\"提交\")]):t._e(),\"detail\"===t.action?r(\"a-button\",{key:\"close\",attrs:{type:\"primary\"},on:{click:t.handleCancel}},[t._v(\"关闭\")]):t._e(),\"approve\"===t.action?r(\"a-button\",{key:\"approved\",attrs:{type:\"primary\"},on:{click:t.handleApproved}},[t._v(\"审核通过\")]):t._e()],1),r(\"a-spin\",{attrs:{spinning:t.confirmLoading}},[r(\"a-form\",{attrs:{form:t.form}},[r(\"a-row\",[r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"处理状态\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"billProcStatus\"],expression:\"['billProcStatus']\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"x_bill_proc_status\"}})],1)],1),r(\"a-col\",{attrs:{span:4}},[r(\"a-form-item\",{attrs:{label:\"是否通过\",labelCol:t.spans.labelCol6,wrapperCol:t.spans.wrapperCol6}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"isApproved\"],expression:\"['isApproved']\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"yn\"}})],1)],1),r(\"a-col\",{attrs:{span:4}},[r(\"a-form-item\",{attrs:{label:\"是否关闭\",labelCol:t.spans.labelCol6,wrapperCol:t.spans.wrapperCol6}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"isClosed\"],expression:\"['isClosed']\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"yn\"}})],1)],1),r(\"a-col\",{attrs:{span:4}},[r(\"a-form-item\",{attrs:{label:\"是否作废\",labelCol:t.spans.labelCol6,wrapperCol:t.spans.wrapperCol6}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"isVoided\"],expression:\"['isVoided']\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"yn\"}})],1)],1),r(\"a-col\",{attrs:{span:4}},[r(\"a\",{staticStyle:{float:\"right\",\"margin-top\":\"10px\"},on:{click:function(){return t.moreStatus=!t.moreStatus}}},[t._v(\"\\n            \"+t._s(t.moreStatus?\"收起\":\"展开\")+\"\\n            \"),r(\"a-icon\",{attrs:{type:t.moreStatus?\"up\":\"down\"}})],1)])],1),r(\"a-row\",{directives:[{name:\"show\",rawName:\"v-show\",value:t.moreStatus,expression:\"moreStatus\"}]},[r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"创建时间\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-date\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"createTime\",t.validatorRules.createTime],expression:\"[ 'createTime', validatorRules.createTime]\"}],staticStyle:{width:\"100%\"},attrs:{readOnly:!0,\"trigger-change\":!0}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"创建人\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"createBy\",t.validatorRules.createBy],expression:\"['createBy', validatorRules.createBy]\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"sys_user,realname,username\"}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"创建部门\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"sysOrgCode\",t.validatorRules.sysOrgCode],expression:\"['sysOrgCode', validatorRules.sysOrgCode]\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"sys_depart,depart_name,org_code\"}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"生效时间\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-date\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"effectiveTime\",t.validatorRules.effectiveTime],expression:\"[ 'effectiveTime', validatorRules.effectiveTime]\"}],staticStyle:{width:\"100%\"},attrs:{readOnly:!0,showTime:!0,\"trigger-change\":!0}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"审核人\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"approverId\",t.validatorRules.approverId],expression:\"['approverId', validatorRules.approverId]\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"sys_user,realname,username\"}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"流程\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"a-input\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"flowId\",t.validatorRules.flowId],expression:\"[ 'flowId', validatorRules.flowId]\"}],attrs:{readOnly:!0}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"修改时间\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-date\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"updateTime\",t.validatorRules.updateTime],expression:\"[ 'updateTime', validatorRules.updateTime]\"}],staticStyle:{width:\"100%\"},attrs:{readOnly:!0,\"trigger-change\":!0}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"修改人\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"updateBy\",t.validatorRules.updateBy],expression:\"['updateBy', validatorRules.updateBy]\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"sys_user,realname,username\"}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"是否红字\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"isRubric\",t.validatorRules.isRubric],expression:\"['isRubric', validatorRules.isRubric]\"}],attrs:{type:\"list\",\"trigger-change\":!0,dictCode:\"yn\"}})],1)],1)],1),r(\"a-row\",[r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"单据编号\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"a-input\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"billNo\",t.validatorRules.billNo],expression:\"[ 'billNo', validatorRules.billNo]\"}],attrs:{readOnly:!0}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"单据日期\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-date\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"billDate\",t.validatorRules.billDate],expression:\"[ 'billDate', validatorRules.billDate]\"}],staticStyle:{width:\"100%\"},attrs:{readOnly:t.readOnly,placeholder:\"请选择单据日期\",\"trigger-change\":!0}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"制单人\",labelCol:t.spans.labelCol3,wrapperCol:t.spans.wrapperCol3}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"createBy\",t.validatorRules.createBy],expression:\"['createBy', validatorRules.createBy]\"}],attrs:{disabled:\"\",type:\"list\",\"trigger-change\":!0,dictCode:\"sys_user,realname,username\"}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"盘点人\",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"checkerId\"],expression:\"['checkerId']\"}],attrs:{type:\"list\",\"trigger-change\":!0,dictCode:\"sys_user,realname,username\",placeholder:\"请选择盘点人\"}})],1)],1),r(\"a-col\",{attrs:{span:16}},[r(\"a-form-item\",{attrs:{label:\"备注\",labelCol:t.spans.labelCol1_5,wrapperCol:t.spans.wrapperCol1_5}},[r(\"a-textarea\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"remark\",t.validatorRules.remark],expression:\"[ 'remark', validatorRules.remark]\"}],attrs:{readOnly:t.readOnly,rows:\"1\",autoSize:\"\"}})],1)],1),r(\"a-col\",{attrs:{span:24}},[r(\"a-form-item\",{attrs:{label:\"附件\",labelCol:t.spans.labelCol1,wrapperCol:t.spans.wrapperCol1}},[r(\"j-upload\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"attachment\",t.validatorRules.attachment],expression:\"['attachment', validatorRules.attachment]\"}],attrs:{disabled:t.readOnly,\"trigger-change\":!0}})],1)],1)],1),r(\"a-divider\",{staticStyle:{\"font-size\":\"14px\",color:\"#bfbfbf\"},attrs:{orientation:\"left\"}},[t._v(\"盘点范围\")]),r(\"a-row\",[r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"仓库\",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"warehouseId\",t.validatorRules.warehouseId],expression:\"['warehouseId', validatorRules.warehouseId]\"}],attrs:{disabled:\"add\"!==t.action,type:\"list\",\"trigger-change\":!0,dictCode:\"bas_warehouse,name,id\",placeholder:\"请选择仓库\"},on:{change:function(t){return e.checkRange.warehouseId=t||\"\"}}})],1)],1),r(\"a-col\",{attrs:{span:8}},[r(\"a-form-item\",{attrs:{label:\"物料分类\",labelCol:t.labelCol,wrapperCol:t.wrapperCol}},[r(\"j-dict-select-tag\",{directives:[{name:\"decorator\",rawName:\"v-decorator\",value:[\"materialCategoryId\"],expression:\"['materialCategoryId']\"}],attrs:{disabled:\"add\"!==t.action,type:\"list\",\"trigger-change\":!0,dictCode:\"bas_material_category,name,id\",placeholder:\"请选择物料分类\"},on:{change:function(t){return e.checkRange.materialCategoryId=t||\"\"}}})],1)],1),r(\"a-col\",{attrs:{span:8}},[\"add\"===t.action?r(\"div\",[r(\"a-button\",{staticStyle:{margin:\"5px 0 0 36px\"},attrs:{disabled:!t.isCheckRangeChange,type:\"primary\"},on:{click:t.handleCheckRangeOk}},[t._v(\"确定\")])],1):t._e()])],1)],1),r(\"a-tabs\",{on:{change:t.handleChangeTabs},model:{value:t.activeKey,callback:function(e){t.activeKey=e},expression:\"activeKey\"}},[r(\"a-tab-pane\",{key:t.refKeys[0],attrs:{tab:\"明细\",forceRender:!0}},[r(\"j-editable-table\",{directives:[{name:\"show\",rawName:\"v-show\",value:!t.isCheckRangeChange,expression:\"!isCheckRangeChange\"}],ref:t.refKeys[0],attrs:{disabled:t.readOnly,loading:t.stkCheckBillEntryTable.loading,columns:t.stkCheckBillEntryTable.columns,dataSource:t.stkCheckBillEntryTable.dataSource,maxHeight:300,rowNumber:!1,rowSelection:!1,actionButton:!1},on:{valueChange:t.onValueChange}})],1),r(\"a-tab-pane\",{key:t.refKeys[1],attrs:{tab:\"add\"===t.action?\"\":\"新批次\",forceRender:!0}},[r(\"j-editable-table\",{ref:t.refKeys[1],attrs:{disabled:t.readOnly,loading:t.stkCheckBillEntryTable.loading,columns:t.stkCheckBillEntryTable.columnsNew,dataSource:t.stkCheckBillEntryTable.dataSourceNew,maxHeight:300,rowNumber:!1,rowSelection:!0,actionButton:!t.readOnly},on:{valueChange:t.onValueChange,added:t.onInEntryAdded}})],1)],1)],1)],2)},l=[],o=a(\"88bc\"),i=a.n(o),s=a(\"e2e0\"),n=a(\"d0ed\"),c=a(\"2dab\"),d=a(\"cf74\"),u=a(\"7b16\"),p=a(\"0fea\"),h=a(\"33e3\"),f=a(\"bc32\");function y(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,r)}return a}function m(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?y(Object(a),!0).forEach((function(t){b(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):y(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function b(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}var v={name:\"CheckBillModal\",mixins:[n[\"a\"],h[\"billModalMixin\"]],components:{JDate:c[\"default\"],JUpload:d[\"default\"],JDictSelectTag:u[\"default\"]},data:function(){return{width:\"1200px\",moreStatus:!1,entryNoStep:1,checkRange:{},lastCheckRange:{},addDefaultRowNum:0,validatorRules:{billNo:{rules:[{required:!0,message:\"请输入单据编号!\"}]},billDate:{rules:[{required:!0,message:\"请输入单据日期!\"}]},warehouseId:{rules:[{required:!0,message:\"请选择仓库!\"}]}},refKeys:[\"stkCheckBillEntry\",\"stkCheckBillEntryNew\"],tableKeys:[\"stkCheckBillEntry\",\"stkCheckBillEntryNew\"],activeKey:\"stkCheckBillEntry\",stkCheckBillEntryTable:{loading:!1,dataSource:[],columns:[{title:\"序号\",key:\"entryNo\",type:s[\"a\"].input,width:\"70px\",placeholder:\"请输入${title}\",defaultValue:\"\",disabled:!0},{title:\"是否新批次\",key:\"isNewBatch\",type:s[\"a\"].hidden,width:\"1px\",defaultValue:\"0\",disabled:!0},{title:\"仓库\",key:\"warehouseId\",type:s[\"a\"].select,dictCode:\"bas_warehouse,name,id\",width:\"150px\",defaultValue:\"\",options:[],disabled:!0},{title:\"物料\",key:\"materialId\",type:s[\"a\"].select,dictCode:\"bas_material,name,id\",width:\"150px\",defaultValue:\"\",options:[],disabled:!0},{title:\"批号\",key:\"batchNo\",type:s[\"a\"].input,width:\"220px\",defaultValue:\"\",disabled:!0},{title:\"供应商\",key:\"supplierId\",type:s[\"a\"].select,dictCode:\"bas_supplier,name,id\",width:\"150px\",defaultValue:\"\",disabled:!0},{title:\"计量单位\",key:\"unitId\",type:s[\"a\"].select,dictCode:\"bas_measure_unit,name,id\",width:\"100px\",defaultValue:\"\",options:[],disabled:!0},{title:\"账存数量\",key:\"bookQty\",type:s[\"a\"].input,width:\"100px\",placeholder:\"请输入${title}\",defaultValue:\"0\",disabled:!0},{title:\"实存数量\",key:\"qty\",type:s[\"a\"].inputNumber,width:\"100px\",placeholder:\"请输入${title}\",defaultValue:\"\"},{title:\"盈亏\",key:\"profitQty\",type:s[\"a\"].inputNumber,width:\"100px\",placeholder:\"请输入${title}\",defaultValue:\"\",disabled:!0},{title:\"备注\",key:\"remark\",type:s[\"a\"].input,width:\"200px\",placeholder:\"请输入${title}\",defaultValue:\"\"},{title:\"备注2\",key:\"remark2\",type:s[\"a\"].input,width:\"200px\",placeholder:\"请输入${title}\",defaultValue:\"\"},{title:\"备注3\",key:\"remark3\",type:s[\"a\"].input,width:\"200px\",placeholder:\"请输入${title}\",defaultValue:\"\"},{title:\"\",key:\"flag\",type:s[\"a\"].hidden,width:\"1px\",placeholder:\"\",defaultValue:\"\"}],dataSourceNew:[],columnsNew:[]},url:{add:\"/stock/stkCheckBill/add\",edit:\"/stock/stkCheckBill/edit\",approve:\"/stock/stkCheckBill/approve\",stkCheckBillEntry:{list:\"/stock/stkCheckBill/queryStkCheckBillEntryByMainId\",listByRange:\"/stock/stkCheckBill/queryStkCheckBillEntryByRange\"}}}},computed:{isCheckRangeChange:function(){return this.checkRange.warehouseId!==this.lastCheckRange.warehouseId||this.checkRange.materialCategoryId!==this.lastCheckRange.materialCategoryId}},created:function(){var e=!0,t=!1,a=void 0;try{for(var r,l=this.stkCheckBillEntryTable.columns[Symbol.iterator]();!(e=(r=l.next()).done);e=!0){var o=r.value,i=Object.assign({},o);[\"entryNo\",\"isNewBatch\",\"bookQty\",\"profitQty\"].includes(i.key)||(i.disabled=!1),\"isNewBatch\"===i.key&&(i.defaultValue=\"1\"),\"bookQty\"===i.key&&(i.defaultValue=\"0\"),this.stkCheckBillEntryTable.columnsNew.push(i)}}catch(s){t=!0,a=s}finally{try{e||null==l.return||l.return()}finally{if(t)throw a}}},methods:{getAllTable:function(){var e=this,t=this.tableKeys.map((function(t){return Object(s[\"c\"])(e,t)}));return Promise.all(t)},addInit:function(){this.checkRange={warehouseId:\"\",materialCategoryId:\"\"},this.lastCheckRange=Object.assign({},this.checkRange),this.model.billProcStatus=\"12\";var e=\"/sys/fillRule/executeRuleByCode/\",t=\"stock_check_bill_no\",a=this;Object(p[\"j\"])(e+t,{}).then((function(e){e.success&&(a.model.billNo=e.result,a.$nextTick((function(){a.form.setFieldsValue({billNo:e.result,billDate:Object(f[\"getFormatDate\"])()})})))}))},editAfter:function(){var e=this,t=this.stkCheckBillEntryTable.columns.filter((function(e){return\"qty\"===e.key}));\"add\"===this.action?(this.addInit(),t[0].validateRules=[{}]):\"edit\"===this.action&&(t[0].validateRules=[{required:!0,message:\"${title}不能为空\"}]);var a=i()(this.model,\"billNo\",\"billDate\",\"warehouseId\",\"materialCategoryId\",\"checkerId\",\"attachment\",\"remark\",\"billProcStatus\",\"approverId\",\"flowId\",\"isApproved\",\"effectiveTime\",\"isVoided\",\"isClosed\",\"sysOrgCode\",\"createBy\",\"createTime\",\"updateBy\",\"updateTime\");if(this.$nextTick((function(){e.form.setFieldsValue(a)})),this.model.id){var r=function(){var e=[],t=[],a=!0,r=!1,o=void 0;try{for(var i,s=l.stkCheckBillEntryTable.dataSource[Symbol.iterator]();!(a=(i=s.next()).done);a=!0){var n=i.value;0===n.isNewBatch?e.push(n):t.push(n)}}catch(c){r=!0,o=c}finally{try{a||null==s.return||s.return()}finally{if(r)throw o}}e.sort((function(e,t){return e.entryNo-t.entryNo})),l.stkCheckBillEntryTable.dataSource=e,t.sort((function(e,t){return e.entryNo-t.entryNo})),l.stkCheckBillEntryTable.dataSourceNew=t},l=this,o={id:this.model.id};this.requestSubTableData(this.url.stkCheckBillEntry.list,o,this.stkCheckBillEntryTable,r)}},classifyIntoFormData:function(e){var t=Object.assign(this.model,e.formValue);return m({},t,{stkCheckBillEntryList:e.tablesValue[0].values.concat(e.tablesValue[1].values)})},validateError:function(e){this.$message.error(e)},popupCallback:function(e){this.form.setFieldsValue(i()(e,\"billNo\",\"billDate\",\"warehouseId\",\"materialCategoryId\",\"checkerId\",\"attachment\",\"remark\",\"billProcStatus\",\"approverId\",\"flowId\",\"isApproved\",\"effectiveTime\",\"isVoided\",\"isClosed\",\"sysOrgCode\",\"createBy\",\"createTime\",\"updateBy\",\"updateTime\"))},handleCheckRangeOk:function(){this.requestSubTableData(this.url.stkCheckBillEntry.listByRange,this.checkRange,this.stkCheckBillEntryTable),this.lastCheckRange=Object.assign({},this.checkRange)},onInEntryAdded:function(e){this.onEntryAdded(e);var t=e.row,a=e.target,r=a.getValuesSync({validate:!1,rowIds:[t.id]}),l=r.values,o=this.model.billNo+\"-\"+l[0].entryNo;a.setValues([{rowKey:t.id,values:{batchNo:o,flag:\"1\"}}])},onValueChange:function(e){e.type;var t=e.row,a=e.column,r=e.value,l=e.target;if(null!=t.flag&&\"\"!==t.flag||l.setValues([{rowKey:t.id,values:{flag:\"0\"}}]),\"entryNo\"!==a.key||\"1\"!==t.flag&&\"\"!==t.batchNo&&null!=t.batchNo?\"batchNo\"===a.key&&l.setValues([{rowKey:t.id,values:{flag:\"0\"}}]):l.setValues([{rowKey:t.id,values:{batchNo:this.model.billNo+\"-\"+r,flag:\"1\"}}]),\"qty\"===a.key){var o=Number(r),i=Number(t.bookQty);isNaN(o)||isNaN(i)||l.setValues([{rowKey:t.id,values:{profitQty:o-i}}])}}}},g=v,C=(a(\"c242\"),a(\"2877\")),w=Object(C[\"a\"])(g,r,l,!1,null,\"4172e1ad\",null);t[\"default\"]=w.exports}}]);","extractedComments":[]}