{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\components\\jeecg\\JUpload.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\components\\jeecg\\JUpload.vue","mtime":1648374777541},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\n\nimport Vue from 'vue'\nimport { ACCESS_TOKEN } from \"@/store/mutation-types\"\nimport { getFileAccessHttpUrl } from '@/api/manage';\n\nconst FILE_TYPE_ALL = \"all\"\nconst FILE_TYPE_IMG = \"image\"\nconst FILE_TYPE_TXT = \"file\"\nconst uidGenerator=()=>{\n  return '-'+parseInt(Math.random()*10000+1,10);\n}\nconst getFileName=(path)=>{\n  if(path.lastIndexOf(\"\\\\\")>=0){\n    let reg=new RegExp(\"\\\\\\\\\",\"g\");\n    path = path.replace(reg,\"/\");\n  }\n  return path.substring(path.lastIndexOf(\"/\")+1);\n}\nexport default {\n  name: 'JUpload',\n  data(){\n    return {\n      uploadAction:window._CONFIG['domianURL']+\"/sys/common/upload\",\n      headers:{},\n      fileList: [],\n      newFileList: [],\n      uploadGoOn:true,\n      previewVisible: false,\n      //---------------------------- begin 图片左右换位置 -------------------------------------\n      previewImage: '',\n      containerId:'',\n      top:'',\n      left:'',\n      moveDisplay:'none',\n      showMoverTask:false,\n      moverHold:false,\n      currentImg:''\n      //---------------------------- end 图片左右换位置 -------------------------------------\n    }\n  },\n  props:{\n    text:{\n      type:String,\n      required:false,\n      default:\"点击上传\"\n    },\n    fileType:{\n      type:String,\n      required:false,\n      default:FILE_TYPE_ALL\n    },\n    /*这个属性用于控制文件上传的业务路径*/\n    bizPath:{\n      type:String,\n      required:false,\n      default:\"temp\"\n    },\n    value:{\n      type:[String,Array],\n      required:false\n    },\n    // update-begin- --- author:wangshuai ------ date:20190929 ---- for:Jupload组件增加是否能够点击\n    disabled:{\n      type:Boolean,\n      required:false,\n      default: false\n    },\n    // update-end- --- author:wangshuai ------ date:20190929 ---- for:Jupload组件增加是否能够点击\n    //此属性被废弃了\n    triggerChange:{\n      type: Boolean,\n      required: false,\n      default: false\n    },\n    /**\n     * update -- author:lvdandan -- date:20190219 -- for:Jupload组件增加是否返回url，\n     * true：仅返回url\n     * false：返回fileName filePath fileSize\n     */\n    returnUrl:{\n      type:Boolean,\n      required:false,\n      default: true\n    },\n    number:{\n      type:Number,\n      required:false,\n      default: 0\n    },\n    buttonVisible:{\n      type:Boolean,\n      required:false,\n      default: true\n    },\n  },\n  watch:{\n    value:{\n      immediate: true,\n      handler() {\n        let val = this.value\n        if (val instanceof Array) {\n          if(this.returnUrl){\n            this.initFileList(val.join(','))\n          }else{\n            this.initFileListArr(val);\n          }\n        } else {\n          this.initFileList(val)\n        }\n      }\n    }\n  },\n  computed:{\n    isImageComp(){\n      return this.fileType === FILE_TYPE_IMG\n    },\n    complistType(){\n      return this.fileType === FILE_TYPE_IMG?'picture-card':'text'\n    }\n  },\n  created(){\n    const token = Vue.ls.get(ACCESS_TOKEN);\n    //---------------------------- begin 图片左右换位置 -------------------------------------\n    this.headers = {\"X-Access-Token\":token};\n    this.containerId = 'container-ty-'+new Date().getTime();\n    //---------------------------- end 图片左右换位置 -------------------------------------\n  },\n\n  methods:{\n    initFileListArr(val){\n      if(!val || val.length==0){\n        this.fileList = [];\n        return;\n      }\n      let fileList = [];\n      for(var a=0;a<val.length;a++){\n        let url = getFileAccessHttpUrl(val[a].filePath);\n        fileList.push({\n          uid:uidGenerator(),\n          name:val[a].fileName,\n          status: 'done',\n          url: url,\n          response:{\n            status:\"history\",\n            message:val[a].filePath\n          }\n        })\n      }\n      this.fileList = fileList\n    },\n    initFileList(paths){\n      if(!paths || paths.length==0){\n        //return [];\n        // update-begin- --- author:os_chengtgen ------ date:20190729 ---- for:issues:326,Jupload组件初始化bug\n        this.fileList = [];\n        return;\n        // update-end- --- author:os_chengtgen ------ date:20190729 ---- for:issues:326,Jupload组件初始化bug\n      }\n      let fileList = [];\n      let arr = paths.split(\",\")\n      for(var a=0;a<arr.length;a++){\n        let url = getFileAccessHttpUrl(arr[a]);\n        fileList.push({\n          uid:uidGenerator(),\n          name:getFileName(arr[a]),\n          status: 'done',\n          url: url,\n          response:{\n            status:\"history\",\n            message:arr[a]\n          }\n        })\n      }\n      this.fileList = fileList\n    },\n    handlePathChange(){\n      let uploadFiles = this.fileList\n      let path = ''\n      if(!uploadFiles || uploadFiles.length==0){\n        path = ''\n      }\n      let arr = [];\n\n      for(var a=0;a<uploadFiles.length;a++){\n        arr.push(uploadFiles[a].response.message)\n      }\n      if(arr.length>0){\n        path = arr.join(\",\")\n      }\n      this.$emit('change', path);\n    },\n    beforeUpload(file){\n      this.uploadGoOn=true\n      var fileType = file.type;\n      if(this.fileType===FILE_TYPE_IMG){\n        if(fileType.indexOf('image')<0){\n          this.$message.warning('请上传图片');\n          this.uploadGoOn=false\n          return false;\n        }\n      }\n      //TODO 扩展功能验证文件大小\n      return true\n    },\n    handleChange(info) {\n      console.log(\"--文件列表改变--\")\n      if(!info.file.status && this.uploadGoOn === false){\n        info.fileList.pop();\n      }\n      let fileList = info.fileList\n      if(info.file.status==='done'){\n        if(this.number>0){\n          fileList = fileList.slice(-this.number);\n        }\n        if(info.file.response.success){\n          fileList = fileList.map((file) => {\n            if (file.response) {\n              let reUrl = file.response.message;\n              file.url = getFileAccessHttpUrl(reUrl);\n            }\n            return file;\n          });\n        }\n        //this.$message.success(`${info.file.name} 上传成功!`);\n      }else if (info.file.status === 'error') {\n        this.$message.error(`${info.file.name} 上传失败.`);\n      }else if(info.file.status === 'removed'){\n        this.handleDelete(info.file)\n      }\n      this.fileList = fileList\n      if(info.file.status==='done' || info.file.status === 'removed'){\n        //returnUrl为true时仅返回文件路径\n        if(this.returnUrl){\n          this.handlePathChange()\n        }else{\n          //returnUrl为false时返回文件名称、文件路径及文件大小\n          this.newFileList = [];\n          for(var a=0;a<fileList.length;a++){\n            var fileJson = {\n              fileName:fileList[a].name,\n              filePath:fileList[a].response.message,\n              fileSize:fileList[a].size\n            };\n            this.newFileList.push(fileJson);\n          }\n          this.$emit('change', this.newFileList);\n        }\n      }\n    },\n    handleDelete(file){\n      //如有需要新增 删除逻辑\n      console.log(file)\n    },\n    handlePreview(file){\n      if(this.fileType === FILE_TYPE_IMG){\n        this.previewImage = file.url || file.thumbUrl;\n        this.previewVisible = true;\n      }else{\n        location.href=file.url\n      }\n    },\n    handleCancel(){\n      this.previewVisible = false;\n    },\n    //---------------------------- begin 图片左右换位置 -------------------------------------\n    moveLast(){\n      //console.log(ev)\n      //console.log(this.fileList)\n      //console.log(this.currentImg)\n      let index = this.getIndexByUrl();\n      if(index==0){\n        this.$message.warn('未知的操作')\n      }else{\n        let curr = this.fileList[index].url;\n        let last = this.fileList[index-1].url;\n        let arr =[]\n        for(let i=0;i<this.fileList.length;i++){\n          if(i==index-1){\n            arr.push(curr)\n          }else if(i==index){\n            arr.push(last)\n          }else{\n            arr.push(this.fileList[i].url)\n          }\n        }\n        this.currentImg = last\n        this.$emit('change',arr.join(','))\n      }\n    },\n    moveNext(){\n      let index = this.getIndexByUrl();\n      if(index==this.fileList.length-1){\n        this.$message.warn('已到最后~')\n      }else{\n        let curr = this.fileList[index].url;\n        let next = this.fileList[index+1].url;\n        let arr =[]\n        for(let i=0;i<this.fileList.length;i++){\n          if(i==index+1){\n            arr.push(curr)\n          }else if(i==index){\n            arr.push(next)\n          }else{\n            arr.push(this.fileList[i].url)\n          }\n        }\n        this.currentImg = next\n        this.$emit('change',arr.join(','))\n      }\n    },\n    getIndexByUrl(){\n      for(let i=0;i<this.fileList.length;i++){\n        if(this.fileList[i].url === this.currentImg || encodeURI(this.fileList[i].url) === this.currentImg){\n          return i;\n        }\n      }\n      return -1;\n    }\n  },\n  mounted(){\n    const moverObj = document.getElementById(this.containerId+'-mover');\n    moverObj.addEventListener('mouseover',()=>{\n      this.moverHold = true\n      this.moveDisplay = 'block';\n    });\n    moverObj.addEventListener('mouseout',()=>{\n      this.moverHold = false\n      this.moveDisplay = 'none';\n    });\n    let picList = document.getElementById(this.containerId)?document.getElementById(this.containerId).getElementsByClassName('ant-upload-list-picture-card'):[];\n    if(picList && picList.length>0){\n      picList[0].addEventListener('mouseover',(ev)=>{\n        ev = ev || window.event;\n        let target = ev.target || ev.srcElement;\n        if('ant-upload-list-item-info' == target.className){\n          this.showMoverTask=false\n          let item = target.parentElement\n          this.left = item.offsetLeft\n          this.top=item.offsetTop+item.offsetHeight-50;\n          this.moveDisplay = 'block';\n          this.currentImg = target.getElementsByTagName('img')[0].src\n        }\n\n      });\n\n      picList[0].addEventListener('mouseout',(ev)=>{\n        ev = ev || window.event;\n        let target = ev.target || ev.srcElement;\n        //console.log('移除',target)\n        if('ant-upload-list-item-info' == target.className){\n          this.showMoverTask=true\n          setTimeout(()=>{\n            if(this.moverHold === false)\n              this.moveDisplay = 'none';\n          },100)\n        }\n        if('ant-upload-list-item ant-upload-list-item-done' == target.className || 'ant-upload-list ant-upload-list-picture-card'== target.className){\n          this.moveDisplay = 'none';\n        }\n      })\n      //---------------------------- end 图片左右换位置 -------------------------------------\n    }\n  },\n  model: {\n    prop: 'value',\n    event: 'change'\n  }\n}\n",{"version":3,"sources":["JUpload.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4CA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"JUpload.vue","sourceRoot":"src/components/jeecg","sourcesContent":["<template>\r\n  <div :id=\"containerId\" style=\"position: relative\">\r\n\r\n    <!--  ---------------------------- begin 图片左右换位置 ------------------------------------- -->\r\n    <div class=\"movety-container\" :style=\"{top:top+'px',left:left+'px',display:moveDisplay}\" style=\"padding:0 8px;position: absolute;z-index: 91;height: 32px;width: 104px;text-align: center;\">\r\n      <div :id=\"containerId+'-mover'\" :class=\"showMoverTask?'uploadty-mover-mask':'movety-opt'\" style=\"margin-top: 12px\">\r\n        <a @click=\"moveLast\" style=\"margin: 0 5px;\"><a-icon type=\"arrow-left\" style=\"color: #fff;font-size: 16px\"/></a>\r\n        <a @click=\"moveNext\" style=\"margin: 0 5px;\"><a-icon type=\"arrow-right\" style=\"color: #fff;font-size: 16px\"/></a>\r\n      </div>\r\n    </div>\r\n    <!--  ---------------------------- end 图片左右换位置 ------------------------------------- -->\r\n\r\n    <a-upload\r\n      name=\"file\"\r\n      :multiple=\"true\"\r\n      :action=\"uploadAction\"\r\n      :headers=\"headers\"\r\n      :data=\"{'biz':bizPath}\"\r\n      :fileList=\"fileList\"\r\n      :beforeUpload=\"beforeUpload\"\r\n      @change=\"handleChange\"\r\n      :disabled=\"disabled\"\r\n      :returnUrl=\"returnUrl\"\r\n      :listType=\"complistType\"\r\n      @preview=\"handlePreview\"\r\n      :class=\"{'uploadty-disabled':disabled}\">\r\n      <template>\r\n        <div v-if=\"isImageComp\">\r\n          <a-icon type=\"plus\" />\r\n          <div class=\"ant-upload-text\">{{ text }}</div>\r\n        </div>\r\n        <a-button v-else-if=\"buttonVisible\">\r\n         <a-icon type=\"upload\" />{{ text }}\r\n        </a-button>\r\n      </template>\r\n    </a-upload>\r\n    <a-modal :visible=\"previewVisible\" :footer=\"null\" @cancel=\"handleCancel\">\r\n      <img alt=\"example\" style=\"width: 100%\" :src=\"previewImage\" />\r\n    </a-modal>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n\r\n  import Vue from 'vue'\r\n  import { ACCESS_TOKEN } from \"@/store/mutation-types\"\r\n  import { getFileAccessHttpUrl } from '@/api/manage';\r\n\r\n  const FILE_TYPE_ALL = \"all\"\r\n  const FILE_TYPE_IMG = \"image\"\r\n  const FILE_TYPE_TXT = \"file\"\r\n  const uidGenerator=()=>{\r\n    return '-'+parseInt(Math.random()*10000+1,10);\r\n  }\r\n  const getFileName=(path)=>{\r\n    if(path.lastIndexOf(\"\\\\\")>=0){\r\n      let reg=new RegExp(\"\\\\\\\\\",\"g\");\r\n      path = path.replace(reg,\"/\");\r\n    }\r\n    return path.substring(path.lastIndexOf(\"/\")+1);\r\n  }\r\n  export default {\r\n    name: 'JUpload',\r\n    data(){\r\n      return {\r\n        uploadAction:window._CONFIG['domianURL']+\"/sys/common/upload\",\r\n        headers:{},\r\n        fileList: [],\r\n        newFileList: [],\r\n        uploadGoOn:true,\r\n        previewVisible: false,\r\n        //---------------------------- begin 图片左右换位置 -------------------------------------\r\n        previewImage: '',\r\n        containerId:'',\r\n        top:'',\r\n        left:'',\r\n        moveDisplay:'none',\r\n        showMoverTask:false,\r\n        moverHold:false,\r\n        currentImg:''\r\n        //---------------------------- end 图片左右换位置 -------------------------------------\r\n      }\r\n    },\r\n    props:{\r\n      text:{\r\n        type:String,\r\n        required:false,\r\n        default:\"点击上传\"\r\n      },\r\n      fileType:{\r\n        type:String,\r\n        required:false,\r\n        default:FILE_TYPE_ALL\r\n      },\r\n      /*这个属性用于控制文件上传的业务路径*/\r\n      bizPath:{\r\n        type:String,\r\n        required:false,\r\n        default:\"temp\"\r\n      },\r\n      value:{\r\n        type:[String,Array],\r\n        required:false\r\n      },\r\n      // update-begin- --- author:wangshuai ------ date:20190929 ---- for:Jupload组件增加是否能够点击\r\n      disabled:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: false\r\n      },\r\n      // update-end- --- author:wangshuai ------ date:20190929 ---- for:Jupload组件增加是否能够点击\r\n      //此属性被废弃了\r\n      triggerChange:{\r\n        type: Boolean,\r\n        required: false,\r\n        default: false\r\n      },\r\n      /**\r\n       * update -- author:lvdandan -- date:20190219 -- for:Jupload组件增加是否返回url，\r\n       * true：仅返回url\r\n       * false：返回fileName filePath fileSize\r\n       */\r\n      returnUrl:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: true\r\n      },\r\n      number:{\r\n        type:Number,\r\n        required:false,\r\n        default: 0\r\n      },\r\n      buttonVisible:{\r\n        type:Boolean,\r\n        required:false,\r\n        default: true\r\n      },\r\n    },\r\n    watch:{\r\n      value:{\r\n        immediate: true,\r\n        handler() {\r\n          let val = this.value\r\n          if (val instanceof Array) {\r\n            if(this.returnUrl){\r\n              this.initFileList(val.join(','))\r\n            }else{\r\n              this.initFileListArr(val);\r\n            }\r\n          } else {\r\n            this.initFileList(val)\r\n          }\r\n        }\r\n      }\r\n    },\r\n    computed:{\r\n      isImageComp(){\r\n        return this.fileType === FILE_TYPE_IMG\r\n      },\r\n      complistType(){\r\n        return this.fileType === FILE_TYPE_IMG?'picture-card':'text'\r\n      }\r\n    },\r\n    created(){\r\n      const token = Vue.ls.get(ACCESS_TOKEN);\r\n      //---------------------------- begin 图片左右换位置 -------------------------------------\r\n      this.headers = {\"X-Access-Token\":token};\r\n      this.containerId = 'container-ty-'+new Date().getTime();\r\n      //---------------------------- end 图片左右换位置 -------------------------------------\r\n    },\r\n\r\n    methods:{\r\n      initFileListArr(val){\r\n        if(!val || val.length==0){\r\n          this.fileList = [];\r\n          return;\r\n        }\r\n        let fileList = [];\r\n        for(var a=0;a<val.length;a++){\r\n          let url = getFileAccessHttpUrl(val[a].filePath);\r\n          fileList.push({\r\n            uid:uidGenerator(),\r\n            name:val[a].fileName,\r\n            status: 'done',\r\n            url: url,\r\n            response:{\r\n              status:\"history\",\r\n              message:val[a].filePath\r\n            }\r\n          })\r\n        }\r\n        this.fileList = fileList\r\n      },\r\n      initFileList(paths){\r\n        if(!paths || paths.length==0){\r\n          //return [];\r\n          // update-begin- --- author:os_chengtgen ------ date:20190729 ---- for:issues:326,Jupload组件初始化bug\r\n          this.fileList = [];\r\n          return;\r\n          // update-end- --- author:os_chengtgen ------ date:20190729 ---- for:issues:326,Jupload组件初始化bug\r\n        }\r\n        let fileList = [];\r\n        let arr = paths.split(\",\")\r\n        for(var a=0;a<arr.length;a++){\r\n          let url = getFileAccessHttpUrl(arr[a]);\r\n          fileList.push({\r\n            uid:uidGenerator(),\r\n            name:getFileName(arr[a]),\r\n            status: 'done',\r\n            url: url,\r\n            response:{\r\n              status:\"history\",\r\n              message:arr[a]\r\n            }\r\n          })\r\n        }\r\n        this.fileList = fileList\r\n      },\r\n      handlePathChange(){\r\n        let uploadFiles = this.fileList\r\n        let path = ''\r\n        if(!uploadFiles || uploadFiles.length==0){\r\n          path = ''\r\n        }\r\n        let arr = [];\r\n\r\n        for(var a=0;a<uploadFiles.length;a++){\r\n          arr.push(uploadFiles[a].response.message)\r\n        }\r\n        if(arr.length>0){\r\n          path = arr.join(\",\")\r\n        }\r\n        this.$emit('change', path);\r\n      },\r\n      beforeUpload(file){\r\n        this.uploadGoOn=true\r\n        var fileType = file.type;\r\n        if(this.fileType===FILE_TYPE_IMG){\r\n          if(fileType.indexOf('image')<0){\r\n            this.$message.warning('请上传图片');\r\n            this.uploadGoOn=false\r\n            return false;\r\n          }\r\n        }\r\n        //TODO 扩展功能验证文件大小\r\n        return true\r\n      },\r\n      handleChange(info) {\r\n        console.log(\"--文件列表改变--\")\r\n        if(!info.file.status && this.uploadGoOn === false){\r\n          info.fileList.pop();\r\n        }\r\n        let fileList = info.fileList\r\n        if(info.file.status==='done'){\r\n          if(this.number>0){\r\n            fileList = fileList.slice(-this.number);\r\n          }\r\n          if(info.file.response.success){\r\n            fileList = fileList.map((file) => {\r\n              if (file.response) {\r\n                let reUrl = file.response.message;\r\n                file.url = getFileAccessHttpUrl(reUrl);\r\n              }\r\n              return file;\r\n            });\r\n          }\r\n          //this.$message.success(`${info.file.name} 上传成功!`);\r\n        }else if (info.file.status === 'error') {\r\n          this.$message.error(`${info.file.name} 上传失败.`);\r\n        }else if(info.file.status === 'removed'){\r\n          this.handleDelete(info.file)\r\n        }\r\n        this.fileList = fileList\r\n        if(info.file.status==='done' || info.file.status === 'removed'){\r\n          //returnUrl为true时仅返回文件路径\r\n          if(this.returnUrl){\r\n            this.handlePathChange()\r\n          }else{\r\n            //returnUrl为false时返回文件名称、文件路径及文件大小\r\n            this.newFileList = [];\r\n            for(var a=0;a<fileList.length;a++){\r\n              var fileJson = {\r\n                fileName:fileList[a].name,\r\n                filePath:fileList[a].response.message,\r\n                fileSize:fileList[a].size\r\n              };\r\n              this.newFileList.push(fileJson);\r\n            }\r\n            this.$emit('change', this.newFileList);\r\n          }\r\n        }\r\n      },\r\n      handleDelete(file){\r\n        //如有需要新增 删除逻辑\r\n        console.log(file)\r\n      },\r\n      handlePreview(file){\r\n        if(this.fileType === FILE_TYPE_IMG){\r\n          this.previewImage = file.url || file.thumbUrl;\r\n          this.previewVisible = true;\r\n        }else{\r\n          location.href=file.url\r\n        }\r\n      },\r\n      handleCancel(){\r\n        this.previewVisible = false;\r\n      },\r\n      //---------------------------- begin 图片左右换位置 -------------------------------------\r\n      moveLast(){\r\n        //console.log(ev)\r\n        //console.log(this.fileList)\r\n        //console.log(this.currentImg)\r\n        let index = this.getIndexByUrl();\r\n        if(index==0){\r\n          this.$message.warn('未知的操作')\r\n        }else{\r\n          let curr = this.fileList[index].url;\r\n          let last = this.fileList[index-1].url;\r\n          let arr =[]\r\n          for(let i=0;i<this.fileList.length;i++){\r\n            if(i==index-1){\r\n              arr.push(curr)\r\n            }else if(i==index){\r\n              arr.push(last)\r\n            }else{\r\n              arr.push(this.fileList[i].url)\r\n            }\r\n          }\r\n          this.currentImg = last\r\n          this.$emit('change',arr.join(','))\r\n        }\r\n      },\r\n      moveNext(){\r\n        let index = this.getIndexByUrl();\r\n        if(index==this.fileList.length-1){\r\n          this.$message.warn('已到最后~')\r\n        }else{\r\n          let curr = this.fileList[index].url;\r\n          let next = this.fileList[index+1].url;\r\n          let arr =[]\r\n          for(let i=0;i<this.fileList.length;i++){\r\n            if(i==index+1){\r\n              arr.push(curr)\r\n            }else if(i==index){\r\n              arr.push(next)\r\n            }else{\r\n              arr.push(this.fileList[i].url)\r\n            }\r\n          }\r\n          this.currentImg = next\r\n          this.$emit('change',arr.join(','))\r\n        }\r\n      },\r\n      getIndexByUrl(){\r\n        for(let i=0;i<this.fileList.length;i++){\r\n          if(this.fileList[i].url === this.currentImg || encodeURI(this.fileList[i].url) === this.currentImg){\r\n            return i;\r\n          }\r\n        }\r\n        return -1;\r\n      }\r\n    },\r\n    mounted(){\r\n      const moverObj = document.getElementById(this.containerId+'-mover');\r\n      moverObj.addEventListener('mouseover',()=>{\r\n        this.moverHold = true\r\n        this.moveDisplay = 'block';\r\n      });\r\n      moverObj.addEventListener('mouseout',()=>{\r\n        this.moverHold = false\r\n        this.moveDisplay = 'none';\r\n      });\r\n      let picList = document.getElementById(this.containerId)?document.getElementById(this.containerId).getElementsByClassName('ant-upload-list-picture-card'):[];\r\n      if(picList && picList.length>0){\r\n        picList[0].addEventListener('mouseover',(ev)=>{\r\n          ev = ev || window.event;\r\n          let target = ev.target || ev.srcElement;\r\n          if('ant-upload-list-item-info' == target.className){\r\n            this.showMoverTask=false\r\n            let item = target.parentElement\r\n            this.left = item.offsetLeft\r\n            this.top=item.offsetTop+item.offsetHeight-50;\r\n            this.moveDisplay = 'block';\r\n            this.currentImg = target.getElementsByTagName('img')[0].src\r\n          }\r\n\r\n        });\r\n\r\n        picList[0].addEventListener('mouseout',(ev)=>{\r\n          ev = ev || window.event;\r\n          let target = ev.target || ev.srcElement;\r\n          //console.log('移除',target)\r\n          if('ant-upload-list-item-info' == target.className){\r\n            this.showMoverTask=true\r\n            setTimeout(()=>{\r\n              if(this.moverHold === false)\r\n                this.moveDisplay = 'none';\r\n            },100)\r\n          }\r\n          if('ant-upload-list-item ant-upload-list-item-done' == target.className || 'ant-upload-list ant-upload-list-picture-card'== target.className){\r\n            this.moveDisplay = 'none';\r\n          }\r\n        })\r\n        //---------------------------- end 图片左右换位置 -------------------------------------\r\n      }\r\n    },\r\n    model: {\r\n      prop: 'value',\r\n      event: 'change'\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\">\r\n.uploadty-disabled{\r\n  .ant-upload-list-item {\r\n    .anticon-close{\r\n      display: none;\r\n    }\r\n    .anticon-delete{\r\n      display: none;\r\n    }\r\n  }\r\n}\r\n  //---------------------------- begin 图片左右换位置 -------------------------------------\r\n  .uploadty-mover-mask{\r\n    background-color: rgba(0, 0, 0, 0.5);\r\n    opacity: .8;\r\n    color: #fff;\r\n    height: 28px;\r\n    line-height: 28px;\r\n  }\r\n  //---------------------------- end 图片左右换位置 -------------------------------------\r\n</style>"]}]}