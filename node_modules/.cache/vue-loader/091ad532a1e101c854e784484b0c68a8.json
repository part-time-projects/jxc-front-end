{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\system\\modules\\DeptRoleUserModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\system\\modules\\DeptRoleUserModal.vue","mtime":1648374778152},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {httpAction, getAction} from '@/api/manage'\nimport  JEllipsis  from '@/components/jeecg/JEllipsis'\nimport {initDictOptions} from '@/components/dict/JDictSelectUtil'\n\nexport default {\n  name: 'DeptRoleUserModal',\n  components: {\n    JEllipsis\n  },\n  data() {\n    return {\n      currentDeptId:\"\",\n      title: \"部门角色分配\",\n      visible: false,\n      model: {},\n      labelCol: {\n        xs: {span: 24},\n        sm: {span: 5},\n      },\n      wrapperCol: {\n        xs: {span: 24},\n        sm: {span: 16},\n      },\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      validatorRules: {},\n      url: {\n        add: \"/sys/sysDepartRole/deptRoleUserAdd\",\n        getDeptRoleList:\"/sys/sysDepartRole/getDeptRoleList\",\n        getDeptRoleByUserId:\"/sys/sysDepartRole/getDeptRoleByUserId\"\n      },\n      designNameOption: [],\n      userId: \"\",\n      newRoleId:\"\",\n      oldRoleId:\"\",\n      designNameValue:[],\n      desformList: [],\n    }\n  },\n  created() {\n\n  },\n  methods: {\n    add(record,departId) {\n      this.userId = record.id;\n      this.currentDeptId = departId;\n      this.loadDesformList();\n      this.edit({});\n    },\n    edit(record) {\n      this.form.resetFields();\n      this.model = Object.assign({}, record);\n      this.visible = true;\n      getAction(this.url.getDeptRoleByUserId,{userId:this.userId}).then((res) => {\n        if (res.success) {\n          var designName = [];\n          for (let value of res.result) {\n            designName.push(value.droleId)\n          }\n          this.oldRoleId=designName.join(\",\");\n          this.designNameValue = designName;\n          this.newRoleId = designName.join(\",\");\n        }\n      });\n    },\n    close() {\n      this.$emit('close');\n      this.visible = false;\n    },\n    handleSubmit() {\n      const that = this;\n      // 触发表单验证\n      that.confirmLoading = true;\n      let  httpurl = this.url.add;\n      let  method = 'post';\n      let formData = Object.assign(this.model, {});\n      //时间格式化\n      formData.userId = this.userId;\n      formData.newRoleId=this.newRoleId;\n      formData.oldRoleId=this.oldRoleId;\n      httpAction(httpurl, formData, method).then((res) => {\n        if (res.success) {\n          that.$message.success(res.message);\n          that.$emit('reload');\n          that.$emit('ok');\n        } else {\n          that.$message.warning(res.message);\n        }\n      }).finally(() => {\n        that.confirmLoading = false;\n        that.close();\n      })\n    },\n    handleCancel() {\n      this.designNameOption=[];\n      this.designNameValue=[];\n      this.close()\n    },\n    designNameChange(selectedValue) {\n      this.newRoleId=selectedValue.join(\",\");\n    },\n    checkALL(){\n      var designName = [];\n      for (let value of this.desformList) {\n        designName.push(\n          value.id\n        )\n      }\n      this.designNameValue = designName;\n      this.newRoleId=designName.join(\",\");\n    },\n    cancelCheckALL(){\n      this.designNameValue=[];\n      this.newRoleId=\"\";\n    },\n    /** 加载desform */\n    loadDesformList() {\n      getAction(this.url.getDeptRoleList, { departId: this.currentDeptId, userId:this.userId }).then((res) => {\n        if (res.success) {\n          this.desformList = res.result\n          var designName = [];\n          for (let value of this.desformList) {\n            designName.push({\n              value: value.id,\n              text: value.roleName,\n            })\n          }\n          this.designNameOption = designName;\n        }\n      });\n    },\n  }\n\n}\n",{"version":3,"sources":["DeptRoleUserModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmDA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA","file":"DeptRoleUserModal.vue","sourceRoot":"src/views/system/modules","sourcesContent":["<template>\r\n  <a-drawer\r\n    :title=\"title\"\r\n    :maskClosable=\"true\"\r\n    width=600\r\n    placement=\"right\"\r\n    :closable=\"true\"\r\n    @close=\"close\"\r\n    :visible=\"visible\"\r\n    style=\"height: calc(100% - 55px);overflow: auto;padding-bottom: 53px;\">\r\n\r\n    <a-spin :spinning=\"confirmLoading\">\r\n\r\n      <a-form :form=\"form\" v-if=\"designNameOption.length>0\">\r\n        <a-form-item label=''>\r\n          <a-col :xl=\"24\" :lg=\"24\" :md=\"24\" :sm=\"24\" :xs=\"24\">\r\n            <a-card :style=\"{ marginTop: '12px',height:'auto' }\">\r\n              <a-checkbox-group @change=\"designNameChange\" v-model=\"designNameValue\" style=\"width: 100%\">\r\n                <a-row>\r\n                  <template v-for=\"(des) in designNameOption\">\r\n                    <a-col :span=\"6\">\r\n                      <a-checkbox :value=\"des.value\">{{ des.text }}</a-checkbox>\r\n                    </a-col>\r\n                  </template>\r\n                </a-row>\r\n              </a-checkbox-group>\r\n            </a-card>\r\n          </a-col>\r\n        </a-form-item>\r\n      </a-form>\r\n      <div v-else><h3>无可配置角色!</h3></div>\r\n    </a-spin>\r\n    <div class=\"drawer-bootom-button\">\r\n      <a-dropdown style=\"float: left\" :trigger=\"['click']\" placement=\"topCenter\">\r\n        <a-menu slot=\"overlay\">\r\n          <a-menu-item key=\"1\" @click=\"checkALL\">全部勾选</a-menu-item>\r\n          <a-menu-item key=\"2\" @click=\"cancelCheckALL\">取消全选</a-menu-item>\r\n        </a-menu>\r\n        <a-button>\r\n          操作 <a-icon type=\"up\" />\r\n        </a-button>\r\n      </a-dropdown>\r\n      <a-popconfirm  title=\"确定放弃编辑？\" @confirm=\"close\" okText=\"确定\" cancelText=\"取消\">\r\n        <a-button style=\"margin-right: .8rem\">取消</a-button>\r\n      </a-popconfirm>\r\n      <a-button @click=\"handleSubmit(true)\" type=\"primary\">保存</a-button>\r\n    </div>\r\n  </a-drawer>\r\n</template>\r\n\r\n<script>\r\n  import {httpAction, getAction} from '@/api/manage'\r\n  import  JEllipsis  from '@/components/jeecg/JEllipsis'\r\n  import {initDictOptions} from '@/components/dict/JDictSelectUtil'\r\n\r\n  export default {\r\n    name: 'DeptRoleUserModal',\r\n    components: {\r\n      JEllipsis\r\n    },\r\n    data() {\r\n      return {\r\n        currentDeptId:\"\",\r\n        title: \"部门角色分配\",\r\n        visible: false,\r\n        model: {},\r\n        labelCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 5},\r\n        },\r\n        wrapperCol: {\r\n          xs: {span: 24},\r\n          sm: {span: 16},\r\n        },\r\n        confirmLoading: false,\r\n        form: this.$form.createForm(this),\r\n        validatorRules: {},\r\n        url: {\r\n          add: \"/sys/sysDepartRole/deptRoleUserAdd\",\r\n          getDeptRoleList:\"/sys/sysDepartRole/getDeptRoleList\",\r\n          getDeptRoleByUserId:\"/sys/sysDepartRole/getDeptRoleByUserId\"\r\n        },\r\n        designNameOption: [],\r\n        userId: \"\",\r\n        newRoleId:\"\",\r\n        oldRoleId:\"\",\r\n        designNameValue:[],\r\n        desformList: [],\r\n      }\r\n    },\r\n    created() {\r\n\r\n    },\r\n    methods: {\r\n      add(record,departId) {\r\n        this.userId = record.id;\r\n        this.currentDeptId = departId;\r\n        this.loadDesformList();\r\n        this.edit({});\r\n      },\r\n      edit(record) {\r\n        this.form.resetFields();\r\n        this.model = Object.assign({}, record);\r\n        this.visible = true;\r\n        getAction(this.url.getDeptRoleByUserId,{userId:this.userId}).then((res) => {\r\n          if (res.success) {\r\n            var designName = [];\r\n            for (let value of res.result) {\r\n              designName.push(value.droleId)\r\n            }\r\n            this.oldRoleId=designName.join(\",\");\r\n            this.designNameValue = designName;\r\n            this.newRoleId = designName.join(\",\");\r\n          }\r\n        });\r\n      },\r\n      close() {\r\n        this.$emit('close');\r\n        this.visible = false;\r\n      },\r\n      handleSubmit() {\r\n        const that = this;\r\n        // 触发表单验证\r\n        that.confirmLoading = true;\r\n        let  httpurl = this.url.add;\r\n        let  method = 'post';\r\n        let formData = Object.assign(this.model, {});\r\n        //时间格式化\r\n        formData.userId = this.userId;\r\n        formData.newRoleId=this.newRoleId;\r\n        formData.oldRoleId=this.oldRoleId;\r\n        httpAction(httpurl, formData, method).then((res) => {\r\n          if (res.success) {\r\n            that.$message.success(res.message);\r\n            that.$emit('reload');\r\n            that.$emit('ok');\r\n          } else {\r\n            that.$message.warning(res.message);\r\n          }\r\n        }).finally(() => {\r\n          that.confirmLoading = false;\r\n          that.close();\r\n        })\r\n      },\r\n      handleCancel() {\r\n        this.designNameOption=[];\r\n        this.designNameValue=[];\r\n        this.close()\r\n      },\r\n      designNameChange(selectedValue) {\r\n        this.newRoleId=selectedValue.join(\",\");\r\n      },\r\n      checkALL(){\r\n        var designName = [];\r\n        for (let value of this.desformList) {\r\n          designName.push(\r\n            value.id\r\n          )\r\n        }\r\n        this.designNameValue = designName;\r\n        this.newRoleId=designName.join(\",\");\r\n      },\r\n      cancelCheckALL(){\r\n        this.designNameValue=[];\r\n        this.newRoleId=\"\";\r\n      },\r\n      /** 加载desform */\r\n      loadDesformList() {\r\n        getAction(this.url.getDeptRoleList, { departId: this.currentDeptId, userId:this.userId }).then((res) => {\r\n          if (res.success) {\r\n            this.desformList = res.result\r\n            var designName = [];\r\n            for (let value of this.desformList) {\r\n              designName.push({\r\n                value: value.id,\r\n                text: value.roleName,\r\n              })\r\n            }\r\n            this.designNameOption = designName;\r\n          }\r\n        });\r\n      },\r\n    }\r\n\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .drawer-bootom-button {\r\n    position: absolute;\r\n    bottom: 0;\r\n    width: 100%;\r\n    border-top: 1px solid #e8e8e8;\r\n    padding: 10px 16px;\r\n    text-align: right;\r\n    left: 0;\r\n    background: #fff;\r\n    border-radius: 0 0 2px 2px;\r\n  }\r\n</style>"]}]}