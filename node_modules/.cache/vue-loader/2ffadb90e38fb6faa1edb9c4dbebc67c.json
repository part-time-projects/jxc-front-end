{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\system\\modules\\DeptRoleUserModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\system\\modules\\DeptRoleUserModal.vue","mtime":1648374778152},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {httpAction, getAction} from '@/api/manage'\nimport  JEllipsis  from '@/components/jeecg/JEllipsis'\nimport {initDictOptions} from '@/components/dict/JDictSelectUtil'\n\nexport default {\n  name: 'DeptRoleUserModal',\n  components: {\n    JEllipsis\n  },\n  data() {\n    return {\n      currentDeptId:\"\",\n      title: \"部门角色分配\",\n      visible: false,\n      model: {},\n      labelCol: {\n        xs: {span: 24},\n        sm: {span: 5},\n      },\n      wrapperCol: {\n        xs: {span: 24},\n        sm: {span: 16},\n      },\n      confirmLoading: false,\n      form: this.$form.createForm(this),\n      validatorRules: {},\n      url: {\n        add: \"/sys/sysDepartRole/deptRoleUserAdd\",\n        getDeptRoleList:\"/sys/sysDepartRole/getDeptRoleList\",\n        getDeptRoleByUserId:\"/sys/sysDepartRole/getDeptRoleByUserId\"\n      },\n      designNameOption: [],\n      userId: \"\",\n      newRoleId:\"\",\n      oldRoleId:\"\",\n      designNameValue:[],\n      desformList: [],\n    }\n  },\n  created() {\n\n  },\n  methods: {\n    add(record,departId) {\n      this.userId = record.id;\n      this.currentDeptId = departId;\n      this.loadDesformList();\n      this.edit({});\n    },\n    edit(record) {\n      this.form.resetFields();\n      this.model = Object.assign({}, record);\n      this.visible = true;\n      getAction(this.url.getDeptRoleByUserId,{userId:this.userId}).then((res) => {\n        if (res.success) {\n          var designName = [];\n          for (let value of res.result) {\n            designName.push(value.droleId)\n          }\n          this.oldRoleId=designName.join(\",\");\n          this.designNameValue = designName;\n          this.newRoleId = designName.join(\",\");\n        }\n      });\n    },\n    close() {\n      this.$emit('close');\n      this.visible = false;\n    },\n    handleSubmit() {\n      const that = this;\n      // 触发表单验证\n      that.confirmLoading = true;\n      let  httpurl = this.url.add;\n      let  method = 'post';\n      let formData = Object.assign(this.model, {});\n      //时间格式化\n      formData.userId = this.userId;\n      formData.newRoleId=this.newRoleId;\n      formData.oldRoleId=this.oldRoleId;\n      httpAction(httpurl, formData, method).then((res) => {\n        if (res.success) {\n          that.$message.success(res.message);\n          that.$emit('reload');\n          that.$emit('ok');\n        } else {\n          that.$message.warning(res.message);\n        }\n      }).finally(() => {\n        that.confirmLoading = false;\n        that.close();\n      })\n    },\n    handleCancel() {\n      this.designNameOption=[];\n      this.designNameValue=[];\n      this.close()\n    },\n    designNameChange(selectedValue) {\n      this.newRoleId=selectedValue.join(\",\");\n    },\n    checkALL(){\n      var designName = [];\n      for (let value of this.desformList) {\n        designName.push(\n          value.id\n        )\n      }\n      this.designNameValue = designName;\n      this.newRoleId=designName.join(\",\");\n    },\n    cancelCheckALL(){\n      this.designNameValue=[];\n      this.newRoleId=\"\";\n    },\n    /** 加载desform */\n    loadDesformList() {\n      getAction(this.url.getDeptRoleList, { departId: this.currentDeptId, userId:this.userId }).then((res) => {\n        if (res.success) {\n          this.desformList = res.result\n          var designName = [];\n          for (let value of this.desformList) {\n            designName.push({\n              value: value.id,\n              text: value.roleName,\n            })\n          }\n          this.designNameOption = designName;\n        }\n      });\n    },\n  }\n\n}\n",null]}