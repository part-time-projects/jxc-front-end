{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\system\\modules\\DeptRoleAuthModal.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\system\\modules\\DeptRoleAuthModal.vue","mtime":1648374778151},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\babel-loader\\lib\\index.js","mtime":1648365068269},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n//\n\nimport {queryTreeListForDeptRole,queryDeptRolePermission,saveDeptRolePermission} from '@/api/api'\nimport RoleDataruleModal from './RoleDataruleModal.vue'\nimport DeptRoleDataruleModal from './DeptRoleDataruleModal'\n\nexport default {\n  name: \"DeptRoleAuthModal\",\n  components:{\n    DeptRoleDataruleModal,\n    RoleDataruleModal\n  },\n  data(){\n    return {\n      departId:\"\",\n      roleId:\"\",\n      treeData: [],\n      defaultCheckedKeys:[],\n      checkedKeys:[],\n      halfCheckedKeys:[],\n      expandedKeysss:[],\n      allTreeKeys:[],\n      autoExpandParent: true,\n      checkStrictly: true,\n      title:\"部门角色权限配置\",\n      visible: false,\n      loading: false,\n      selectedKeys:[]\n    }\n  },\n  methods: {\n    switchCheckStrictly (v) {\n      if(v==1){\n        this.checkStrictly = false\n      }else if(v==2){\n        this.checkStrictly = true\n      }\n    },\n    onTreeNodeSelect(id){\n      if(id && id.length>0){\n        this.selectedKeys = id\n      }\n      this.$refs.datarule.show(this.selectedKeys[0],this.departId,this.roleId)\n    },\n    onCheck (o) {\n      if(this.checkStrictly){\n        this.checkedKeys = o.checked;\n      }else{\n        this.checkedKeys = o\n      }\n    },\n    show(roleId,departId){\n      this.departId = departId\n      this.roleId=roleId\n      this.visible = true;\n    },\n    close () {\n      this.reset()\n      this.$emit('close');\n      this.visible = false;\n    },\n    onExpand(expandedKeys){\n      this.expandedKeysss = expandedKeys;\n      this.autoExpandParent = false\n    },\n    reset () {\n      this.expandedKeysss = []\n      this.checkedKeys = []\n      this.defaultCheckedKeys = []\n      this.loading = false\n    },\n    expandAll () {\n      this.expandedKeysss = this.allTreeKeys\n    },\n    closeAll () {\n      this.expandedKeysss = []\n    },\n    checkALL () {\n      this.checkedKeys = this.allTreeKeys\n    },\n    cancelCheckALL () {\n      this.checkedKeys = []\n    },\n    handleCancel () {\n      this.close()\n    },\n    handleSubmit(exit) {\n      let that = this;\n      let params =  {\n        roleId:that.roleId,\n        permissionIds:that.checkedKeys.join(\",\"),\n        lastpermissionIds:that.defaultCheckedKeys.join(\",\"),\n      };\n      that.loading = true;\n      console.log(\"请求参数：\",params);\n      saveDeptRolePermission(params).then((res)=>{\n        if(res.success){\n          that.$message.success(res.message);\n          that.loading = false;\n          if (exit) {\n            that.close()\n          }\n        }else {\n          that.$message.error(res.message);\n          that.loading = false;\n          if (exit) {\n            that.close()\n          }\n        }\n        this.loadData();\n      })\n    },\n    convertTreeListToKeyLeafPairs(treeList, keyLeafPair = []) {\n      for(const {key, isLeaf, children} of treeList) {\n        keyLeafPair.push({key, isLeaf})\n        if(children && children.length > 0) {\n          this.convertTreeListToKeyLeafPairs(children, keyLeafPair)\n        }\n      }\n      return keyLeafPair;\n    },\n    loadData(){\n      queryTreeListForDeptRole({departId:this.departId}).then((res) => {\n        this.treeData = res.result.treeList\n        this.allTreeKeys = res.result.ids\n        queryDeptRolePermission({roleId:this.roleId}).then((res)=>{\n          this.checkedKeys = [...res.result];\n          this.defaultCheckedKeys = [...res.result];\n          this.expandedKeysss = this.allTreeKeys;\n        })\n      })\n    }\n  },\n  watch: {\n    visible () {\n      if (this.visible ) {\n        this.loadData();\n      }\n    }\n  }\n}\n\n",null]}