{"remainingRequest":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\finance\\modules\\PayableCheckModal.vue?vue&type=style&index=0&id=57446598&lang=less&scoped=true&","dependencies":[{"path":"D:\\ideaworkspace\\jxc-front-end\\src\\views\\erp\\finance\\modules\\PayableCheckModal.vue","mtime":1648374777625},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\css-loader\\index.js","mtime":1648364961250},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1648364957239},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\postcss-loader\\src\\index.js","mtime":1648365139501},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\less-loader\\dist\\cjs.js","mtime":1648365206449},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1648365135345},{"path":"D:\\ideaworkspace\\jxc-front-end\\node_modules\\vue-loader\\lib\\index.js","mtime":1648364957239}],"contextDependencies":[],"result":["\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n.ant-row.ant-form-item {\n  margin-bottom: 12px;\n}\n\n",{"version":3,"sources":["PayableCheckModal.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA4pBA;AACA;AACA","file":"PayableCheckModal.vue","sourceRoot":"src/views/erp/finance/modules","sourcesContent":["<template>\r\n  <j-modal\r\n    :title=\"'应付核销 - ' + title\"\r\n    :width=\"width\"\r\n    :visible=\"visible\"\r\n    :confirmLoading=\"confirmLoading\"\r\n    :maskClosable=\"false\"\r\n    :keyboard=\"false\"\r\n    :forceRender=\"true\"\r\n    switchFullscreen\r\n    @cancel=\"handleCancel\">\r\n\r\n    <template slot=\"footer\">\r\n      <a-button v-if=\"action!=='detail'\" key=\"cancel\" @click=\"handleCancel\">取消</a-button>\r\n      <a-button v-if=\"!readOnly\" key=\"save\"   @click=\"handleSave\" type=\"primary\" :loading=\"confirmLoading\">保存</a-button>\r\n      <a-button v-if=\"!readOnly\" :disabled=\"totalAmt1!==totalAmt2\" key=\"submit\" @click=\"handleSubmit\" type=\"primary\" :loading=\"confirmLoading\">提交</a-button>\r\n      <a-button v-if=\"action==='detail'\"  key=\"close\"  @click=\"handleCancel\" type=\"primary\">关闭</a-button>\r\n      <a-button v-if=\"action==='approve'\"  key=\"approved\"  @click=\"handleApproved\" type=\"primary\">审核通过</a-button>\r\n    </template>\r\n\r\n    <a-spin :spinning=\"confirmLoading\">\r\n      <!-- 主表单区域 -->\r\n      <a-form :form=\"form\">\r\n        <a-row>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"处理状态\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['billProcStatus', validatorRules.billProcStatus]\" :trigger-change=\"true\" dictCode=\"x_bill_proc_status\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否通过\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isApproved', validatorRules.isApproved]\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否关闭\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isClosed', validatorRules.isClosed]\" :trigger-change=\"true\" dictCode=\"yn\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a-form-item label=\"是否作废\" :labelCol=\"spans.labelCol6\" :wrapperCol=\"spans.wrapperCol6\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['isVoided', validatorRules.isVoided]\" :trigger-change=\"true\" dictCode=\"yn\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"4\">\r\n            <a @click=\"()=> this.moreStatus = !this.moreStatus\" style=\"float: right; margin-top: 10px\">\r\n              {{ moreStatus ? '收起' : '展开' }}\r\n              <a-icon :type=\"moreStatus ? 'up' : 'down'\"/>\r\n            </a>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row v-show=\"moreStatus\">\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'createTime', validatorRules.createTime]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['createBy', validatorRules.createBy]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"创建部门\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['sysOrgCode', validatorRules.sysOrgCode]\" :trigger-change=\"true\" dictCode=\"sys_depart,depart_name,org_code\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"生效时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'effectiveTime', validatorRules.effectiveTime]\" :showTime=\"true\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"审核人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['approverId', validatorRules.approverId]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"流程\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'flowId', validatorRules.flowId]\" ></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"修改时间\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"true\" v-decorator=\"[ 'updateTime', validatorRules.updateTime]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"修改人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled type=\"list\" v-decorator=\"['updateBy', validatorRules.updateBy]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"单据编号\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <a-input :readOnly=\"true\" v-decorator=\"[ 'billNo', validatorRules.billNo]\"></a-input>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item label=\"单据日期\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-date :readOnly=\"readOnly\" v-decorator=\"[ 'billDate', validatorRules.billDate]\" :trigger-change=\"true\" style=\"width: 100%\"/>\r\n            </a-form-item>\r\n          </a-col>\r\n          <a-col :span=\"8\">\r\n            <a-form-item  label=\"制单人\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n              <j-dict-select-tag disabled  type=\"list\" v-decorator=\"['createBy', validatorRules.createBy]\" :trigger-change=\"true\" dictCode=\"sys_user,realname,username\" />\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n        <a-row>\r\n          <a-tooltip :title=\"!readOnly && entryCount1+entryCount2>0 ? '有核销项时不能改变供应商！':''\" placement=\"bottom\">\r\n            <a-col :span=\"8\">\r\n              <a-form-item label=\"供应商\" :labelCol=\"spans.labelCol3\" :wrapperCol=\"spans.wrapperCol3\">\r\n                  <j-dict-select-tag :disabled=\"readOnly || entryCount1+entryCount2>0\" type=\"list\"  @change=\"onSupplierChange\"\r\n                                     v-decorator=\"['supplierId', validatorRules.supplierId]\" :trigger-change=\"true\" dictCode=\"bas_supplier,name,id\"/>\r\n              </a-form-item>\r\n            </a-col>\r\n            </a-tooltip>\r\n          <a-col :span=\"16\">\r\n            <a-form-item label=\"备注\" :labelCol=\"spans.labelCol\" :wrapperCol=\"spans.wrapperCol\">\r\n              <a-textarea :readOnly=\"readOnly\" v-decorator=\"[ 'remark', validatorRules.remark]\" :rows=\"1\" autoSize></a-textarea>\r\n            </a-form-item>\r\n          </a-col>\r\n        </a-row>\r\n      </a-form>\r\n\r\n      <!-- 子表区域 -->\r\n      <a-divider style=\"margin:6px 0 6px 0;\"></a-divider>\r\n      <split-pane v-if=\"!readOnly\" :min-percent='35' :default-percent='50' split=\"vertical\"\r\n                  :style=\"'width:100%; height:' + splitPaneHeight + 'px'\">\r\n        <template slot=\"paneL\">\r\n          <a-row>\r\n            <a-col span=\"20\">\r\n              <br>\r\n              <rpCheckPayable-List ref=\"rpCheckPayableList\"\r\n                                   @selectChange=\"onPayableSelectChange\"\r\n                                   @dataSourceChange=\"onPayableDataSourceChange\"\r\n                                   :style=\"'height:'+payableHeight+'px'\"/>\r\n            </a-col>\r\n            <a-col span=\"4\">\r\n              <br><br><br>\r\n              <a-button :disabled=\"selectedPayableCount===0\" type=\"link\" @click=\"handleEntryList1Add\" icon=\"right\">添加</a-button>\r\n              <br><br>\r\n              <a-button :disabled=\"selectedEntryCount1===0\" type=\"link\" @click=\"handleEntryList1Remove\" icon=\"left\">移除</a-button>\r\n            </a-col>\r\n          </a-row>\r\n          <a-row>\r\n            <a-col span=\"20\">\r\n              <br style=\"line-height: 50%\">\r\n              <rpCheckPayment-list ref=\"rpCheckPaymentList\"\r\n                                   @selectChange=\"onPaymentSelectChange\"\r\n                                   @dataSourceChange=\"onPaymentDataSourceChange\"/>\r\n            </a-col>\r\n            <a-col span=\"3\">\r\n              <br><br><br>\r\n              <a-button :disabled=\"selectedPaymentCount===0\" type=\"link\" @click=\"handleEntryList2Add\" icon=\"right\">添加</a-button>\r\n              <br><br>\r\n              <a-button :disabled=\"selectedEntryCount2===0\" type=\"link\" @click=\"handleEntryList2Remove\" icon=\"left\">移除</a-button>\r\n            </a-col>\r\n          </a-row>\r\n        </template>\r\n        <template slot=\"paneR\">\r\n          <a-icon type=\"column-width\" />\r\n          <rpCheckEntry-list ref=\"rpCheckEntryList1\"\r\n                             checkType=\"201\"\r\n                             checkSide=\"1\"\r\n                             :readOnly=\"readOnly\"\r\n                             @totalAmtChange=\"totalAmt => { this.totalAmt1 = totalAmt; }\"\r\n                             @selectChange=\"onEntryList1SelectChange\"\r\n                             @dataSourceChange=\"onEntryList1DataSourceChange\"\r\n                             :style=\"'height:'+payableHeight+'px'\"/>\r\n          <br style=\"line-height: 50%\">\r\n          <rpCheckEntry-list ref=\"rpCheckEntryList2\"\r\n                             checkType=\"201\"\r\n                             checkSide=\"2\"\r\n                             :readOnly=\"readOnly\"\r\n                             @totalAmtChange=\"totalAmt => { this.totalAmt2 = totalAmt; }\"\r\n                             @selectChange=\"onEntryList2SelectChange\"\r\n                             @dataSourceChange=\"onEntryList2DataSourceChange\"/>\r\n          <a-alert v-if=\"totalAmt1!==totalAmt2\" message=\"双方核销金额合计不相等！\" type=\"warning\" banner />\r\n        </template>\r\n      </split-pane>\r\n      <template v-else>\r\n        <rpCheckEntry-list ref=\"rpCheckEntryList1\"\r\n                           checkType=\"201\"\r\n                           checkSide=\"1\"\r\n                           :readOnly=\"readOnly\"\r\n                           @totalAmtChange=\"totalAmt => { this.totalAmt1 = totalAmt; }\"\r\n                           @selectChange=\"onEntryList1SelectChange\"\r\n                           @dataSourceChange=\"onEntryList1DataSourceChange\"/>\r\n        <br style=\"line-height: 50%\">\r\n        <rpCheckEntry-list ref=\"rpCheckEntryList2\"\r\n                           checkType=\"201\"\r\n                           checkSide=\"2\"\r\n                           :readOnly=\"readOnly\"\r\n                           @totalAmtChange=\"totalAmt => { this.totalAmt2 = totalAmt; }\"\r\n                           @selectChange=\"onEntryList2SelectChange\"\r\n                           @dataSourceChange=\"onEntryList2DataSourceChange\"/>\r\n        <a-alert v-if=\"totalAmt1!==totalAmt2\" message=\"双方核销金额合计不相等！\" type=\"warning\" banner />\r\n      </template>\r\n    </a-spin>\r\n  </j-modal>\r\n</template>\r\n\r\n<script>\r\n  import pick from 'lodash.pick'\r\n  import JDate from '@/components/jeecg/JDate'\r\n  import JDictSelectTag from \"@/components/dict/JDictSelectTag\"\r\n  import { getAction, putAction, httpAction } from '@api/manage'\r\n  import splitPane from 'vue-splitpane';\r\n  import { getFormatDate } from \"../../utils/util\"\r\n  import RpCheckPayableList from \"./RpCheck/RpCheckPayableList\";\r\n  import RpCheckPaymentList from \"./RpCheck/RpCheckPaymentList\";\r\n  import RpCheckEntryList from \"./RpCheck/RpCheckEntryList\";\r\n\r\n  export default {\r\n    name: 'PayableCheckModal',\r\n    components: {\r\n      JDate,\r\n      JDictSelectTag,\r\n      RpCheckPayableList,\r\n      RpCheckPaymentList,\r\n      RpCheckEntryList,\r\n      splitPane\r\n    },\r\n\r\n    data() {\r\n      return {\r\n        action: \"\",\r\n        title: '操作',\r\n        width: '1200px',\r\n        visible: false,\r\n        form: this.$form.createForm(this),\r\n        confirmLoading: false,\r\n        model: {},\r\n\r\n        moreStatus: false,\r\n        spans: {\r\n          labelCol: { span: 3 },\r\n          wrapperCol: { span: 21 },\r\n          labelCol1: { span: 2 },\r\n          wrapperCol1: { span: 22 },\r\n          labelCol2: { span: 4 },\r\n          wrapperCol2: { span: 20 },\r\n          labelCol3: { span: 6 },\r\n          wrapperCol3: { span: 18 },\r\n          labelCol6: { span: 12 },\r\n          wrapperCol6: { span: 12 }\r\n        },\r\n\r\n        validatorRules: {\r\n          billNo: {rules: [{required: true, message: '请输入单据编号!'}]},\r\n          billDate: {rules: [{required: true, message: '请输入单据日期!'}]},\r\n          payableCheckType: {rules: []},\r\n          supplierId: {rules: []},\r\n          remark: {rules: []},\r\n          billProcStatus: {rules: []},\r\n          isApproved: {rules: []},\r\n          isClosed: {rules: []},\r\n          isVoided: {rules: []},\r\n          effectiveTime: {rules: []},\r\n          approverId: {rules: []},\r\n          flowId: {rules: []},\r\n          createTime: {rules: []},\r\n          createBy: {rules: []},\r\n          sysOrgCode: {rules: []},\r\n          updateTime: {rules: []},\r\n          updateBy: {rules: []},\r\n        },\r\n\r\n        totalAmt1:0,\r\n        entryCount1: 0,\r\n        payableCount: 0,\r\n        selectedEntryCount1: 0,\r\n        selectedPayableCount: 0,\r\n        totalAmt2:0,\r\n        entryCount2: 0,\r\n        paymentCount: 0,\r\n        selectedEntryCount2: 0,\r\n        selectedPaymentCount: 0,\r\n\r\n        url: {\r\n          add: \"/finance/finPayableCheck/add\",\r\n          edit: \"/finance/finPayableCheck/edit\",\r\n          approve: \"/finance/finPayableCheck/approve\",\r\n          finRpCheckEntry: {\r\n            list: '/finance/finPayableCheck/queryFinPayableCheckEntryByMainId'\r\n          },\r\n        }\r\n      }\r\n    },\r\n\r\n    computed: {\r\n      readOnly: function() {\r\n        return this.action !== \"add\" && this.action !== \"edit\"\r\n      },\r\n      payableHeight: function () {\r\n        let a = this.payableCount === 0 ? 4.5:this.payableCount,\r\n            b = this.entryCount1 === 0 ? 4.5:this.entryCount1;\r\n        return (a > b ? a : b) * 38 + 150;\r\n      },\r\n      splitPaneHeight: function () {\r\n        let a = this.paymentCount === 0 ? 4.5:this.paymentCount,\r\n          b = this.entryCount2 === 0 ? 4.5:this.entryCount2;\r\n        return this.payableHeight + (a > b ? a : b) * 38 + 180;\r\n      },\r\n    },\r\n\r\n    methods: {\r\n      addInit() {\r\n        this.model = {};\r\n        //应付核销类型：付款核应付\r\n        this.model.payableCheckType = '201';\r\n        //处理状态：编辑中\r\n        this.model.billProcStatus = '12';\r\n\r\n        // 请求后台的填值规则接口地址\r\n        const url = '/sys/fillRule/executeRuleByCode/'\r\n        const ruleCode = 'payable_check_bill_no'\r\n        const that = this\r\n        putAction(url + ruleCode, {}).then(res => {\r\n          // 执行成功，获取返回的值，并赋到页面上\r\n          if (res.success) {\r\n            that.$nextTick(() => {\r\n              that.form.setFieldsValue({'billNo':res.result, 'billDate':getFormatDate()})\r\n            })\r\n          }\r\n        })\r\n      },\r\n\r\n      /** 列表点击新增按钮时调用此方法 */\r\n      add() {\r\n        this.addInit();\r\n        this.edit(this.model);\r\n      },\r\n\r\n      resetModal() {\r\n        // reset modal\r\n        this.entryCount1 = 0;\r\n        this.selectedEntryCount1= 0;\r\n        this.selectedPayableCount = 0;\r\n        this.entryCount2 = 0;\r\n        this.selectedEntryCount2 = 0;\r\n        this.selectedPaymentCount = 0;\r\n        this.form.resetFields();\r\n        this.$nextTick(() => {\r\n          this.$refs.rpCheckEntryList1.resetTable();\r\n          this.$refs.rpCheckEntryList2.resetTable();\r\n          if (!this.readOnly) {\r\n            this.$refs.rpCheckPayableList.resetTable();\r\n            this.$refs.rpCheckPaymentList.resetTable();\r\n          }\r\n        });\r\n      },\r\n\r\n      /** 列表点击了编辑（修改）按钮时调用此方法 */\r\n      edit(record) {\r\n        this.resetModal();\r\n\r\n        this.model = Object.assign({}, record);\r\n        this.visible = true;\r\n        this.$nextTick(() => {\r\n          this.form.setFieldsValue(pick(this.model,'billNo','billDate','supplierId','remark','billProcStatus','isApproved','isClosed','isVoided','effectiveTime','approverId','flowId','createTime','createBy','sysOrgCode','updateTime','updateBy'))\r\n        })\r\n\r\n        // 加载子表数据\r\n        this.$nextTick(() => {\r\n          if (this.model.id) {\r\n            queryCheckEntry(this);\r\n            this.onSupplierChange(this.model.supplierId);\r\n          }\r\n        });\r\n\r\n        /** 查询数据 */\r\n        function queryCheckEntry(that) {\r\n          let url = that.url.finRpCheckEntry.list;\r\n          let params = { id: that.model.id };\r\n          that.$refs.rpCheckEntryList1.loading = true;\r\n          that.$refs.rpCheckEntryList2.loading = true;\r\n          getAction(url, params).then(res => {\r\n            let records1 = [], records2 = [];\r\n            for (let record of res.result || []) {\r\n              if (record.checkSide === \"1\")\r\n                records1.push(record)\r\n              else\r\n                records2.push(record);\r\n            }\r\n            that.$refs.rpCheckEntryList1.dataSource = records1;\r\n            that.$refs.rpCheckEntryList2.dataSource = records2;\r\n          }).finally(() => {\r\n            that.$refs.rpCheckEntryList1.loading = false;\r\n            that.$refs.rpCheckEntryList2.loading = false;\r\n          });\r\n        }\r\n      },\r\n\r\n      onSupplierChange(val){\r\n        if (!this.readOnly && val) {\r\n          let params = {supplierId: val};\r\n          this.$refs.rpCheckPayableList.queryParam = params;\r\n          this.$refs.rpCheckPayableList.loadData(1);\r\n          this.$refs.rpCheckPaymentList.queryParam = params;\r\n          this.$refs.rpCheckPaymentList.loadData(1);\r\n        }\r\n      },\r\n\r\n      onPayableDataSourceChange() {\r\n        this.payableCount = this.$refs.rpCheckPayableList.dataSource.length;\r\n        this.makeAdded(this.$refs.rpCheckPayableList, this.$refs.rpCheckEntryList1);\r\n      },\r\n\r\n      //注意：\r\n      // rpCheckPayableList与rpCheckPaymentList的loadData(),由于其中getAction是异步执行，\r\n      // 所以如果在其后调用本函数将无效（此时rpCheckPayableList.dataSource还是空的）。\r\n      makeAdded(fromComponent, toComponent) {\r\n        let records = [];\r\n        let change = false;\r\n        for (let fromRecord of fromComponent.dataSource) {\r\n          let added = false;\r\n          for (let toRecord of toComponent.dataSource) {\r\n            if (fromRecord.id === toRecord.sourceId) {\r\n              added = true;\r\n              if (fromRecord.added !== \"是\") {\r\n                fromRecord.added = \"是\";\r\n                change = true;\r\n              }\r\n              break;\r\n            }\r\n          }\r\n          // 以前是added，但现在不是\r\n          if (!added && fromRecord.added === \"是\") {\r\n            fromRecord.added = \"\";\r\n            change = true;\r\n          }\r\n          records.push(fromRecord);\r\n        }\r\n        if (change) {\r\n          //避免循环触发dataSourceChange\r\n          fromComponent.disableDataSourceChange = true;\r\n          fromComponent.dataSource = records;\r\n        }\r\n      },\r\n\r\n      onPayableSelectChange(){\r\n        let count = 0;\r\n        for (let payable of  this.$refs.rpCheckPayableList.selectionRows) {\r\n          if (payable.added !== \"是\") count++;\r\n        }\r\n        this.selectedPayableCount = count;\r\n      },\r\n\r\n      onEntryList1SelectChange() {\r\n        this.selectedEntryCount1 = this.$refs.rpCheckEntryList1.selectedRowKeys.length;\r\n      },\r\n\r\n      onEntryList1DataSourceChange(){\r\n        this.entryCount1 = this.$refs.rpCheckEntryList1.dataSource.length;\r\n      },\r\n\r\n      onPaymentDataSourceChange() {\r\n        this.paymentCount = this.$refs.rpCheckPaymentList.dataSource.length;\r\n        this.makeAdded(this.$refs.rpCheckPaymentList, this.$refs.rpCheckEntryList2);\r\n      },\r\n\r\n      onPaymentSelectChange(){\r\n        let count = 0;\r\n        for (let payment of this.$refs.rpCheckPaymentList.selectionRows) {\r\n          if (payment.added !== \"是\") count++;\r\n        }\r\n        this.selectedPaymentCount = count;\r\n      },\r\n\r\n      onEntryList2SelectChange() {\r\n        this.selectedEntryCount2 = this.$refs.rpCheckEntryList2.selectedRowKeys.length;\r\n      },\r\n\r\n      onEntryList2DataSourceChange(){\r\n        this.entryCount2 = this.$refs.rpCheckEntryList2.dataSource.length;\r\n      },\r\n\r\n      handleEntryList1Add() {\r\n        let maxEntryNo = 100;\r\n        for(let record of this.$refs.rpCheckEntryList1.dataSource) {\r\n          if (maxEntryNo < record.entryNo)  maxEntryNo = record.entryNo;\r\n        }\r\n\r\n        let records = [];\r\n        for (let record of this.$refs.rpCheckPayableList.selectionRows) {\r\n          if (record.added !== \"是\") {\r\n            records.push({\r\n              entryNo: ++maxEntryNo,\r\n              checkSide: \"1\",\r\n              sourceType: \"fin_payable\",\r\n              sourceId: record.id,\r\n              sourceNo: record.billNo,\r\n              uncheckedAmt: record.uncheckedAmt,\r\n              amt: record.uncheckedAmt\r\n            });\r\n          }\r\n        }\r\n        this.$refs.rpCheckEntryList1.dataSource.push(...records);\r\n        this.selectedPayableCount = 0;\r\n        this.$refs.rpCheckPayableList.selectedRowKeys = [];\r\n        this.$refs.rpCheckPayableList.selectionRows = [];\r\n        this.makeAdded(this.$refs.rpCheckPayableList, this.$refs.rpCheckEntryList1);\r\n      },\r\n\r\n      handleEntryList1Remove() {\r\n        if (this.$refs.rpCheckEntryList1.selectionRows === 0) return;\r\n\r\n        let records = [];\r\n        for (let record of this.$refs.rpCheckEntryList1.dataSource) {\r\n          let removedRecord = {sourceId:\"\"};\r\n          for (removedRecord of this.$refs.rpCheckEntryList1.selectionRows) {\r\n            //移除的\r\n            if (record.sourceId === removedRecord.sourceId) break;\r\n          }\r\n          //不移除的\r\n          if (record.sourceId !== removedRecord.sourceId) records.push(record);\r\n        }\r\n        this.$refs.rpCheckEntryList1.dataSource = records;\r\n        this.selectedEntryCount1 = 0;\r\n        this.$refs.rpCheckEntryList1.selectedRowKeys = [];\r\n        this.$refs.rpCheckEntryList1.selectionRows = [];\r\n        this.makeAdded(this.$refs.rpCheckPayableList, this.$refs.rpCheckEntryList1);\r\n      },\r\n\r\n      handleEntryList2Add() {\r\n        let maxEntryNo = 200;\r\n        for(let record of this.$refs.rpCheckEntryList2.dataSource) {\r\n          if (maxEntryNo < record.entryNo)  maxEntryNo = record.entryNo;\r\n        }\r\n\r\n        let records = [];\r\n        for (let record of this.$refs.rpCheckPaymentList.selectionRows) {\r\n          if (record.added !== \"是\") {\r\n            records.push({\r\n              entryNo: ++maxEntryNo,\r\n              checkSide: \"2\",\r\n              sourceType: \"fin_payment..202\",\r\n              sourceId: record.id,\r\n              sourceNo: record.billNo,\r\n              uncheckedAmt: record.uncheckedAmt,\r\n              amt: record.uncheckedAmt\r\n            });\r\n          }\r\n        }\r\n        this.$refs.rpCheckEntryList2.dataSource.push(...records);\r\n        this.selectedPaymentCount = 0;\r\n        this.$refs.rpCheckPaymentList.selectedRowKeys = [];\r\n        this.$refs.rpCheckPaymentList.selectionRows = [];\r\n        this.makeAdded(this.$refs.rpCheckPaymentList, this.$refs.rpCheckEntryList2);\r\n      },\r\n\r\n      handleEntryList2Remove() {\r\n        if (this.$refs.rpCheckEntryList2.selectionRows === 0) return;\r\n\r\n        let records = [];\r\n        for (let record of this.$refs.rpCheckEntryList2.dataSource) {\r\n          let removedRecord = {sourceId:\"\"};\r\n          for (removedRecord of this.$refs.rpCheckEntryList2.selectionRows) {\r\n            //移除的\r\n            if (record.sourceId === removedRecord.sourceId) break;\r\n          }\r\n          //不移除的\r\n          if (record.sourceId !== removedRecord.sourceId) records.push(record);\r\n        }\r\n        this.$refs.rpCheckEntryList2.dataSource = records;\r\n        this.selectedEntryCount2 = 0;\r\n        this.$refs.rpCheckEntryList2.selectedRowKeys = [];\r\n        this.$refs.rpCheckEntryList2.selectionRows = [];\r\n        this.makeAdded(this.$refs.rpCheckPaymentList, this.$refs.rpCheckEntryList2);\r\n      },\r\n\r\n      /** 关闭弹窗，并将所有JEditableTable实例回归到初始状态 */\r\n      close() {\r\n        this.visible = false\r\n        this.$emit('close')\r\n      },\r\n\r\n      handleOk () {\r\n        // 触发表单验证\r\n        this.form.validateFields((err, values) => {\r\n          if (!err) {\r\n            let formData = this.classifyIntoFormData(values);\r\n            return this.request(formData, false)\r\n          }\r\n        })\r\n      },\r\n\r\n      /** 整理成formData */\r\n      classifyIntoFormData(formValue) {\r\n        let main = Object.assign(this.model, formValue)\r\n        return {\r\n          ...main, // 展开\r\n          finPayableCheckEntryList: this.$refs.rpCheckEntryList1.dataSource.concat(this.$refs.rpCheckEntryList2.dataSource),\r\n        }\r\n      },\r\n\r\n      /** 发起请求，自动判断是执行新增还是修改操作 */\r\n      request(formData, isSubmit) {\r\n        let url = this.url.add, method = 'post'\r\n        if (this.model.id) {\r\n          url = this.url.edit\r\n          method = 'put'\r\n        }\r\n\r\n        this.confirmLoading = true;\r\n        httpAction(url, formData, method).then((res) => {\r\n          if (res.success) {\r\n            this.$message.success(res.message)\r\n            this.$emit('ok')\r\n            this.close()\r\n          } else {\r\n            this.$message.warning(res.message)\r\n          }\r\n        }).catch(e => {\r\n           if (isSubmit)  this.form.setFieldsValue({billProcStatus:'12'});\r\n        }).finally(() => {\r\n          this.confirmLoading = false\r\n        })\r\n      },\r\n\r\n\r\n      handleCancel () {\r\n        this.close()\r\n      },\r\n      handleSave() {\r\n        this.handleOk()\r\n      },\r\n\r\n      handleSubmit() {\r\n        //处理状态=编辑完成\r\n        this.form.setFieldsValue({billProcStatus:'13'})\r\n\r\n        //出错时要恢复billProcStatus为\"12\"，所以下面未直接调用handleSave()！\r\n        // 触发表单验证\r\n        this.form.validateFields((err, values) => {\r\n          if (!err) {\r\n            let formData = this.classifyIntoFormData(values);\r\n            return this.request(formData, true)\r\n          }\r\n        })\r\n      },\r\n\r\n      handleApproved() {\r\n        const that = this;\r\n        putAction(that.url.approve, {id: that.model.id}).then((res) => {\r\n          if (res.success) {\r\n            that.$message.success(res.message);\r\n            that.$emit('ok')\r\n            that.close()\r\n          } else {\r\n            that.$message.warning(res.message);\r\n          }\r\n        })\r\n      },\r\n\r\n      popupCallback(row){\r\n        this.form.setFieldsValue(pick(row,'billNo','billDate','supplierId','remark','billProcStatus','isApproved','isClosed','isVoided','effectiveTime','approverId','flowId','createTime','createBy','sysOrgCode','updateTime','updateBy'))\r\n      },\r\n\r\n    }\r\n  }\r\n</script>\r\n\r\n<style lang=\"less\" scoped>\r\n  .ant-row.ant-form-item {\r\n    margin-bottom: 12px;\r\n  }\r\n\r\n</style>\r\n"]}]}